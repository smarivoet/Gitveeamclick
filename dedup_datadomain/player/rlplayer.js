/*!
 * Generated by ActivePresenter 5.5.4 HTML5 (2016.01.12)
 */
/*!
 * Atomi HTML5 Player
 * Author: Le Hong Dang <dangle@atomisystems.com>
 * Company: Atomi Systems, Inc.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2015/05/19
 */
var PrezStreams={NONE:0,MAIN:1,SECOND:2,ALL:3};var CtrlKind={NOTE:0,ACTION:1,IMAGE:2,AUDIO:3,VIDEO:4,ANSWER:5,TOGGLE:6,QUIZ:7,TEXTINPUT:8,COMBO:9,BUTTON:10,INPUT:11,FEEDBACK:12,GESTURE:13,DROP:14,CURSOR:90,ZOOM:91};var CtrlFlags={LOOP:1<<29,NOT_WAIT:1<<28,FOCUSABLE:1<<22,DRAGGABLE:1<<20,DROPPABLE:1<<19};var CtrlShowState={SHOWING:1,SHOW:2,HIDING:3,HIDE:4};var NoteType={BALLOON:0,HINTBOX:1,CAPTION:2,HILIGHT:3,ANSWER:5};var PassCondition={PERCENT:0,POINTS:1,ANSWERS:2};var ReportMethod={NONE:0,EMAIL:1,HTTP:2};var ReportFormat={PLAIN:0,CSV:1,XML:2,JSON:3,HTML:4,OBJECT:5};var ZIndexBase={SlideBgrOld:1,SlideCtrlsOld:2,SlideBgrNew:3,SlidePrjCtrls:4,SlideCtrlsNew:5,ClickEffects:6,ClosedCaption:7,CtrlDroppedBase:1000,CtrlDragging:2500,SlideList:3000,Overlay:3000,Dialog:4000,TopLevel:5000};var EvtType={CLICK:3,MOUSE_ENTER:6,MOUSE_LEAVE:7,KEY_DOWN:10,TEXT:12,CHECK:21,CORRECT:23,WRONG:24,COMPLETE:25,INCOMPLETE:26,TIMEOUT:27,ACCEPT:29,REJECT:30,ACCEPT_SPECIFIC:31};var ActType={WAIT:1,CONTINUE:2,END:3,SLIDE_ID:5,SLIDE_IDX:6,NEXT:7,PREV:8,EMAIL:12,WEB:13,SCRIPT:14,SHOW:15,HIDE:16,SUBMIT:19,CLEAR_INPUT:20,SKIP:21,PLAY_AUDIO:26,SHOW_NON_BLOCKING:27};var AtpType={LAST:-1,ALL:-2,ALL_BUT_LAST:-3,OTHERS:-4};var EvtMode={PARTIAL_SCORE:1,PARTIAL_ACTION:2,SURVEY:4,NO_REPORT:8,NO_ASSESSMENT:16,INDEPENDENT:32};var Judge={NEUTRAL:1,CORRECT:2,WRONG:3,PARTIAL_CORRECT:4,INCOMPLETE:5,UNEXPECTED:6};$.extend($.fx.step,{rlCss:function(c){var b=c.end.css(c.pos);if(c.elem.style){for(var a in b){c.elem.style[a]=b[a]}}},rlTransformOrg:function(c){var d=c.end,b=d.sX+c.pos*(d.eX-d.sX),a=d.sY+c.pos*(d.eY-d.sY);$(c.elem).css("transformOrigin",b+"% "+a+"%")},rlRotate:function(a){var b=a.end.s+a.pos*(a.end.e-a.end.s);$(a.elem).css("transform",b?"rotate("+b+"deg)":"")}});$.extend($.cssHooks,{rlTransformOrg:{set:function(a,b){$(a).css("transformOrigin",b.eX+"% "+b.eY+"%")}},rlRotate:{set:function(a,b){$(a).css("transform",b.e?"rotate("+b.e+"deg)":"")}}});$.extend($.easing,{easeInOutQuad:function(e,f,a,h,g){if(e<0.5){return 2*h*e*e+a}return -h*(2*e*(e-2)+1)+a}});(function(b){var a=b.ui.intersect;b.ui.intersect=function(q,n,o){if(!n.options.rlTransform||o!=="pointer"||!n.options.rlRect||!q.options.rlCtrlUI){return a(q,n,o)}var k=n.options.rlTransform,d=n.options.rlRect,g=Prez.Scale*ZoomUI.Scale,h=d.l*g,c=d.t*g,p=d.w*g,m=d.h*g,f=q.position.left+q.offset.click.left-(q.options.rlCtrlUI.dragOffsetX*g||0),e=q.position.top+q.offset.click.top-(q.options.rlCtrlUI.dragOffsetY*g||0),l=RotatePoint(f,e,-k.r,h+p*k.oX/100,c+m*k.oY/100);return b.ui.isOver(l.y,l.x,c,h,m,p)}}($));(function(a){a.PreLoad=function(c){var d=new b();d.Init(c);return d};a.PreLoad.defaults={imgs:[],parallel:10,progress:null,complete:null};function b(){var l,h,c,f,g,e;this.Init=function(m){if(!m){return}g=a.extend({},a.PreLoad.defaults,m);l=g.imgs;if(!l.length){if(g.complete){g.complete()}return}e=false;c=h=0;f=new Array(g.parallel);for(var n=0;n<g.parallel;++n){k(n)}};this.Cancel=function(){e=true;for(var m=0;m<f.length;++m){if(f[m]){a(f[m]).unbind("load").unbind("error").attr("src","")}}g.progress=g.complete=null};function k(m){if(e){return}if(c>=l.length){return}f[m]=new Image();a(f[m]).load(function(){a(this).unbind("load").unbind("error");d(m)}).error(function(){a(this).unbind("load").unbind("error");d(m)}).attr("src",l[c++])}function d(m){++h;if(h>=l.length){if(g.complete){g.complete()}}else{if(g.progress){g.progress(h,l.length)}window.setTimeout(function(){k(m)},0)}}}})(jQuery);String.prototype.format=function(){var d=this;for(var b=0,a=arguments.length;b<a;++b){var c=new RegExp("\\{"+(b)+"\\}","gm");d=d.replace(c,arguments[b])}return d};String.prototype.quoteHTML=function(){var a=this;a=a.replace(/&/g,"&#38;").replace(/\s(?=\s)/g,"&#160;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/\n/g,"<br />");return a};function ScaleFont(a,d){var c=$('<div><div style="'+a.css+'">'+a.html+"</div></div>");$("*",c).each(function(){if(this.style&&this.style.fontSize){var f=this.style.fontSize;var e=f.match(/\D+$/);e=e&&e[0];if(!e||e.search(/inherit|%|em/i)>-1){return}var h=parseFloat(f);if(!isNaN(h)){h*=d;this.style.fontSize=h+e}else{var g=$(this);g.css("font-size",parseFloat(g.css("font-size"))*d)}}});c=$(c.html());var b=c.attr("style");if(b){a.css=b.replace(/"/g,"&quot;")}else{a.css=""}a.html=c.html()}function IsInside(e,d,c,b,a,f){return((a>=e)&&(a<e+c)&&(f>=d)&&(f<d+b))}function RotatePoint(b,k,f,e,d){var a=f*Math.PI/180,h=Math.cos(a),g=Math.sin(a);b-=e;k-=d;return{x:h*b-g*k+e,y:g*b+h*k+d}}Log.NoLog=true;function Log(b,a){if(Log.NoLog){return}if(a===undefined){a=true}if(a&&window.status.length<200){window.status+=b}else{window.status=b}window.console&&window.console.log(b)}function RandomPermutation(e){var d=[];var c,a,b;for(c=0;c<e;++c){d[c]=c}for(c=e-1;c>0;--c){a=Math.round(c*Math.random());b=d[a];d[a]=d[c];d[c]=b}return d}function LimitValue(c,b,a){if(c<b){return b}else{if(c>a){return a}else{if(isNaN(c)){return b}}}return c}function ToLocalNumber(c,b){var a=""+c;if(b=="ar"||(b.length>2&&b.substr(0,2)=="ar")){a=a.replace(/0/g,"۰");a=a.replace(/1/g,"۱");a=a.replace(/2/g,"۲");a=a.replace(/3/g,"۳");a=a.replace(/4/g,"۴");a=a.replace(/5/g,"۵");a=a.replace(/6/g,"۶");a=a.replace(/7/g,"۷");a=a.replace(/8/g,"۸");a=a.replace(/9/g,"۹")}return a}
/*!
 * Atomi HTML5 Player - Player's Core Scripts
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2016/01/12
 *
 */
var bSuppressSCORMException=true;var mediaStats=g_arrSlides[g_arrSlides.length-1].media_stats;var silverlightVer="2.0";var flashPlayerVer="9.0.31.0";$(document).ready(function(){if(TemplateParams.ImagePath===undefined){TemplateParams.ImagePath="player/images/"}$.facebox.settings.loadingImage=UI.PlayerImageUrl("loader.gif"),$.facebox.settings.closeImage=UI.PlayerImageUrl("closelabel.gif"),$(window).unload(OnUnload);if(bSendToLMS){scormInitialize()}BrowserInfo.Init();MediaManager.Init();if(mediaStats.bRequireMediaPlayer){if((MediaManager.ePlayerType==MediaPlayerTypes.SILVERLIGHT&&MediaManager.hasSilverlight==false)||(MediaManager.ePlayerType==MediaPlayerTypes.FLASH&&MediaManager.hasFlashPlayer==false)){$(document).bind("reveal.facebox",function(){$(document).unbind("reveal.facebox");$.facebox.showClose(true)});var c=function(){$(document).unbind("close.facebox",c);Prez.Init()};$(document).bind("close.facebox",c);if(MediaManager.ePlayerType==MediaPlayerTypes.SILVERLIGHT){var a=new Object();a.version=silverlightVer;$.facebox("<p>"+Lang.NeedSilverlight+"</p>"+Silverlight.buildPromptHTML(a))}else{var b=Lang.NeedFlash;b=b.replace("Adobe Flash Player 9",'<a href="http://get.adobe.com/flashplayer">Adobe Flash Player 9</a>');$.facebox("<p>"+b+"</p>")}return}}Prez.Init()});function OnUnload(){if(bSendToLMS){scormTerminate()}}var Prez={INTERVAL:100,PreLoader:null,slideUI:null,prjSlide:null,prjSldUI:null,Scale:1,muted:false,volume:80,GetSlide:function(){return this.slideUI},GetObject:function(a){return(this.slideUI&&this.slideUI.GetObject(a))||(this.prjSldUI&&this.prjSldUI.GetObject(a))||null},Session:{PMode:PlayModes.TUT,User:"",Elapsed:0,savedTime:0,SlideIndex:0,RestoreData:{slides:[],index:0},Navigation:{slides:[],index:0,navigating:false,goBackward:function(){var a=this.slides[this.index-1];if(a){this.navigating=true;--this.index;Prez.ShowSlide(a);this.navigating=false}},goForward:function(){var a=this.slides[this.index+1];if(a){this.navigating=true;++this.index;Prez.ShowSlide(a);this.navigating=false}},addNew:function(a){if(!a||this.navigating||a==this.slides[this.index]){return}if(this.index>=0&&this.index<this.slides.length-1){this.slides.length=this.index+1}this.slides.push(a);this.index=this.slides.length-1},clear:function(){this.slides.length=0;
this.index=0;this.navigating=false}}},started:false,complete:false,runningStreams:PrezStreams.ALL,shouldResumeStreams:PrezStreams.NONE,nBufferingCount:0,Init:function(){this.EscapeHTMLEntities();if(TemplateParams.IniVolume!==undefined){this.volume=LimitValue(TemplateParams.IniVolume,0,100);if(this.volume==0){this.muted=true;this.volume=80}}if(!this.prjSlide){var b=this.GetExportedSlides();for(var a=0,c=b.length;a<c;++a){b[a].idx=a}this.prjSlide=b.pop();if(Options.test_max_time){Options.test_max_time*=60000}}UI.Init();this.PreLoad()},Start:function(d,c,a){this.started=true;this.SessionStop();if(d==undefined){d=this.GetInitialPlayMode()}this.ClearAllResults();this.Session.PMode=d;if(this.prjSldUI){this.prjSldUI.CleanUp();this.prjSldUI=null}if(this.slideUI){this.slideUI.CleanUp();this.slideUI=null}this.SessionStart();this.complete=false;if(bSendToLMS){scormStartLesson()}if(c!==undefined){this.Session.RestoreData.index=c}if(this.Session.RestoreData.index===null||this.Session.RestoreData.index===undefined){this.Session.RestoreData.index=0}var b=this.GetSlideCompletions();if(UI.SlideList){UI.SlideList.MarkComplete(b);UI.SlideList.MarkComplete(false,this.Session.RestoreData.index)}if(UI.SlideNotes){UI.SlideNotes.MarkComplete(b);UI.SlideNotes.MarkComplete(false,this.Session.RestoreData.index)}this.prjSldUI=new SlideUI(this.prjSlide);if(this.GetSlideCount()<=0){UI.ShowMsg(Lang.NoSlide,true,true);return}MediaManager.InitPlayers(function(){this.ShowSlide(this.GetExportedSlideAt(this.Session.RestoreData.index),a?a:0)},this)},SessionStart:function(){UI.OnPrezStart();InitHandlers();this.InitBGTask();this.runningStreams=PrezStreams.ALL;this.shouldResumeStreams=PrezStreams.NONE;this.nBufferingCount=0;if(UI.Toolbar){UI.Toolbar.SetPause(false)}this.Session.Elapsed=0;this.Session.savedTime=(new Date).getTime();this.Session.SlideIndex=0;this.Session.Navigation.clear();if(this.prjSlide&&this.prjSlide.onload!==undefined){EvtMan.DoAction({type:ActType.SCRIPT,dat:this.prjSlide.onload})}},SessionStop:function(){RemoveHandlers();this.Session.User="";this.Session.Elapsed=0;this.Session.SlideIndex=0;this.ClearAllResults();this.StopBGTask();UI.CleanUp()},Restart:function(b,a){if(!b){b=0}this.ClearAllResults();this.Session.RestoreData.index=b;if(bSendToLMS){scormStoreSuspendData(Prez.Session.RestoreData,true)}this.Start(Prez.Session.PMode,b,a)},IsRunning:function(){return this.runningStreams==PrezStreams.ALL},Pause:function(a){a&=this.runningStreams;if(a==PrezStreams.NONE){return a}if(this.nBufferingCount>0&&!this._startBuffering){this.shouldResumeStreams&=~a;return a}this.runningStreams&=~a;EffectMan.UpdatePrezStateChanged();if(this.prjSldUI){this.prjSldUI.UpdatePrezStateChanged()}if(this.slideUI){this.slideUI.UpdatePrezStateChanged()}if(UI.Toolbar){UI.Toolbar.SetPause(!this.IsRunning())}return a},Resume:function(a){a&=~this.runningStreams;if(a==PrezStreams.NONE){return a}if(this.nBufferingCount>0){this.shouldResumeStreams|=a;return a}this.runningStreams|=a;EffectMan.UpdatePrezStateChanged();if(this.prjSldUI){this.prjSldUI.UpdatePrezStateChanged()}if(this.slideUI){this.slideUI.UpdatePrezStateChanged()}if(UI.Toolbar){UI.Toolbar.SetPause(!this.IsRunning())}return a},EscapeHTMLEntities:function(){var d=g_arrSlides.length;for(var c=0;c<d;c++){var a=g_arrSlides[c];a.name=jQuery("<div/>").html(a.name).html();a.description=jQuery("<div/>").html(a.description).html();if(a.hasOwnProperty("acctext")){a.acctext=jQuery("<div/>").html(a.acctext).html()}if(a.hasOwnProperty("ctrls")){var b=a.ctrls.length;for(j=0;j<b;j++){var e=a.ctrls[j];if(e.hasOwnProperty("acctext")){e.acctext=jQuery("<div/>").html(e.acctext).html()}if(e.hasOwnProperty("fshtml")){e.fshtml=jQuery("<div/>").html(e.fshtml).html()}}}}},GiveAwayResumeToken:function(){if(this.prjSldUI&&this.prjSldUI.AcceptResumeToken()){return true}if(this.slideUI&&this.slideUI.AcceptResumeToken()){return true}return false},StartBuffering:function(){if(this.nBufferingCount!=0){return}this.nBufferingCount=1;var a=this.runningStreams;this._startBuffering=true;this.Pause(this.runningStreams);this._startBuffering=false;this.shouldResumeStreams=a;this.UpdateBufferingUI()},BufferingEnded:function(){if(this.nBufferingCount!=0){return}this.UpdateBufferingUI();var a=true;if(BrowserInfo.fixDelayedPlaying){if(this.GiveAwayResumeToken()){a=false}}if(a){this.Resume(this.shouldResumeStreams);this.shouldResumeStreams=PrezStreams.NONE}},IsBuffering:function(){return this.nBufferingCount!=0},IncBufferingCount:function(){Log("Prez.IncBufferingCount: to "+(this.nBufferingCount+1));if(this.nBufferingCount==0){this.StartBuffering()}else{this.nBufferingCount++}},DecBufferingCount:function(){if(this.nBufferingCount==0){Log("Prez.DecBufferingCount: Invalid counter");return}Log("Prez.DecBufferingCount: to"+(this.nBufferingCount-1));this.nBufferingCount--;if(this.nBufferingCount==0){this.BufferingEnded()}},UpdateBufferingUI:function(){if(this.nBufferingCount==0){$(this).stopTime("tm_Buffering");$("#BufferingImg").remove();return}else{$(this).oneTime(500,"tm_Buffering",function(){if($("#BufferingImg").length>0){return}var b=$("#StageDiv");b.append('<img id="BufferingImg" src="'+UI.PlayerImageUrl("loader.gif")+'" style="z-index:100001;">');var c=$("#BufferingImg");var a=(b.width()-c.width())/2;var d=(b.height()-c.height())/2;c.css({position:"absolute",top:d+"px",left:a+"px"})})}},TogglePause:function(){if(this.complete||this.nBufferingCount>0){return}if(this.IsRunning()){this.Pause(PrezStreams.ALL)}else{this.Resume(PrezStreams.ALL)}},GetExportedSlides:function(){return g_arrSlides},GetSlideCount:function(){return this.GetExportedSlides().length},GetExportedSlideAt:function(a){return this.GetExportedSlides()[a]||null},GetExportedSlide:function(a){var c=this.GetExportedSlides();for(var b=0;b<c.length;++b){if(c[b].id==a){return c[b]}}return null},ShowSlide:function(a,e){if(typeof a=="number"){a=this.GetExportedSlideAt(a-1)}if(this.complete){this.Restart(a?a.idx:0,a?e:0);return}if(this.slideUI&&this.slideUI.slide!=a&&((this.slideUI.IsEnd()&&this.IsRunning())||this.Session.RestoreData.slides[this.slideUI.slide.idx])){if(UI.SlideList){UI.SlideList.MarkComplete(true,this.slideUI.GetIndex())}if(UI.SlideNotes){UI.SlideNotes.MarkComplete(true,this.slideUI.GetIndex())}this.slideUI.GetSubmitedDataObject()}if(!a){if(!this.slideUI||(this.slideUI.GetIndex()==this.GetSlideCount()-1)){if(this.prjSlide&&UI.Toolbar){this.prjSldUI.ts=this.prjSlide.duration;UI.Toolbar.SetSliderPosition(this.prjSldUI.ts)}this.OnPrezEnd(false)}return}this.preSlideUI=null;if(this.slideUI&&this.slideUI.slide!==a){this.slideUI.CleanUp();this.preSlideUI=this.slideUI;this.slideUI=null}var b=PrezStreams.NONE;if(this.nBufferingCount>0||this.runningStreams!=PrezStreams.NONE){b=PrezStreams.ALL}this.nBufferingCount=0;this.shouldResumeStreams=PrezStreams.NONE;this.UpdateBufferingUI();var c=this.slideUI;this.slideUI=null;this.Resume(b);if(!c){c=new SlideUI(a)}this.slideUI=c;e=e||0;this.slideUI.LoadSubmitedData();this.slideUI.Show(e,function(){Prez.preSlideUI=null});if(UI.Toolbar){UI.Toolbar.SetSliderTip(ToLocalNumber(a.idx+1,PrezInfo.Language))}if(UI.SlideList){UI.SlideList.SetCurrentSlide(a.idx)}if(UI.SlideNotes){UI.SlideNotes.SetCurrentSlide(a.idx)}if(this.prjSldUI){var d=a.startTime+e;if(Prez.prjSldUI.ts<0||Math.abs(d-Prez.prjSldUI.ts)>Prez.INTERVAL){Prez.prjSldUI.Show(d)}if(UI.Toolbar){UI.Toolbar.SetSliderPosition(this.prjSldUI.ts)}}Prez.Session.RestoreData.index=this.Session.SlideIndex;if(bSendToLMS){scormStoreSuspendData(Prez.Session.RestoreData,true)}this.Session.Navigation.addNew(a)},ShowNextSlide:function(){this.ShowSlide(this.GetExportedSlideAt(this.Session.SlideIndex+1),0)},ShowPreviousSlide:function(){this.ShowSlide(this.GetExportedSlideAt(this.Session.SlideIndex-1),0)},ShowPreviousVisitedSlide:function(){this.Session.Navigation.goBackward()},ShowNextVisitedSlide:function(){this.Session.Navigation.goForward()},ShowSlideByIndex:function(a){this.ShowSlide(this.GetExportedSlideAt(a),0)},ShowSlideByID:function(a){this.ShowSlide(this.GetExportedSlide(a),0)
},HandleSlideLoadingError:function(a){a+="\n"+Lang.ConfirmNextSlide;if(confirm(a)){}},saved:{slide:null,slideTs:0},ShouldDoNextAction:function(){var a=true;if(!this.slideUI||(this.saved.slide!=this.slideUI.slide||this.saved.slideTs>this.slideUI.ts)){a=false;this.saved.slide=null;this.saved.slideTs=0}return a},GetSlideImgUrls:function(k,l,d,e){var c=k.ctrls,m=k.idx;function g(q){switch(q.kind){case CtrlKind.TOGGLE:case CtrlKind.COMBO:if(q.image&&$.inArray(q.image,d)<0){e.push("data/res_"+q.image+".png");d.push(q.image)}break;case CtrlKind.AUDIO:break;case CtrlKind.VIDEO:if(q.video>0){e.push("data/vstart_img_"+m+"."+q.id+".jpg");e.push("data/vend_img_"+m+"."+q.id+".jpg")}break;case CtrlKind.ANSWER:if(q.act){g(q.act)}if(q.note){g(q.note)}break;case CtrlKind.QUIZ:var n=q.ctrls,p;for(var p=0,o=n.length;p<o;++p){g(n[p])}break;case CtrlKind.GESTURE:if(q.eff_touchscr){if(q.eff_touchscr.file&&$.inArray(q.eff_touchscr.file,e)<0){e.push("data/"+q.eff_touchscr.file)}}break;default:e.push("data/img_"+m+"."+q.id+".png");break}}if(l){e.push("data/slide_"+m+"."+Options.image_format)}for(var f=0,b=c.length;f<b;++f){g(c[f])}if(k.cursor){var a=k.cursor.cursors;for(var f=0,b=a.length;f<b;++f){if(a[f].img){e.push("data/"+a[f].img)}if(a[f].click_eff){var h="data/"+a[f].click_eff.file;if($.inArray(h,e)<0){e.push(h)}}}}},PreLoad:function(){if(this.PreLoader){this.PreLoader.Cancel();this.PreLoader=null}var l=UI.ViewPort();var f=Math.min(l.width(),$(window).innerWidth());var p=Math.min(l.height(),$(window).innerHeight());var m=f-20,o=24,a,c;if(m>400){m=400}a=Math.floor((f-m)/2);c=Math.floor((p-o)/2);$("#PreLoadDiv").remove();l.append('<div id="PreLoadDiv"></div>');$("#PreLoadDiv").css({position:"absolute",width:m+"px",top:c+"px",left:a+"px"}).progressbar().children().html("&#160;"+Lang.Loading+ToLocalNumber(0,PrezInfo.Language)+"%");var h=[],g=[],b=this.GetExportedSlides();h=[UI.PlayerImageUrl("aplogo.png"),UI.PlayerImageUrl("blank.gif"),UI.PlayerImageUrl("loader.gif"),UI.PlayerImageUrl("play.png"),UI.PlayerImageUrl("b.png"),UI.PlayerImageUrl("bl.png"),UI.PlayerImageUrl("icons.png"),UI.PlayerImageUrl("br.png"),UI.PlayerImageUrl("tl.png"),UI.PlayerImageUrl("tr.png"),UI.PlayerImageUrl("closelabel.gif")];APToolbar.GetImages(h);h.push("data/"+g_closedCaption.bgimg);this.GetSlideImgUrls(this.prjSlide,false,g,h);for(var k=0,e=b.length;k<e;++k){this.GetSlideImgUrls(b[k],true,g,h)}var d=h.length;if(!d){this.Start();return}var q={imgs:h,progress:function(s,n){var r=Math.floor((100*s)/n);$("#PreLoadDiv").progressbar("value",r).children().html("&#160;"+Lang.Loading+ToLocalNumber(r,PrezInfo.Language)+"%")},complete:function(){$(Prez).stopTime("startprez");$("#PreLoadDiv").progressbar("value",100).children().html("&#160;"+Lang.Loading+ToLocalNumber(100,PrezInfo.Language)+"%");window.setTimeout(function(){$("#PreLoadDiv").progressbar("destroy").remove();if(!Prez.started){Prez.Start()}},100)}};$(this).oneTime(2*60*1000,"startprez",function(){if(!Prez.started){$("#PreLoadDiv").progressbar("destroy").remove();Prez.Start()}});this.PreLoader=$.PreLoad(q)},InitBGTask:function(){$(this).everyTime(this.INTERVAL,"BGTask",Prez.OnTimerTick)},StopBGTask:function(){$(this).stopTime("BGTask")},GetInitialPlayMode:function(){if(g_nInitialMode!=undefined){return g_nInitialMode}else{return PlayModes.TUT}},SwitchMode:function(a){if(a!=undefined){Prez.Session.PMode=a}UI.OnPrezStart(true);this.LoadSlideByIndex(Prez.Session.SlideIndex)},ToggleClosedCaption:function(){ClosedCaptionUI.ToggleShow()},Close:function(a){if((a)&&(confirm(Lang.ConfirmQuit)==false)){return}window.close()},GoFirst:function(){this.ShowSlideByIndex(0)},GoNext:function(){if(this.Session.SlideIndex<this.GetSlideCount()-1){this.ShowSlideByIndex(this.Session.SlideIndex+1)}},GoPrev:function(){if(this.Session.SlideIndex>=1){this.ShowSlideByIndex(this.Session.SlideIndex-1)}},GoLast:function(){if(this.Session.SlideIndex!=this.GetSlideCount()-1){this.ShowSlideByIndex(this.GetSlideCount()-1)}},IsMuted:function(){return this.muted},Mute:function(a){if(a===undefined){a=true}this.muted=a;if(this.slideUI){this.slideUI.Mute(a)}if(this.prjSldUI){this.prjSldUI.Mute(a)}if(UI.Toolbar){UI.Toolbar.SetMute(a)}},SetVolume:function(a){a=LimitValue(a,0,100);this.volume=a;this.muted=false;if(this.slideUI){this.slideUI.SetVolume(a)}if(this.prjSldUI){this.prjSldUI.SetVolume(a)}if(UI.Toolbar){UI.Toolbar.SetVolumeValue(a);UI.Toolbar.SetMute(false)}},GetVolume:function(a){if(a&&this.muted){return 0}return this.volume},GetSlideCompletions:function(){var a={};var c=this.Session.RestoreData.slides;if(c&&c.length){for(var b=0,d=c.length;b<d;++b){if(c[b]){a[b]=true}}}return a},GetResult:function(){var b=true;switch(Options.pass_condition){case PassCondition.PERCENT:case PassCondition.POINTS:var c=Prez.GetPoints();if(Options.pass_condition==PassCondition.POINTS){b=(c>=Options.pass_value)}else{var a=Prez.GetMaxPoints();if(a>0){b=(parseInt(c*100/a)>=Options.pass_value)}}break;case PassCondition.ANSWERS:b=(Prez.GetTakenInteractionCount(Judge.CORRECT)>=Options.pass_value);break}return b},GetPoints:function(){var e=0;var d=Prez.Session.RestoreData.slides;if(!d){return 0}var g=d.length;for(var c=0;c<g;++c){var f=d[c];if(!f){continue}for(var b in f){var a=f[b];if(!a||!a.p){continue}e+=a.p}}return e},GetMaxPoints:function(){var d,h,b,a,f,g,e,c;d=0;h=Prez.GetSlideCount();for(e=0;e<h;++e){b=Prez.GetExportedSlideAt(e);if(!b){continue}a=b.ctrls;g=a.length||0;for(c=0;c<g;++c){f=a[c];d+=Prez.GetCtrlMaxPoints(f,true)}}return d},GetCtrlMaxPoints:function(b,a){if(!b){return 0}if(a==true){if(b.evt&&(b.evt.mod&EvtMode.SURVEY)){return 0}}if(b.kind==CtrlKind.INPUT){if(b.type==InputUI.KEY){return Prez.GetEvtMaxPoints(b.evt,EvtType.KEY_DOWN)}else{if(b.type==InputUI.MOUSE){return Prez.GetEvtMaxPoints(b.evt,EvtType.CLICK)}else{return 0}}}else{if(b.kind==CtrlKind.TEXTINPUT){return Prez.GetEvtMaxPoints(b.evt,EvtType.TEXT)}else{if(b.kind==CtrlKind.DROP){return Prez.GetEvtMaxPoints(b.evt,EvtType.ACCEPT_SPECIFIC)}else{if(b.kind==CtrlKind.QUIZ){return Prez.GetQuizMaxPoint(b)}}}}return 0},GetQuizMaxPoint:function(c){var k=!(c.evt.mod&EvtMode.SURVEY);if(!k){return 0}var m=((c.evt.mod&EvtMode.PARTIAL_SCORE)==EvtMode.PARTIAL_SCORE);var o=0,g;var d=c.ctrls,a=d.length,f,n,h,p;switch(c.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:if(m){for(f=0;f<a;++f){n=d[f];if(!n||n.kind!=CtrlKind.ANSWER||!n.act||!n.act.evt){continue}p=n.act.evt[EvtType.CHECK];if(!p||!p.all){continue}g=p.all.pt||0;if(c.type==QuizUI.Type.MULTI_RESPONSE){if(n.act.checked){o=o+g}}else{if(g>o){o=g}}}}else{o=c.evt.pt}break;case QuizUI.Type.SEQUENCE_DRAGDROP:o=c.evt.pt;break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:for(f=0;f<a;++f){n=d[f];if(n&&n.kind==CtrlKind.TEXTINPUT){o=Prez.GetCtrlMaxPoints(n);break}}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:if(m){for(f=0;f<a;++f){n=d[f];if(!n||n.kind!=CtrlKind.ANSWER||!n.act){continue}o+=Prez.GetCtrlMaxPoints(n.act)}}else{o=c.evt.pt}break;case QuizUI.Type.MATCH_DRAGDROP:if(m){var b,e,l;for(var b in c.dragdrops){l=c.dragdrops[b];if(l){g=0;for(var e in l){if(!isNaN(l[e])&&l[e]>g){g=l[e]}}o+=g}}}else{o=c.evt.pt}break}return o},GetEvtMaxPoints:function(f,h,c){if(!f){return 0}if(c==true){if(f&&(f.mod&EvtMode.SURVEY)){return 0}}var e=0;if(f.mod&EvtMode.PARTIAL_SCORE){var g=f[h],k;if(g&&(typeof g==="object")){if($.isArray(g)){for(var d=0,b=g.length;d<b;++d){k=g[d].pt;if(k>e){e=k}}}else{for(var a in g){k=g[a].pt;if(k>e){e=k}}}}}else{e=f.pt||0}return e},GetRequirements:function(){switch(Options.pass_condition){case PassCondition.PERCENT:return Lang.RequirePercent.format(ToLocalNumber(Options.pass_value,PrezInfo.Language));case PassCondition.POINTS:return Lang.RequirePoints.format(ToLocalNumber(Options.pass_value,PrezInfo.Language));case PassCondition.ANSWERS:return Lang.RequireAnswers.format(ToLocalNumber(Options.pass_value,PrezInfo.Language))}return Lang.RequireNone},ClearAllResults:function(){Prez.Session.RestoreData.slides=[]},GetInteractionCount:function(){var d,h,b,a,f,g,e,c;
d=0;h=Prez.GetSlideCount();for(e=0;e<h;++e){b=Prez.GetExportedSlideAt(e);if(!b){continue}a=b.ctrls;g=a.length||0;for(c=0;c<g;++c){f=a[c];if(!f){continue}if(f.kind==CtrlKind.INPUT){if(f.type!=InputUI.MOUSE_HOVER){d++}}else{if(f.kind==CtrlKind.TEXTINPUT||f.kind==CtrlKind.QUIZ||f.kind==CtrlKind.DROP){d++}}}}return d},GetTakenInteractionCount:function(b){var d=0;var f=Prez.Session.RestoreData.slides;if(!f){return 0}var h=f.length;for(var e=0;e<h;++e){var g=f[e];if(!g){continue}for(var c in g){var a=g[c];if(!a||!a.j){continue}if(b==undefined||a.j==b){d++}}}return d},GetTakenSlideCount:function(){var a=0;var c=Prez.Session.RestoreData.slides;if(!c){return 0}var e=c.length;for(var b=0;b<e;++b){var d=c[b];if(d){a++}}return a},GetSlideDuration:function(b){var a=Prez.GetExportedSlideAt(b);if(a){return a.duration?a.duration:-1}return -1},OnTimerTick:function(){var b=(new Date).getTime();var a=b-Prez.Session.savedTime;if(Prez.runningStreams!=PrezStreams.NONE){Prez.Session.Elapsed+=a;Prez.Session.savedTime=b;if(Prez.Session.Elapsed>=Options.test_max_time&&Options.test_max_time&&Prez.Session.PMode==PlayModes.TEST){Prez.StopBGTask();alert(Lang.MaxPrezTimeReached);Prez.OnPrezEnd(true);return}if((Prez.runningStreams&PrezStreams.MAIN)==PrezStreams.NONE){return}}else{Prez.Session.savedTime=b;return}if(Prez.slideUI){var c=Prez.slideUI.WaitIfNeed(Prez.slideUI.ts,Prez.slideUI.ts+a);if(!isNaN(c)){a=c-Prez.slideUI.ts}if(Prez.prjSldUI){Prez.prjSldUI.ts+=a;Prez.prjSldUI.Tick();if(UI.Toolbar){UI.Toolbar.SetSliderPosition(Prez.prjSldUI.ts)}}Prez.slideUI.ts+=a;Prez.slideUI.Tick();if((Prez.runningStreams&PrezStreams.MAIN)&&Prez.slideUI.IsEnd()){Prez.ShowSlide(Prez.GetExportedSlideAt(Prez.slideUI.GetIndex()+1),0)}}},OnPrezEnd:function(a){Prez.complete=true;Prez.StopBGTask();this.shouldResumeStreams=PrezStreams.NONE;this.nBufferingCount=0;this.UpdateBufferingUI();Prez.Pause(PrezStreams.ALL);if(bSendToLMS){scormEndLesson(a)}switch(Prez.Session.PMode){case PlayModes.DEMO:if(Options.ConfirmRestart){if(confirm(Lang.EndDemoMsg+Lang.ConfirmRestart)==true){Prez.Restart()}else{Prez.Close(false)}}break;case PlayModes.TUT:if(Options.ConfirmRestart){if(confirm(Lang.EndTutorialMsg+Lang.ConfirmRestart)==true){Prez.Restart()}else{Prez.Close(false)}}break;case PlayModes.PRAC:case PlayModes.TEST:if(Options.ShowReport){Prez.ShowReport()}else{if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){Prez.SendReport()}}break}},ShowReport:function(){ReportUI.Show()},SendReport:function(){var b=Prez.GetReportData(Options.report_format);if(b===null){return}switch(Options.report_method){case ReportMethod.EMAIL:if(!Options.report_value){Options.report_value=""}var d="mailto:"+encodeURIComponent(Options.report_value)+"?subject="+encodeURIComponent(Lang.Report)+"&body="+encodeURIComponent(b);try{var f=window.open(d,"_blank");if(f){setTimeout(function(){if(f){f.close()}},1000)}}catch(c){var a=Lang.CouldnotSendReport+Options.report_value;if(c instanceof Error){a+="<br />"+c.name+": "+c.message}else{if(c.toString){a+="<br />"+c.toString()}}a+=Lang.DisablePopupBlocker+"<b><a href='"+d+"' target='_blank'>"+Lang.SendReport+"</a></b>";UI.ShowMsg(a,true,false);return false}Prez.Close(false);break;case ReportMethod.HTTP:try{var e={type:"POST",url:Options.report_value,data:"report="+b,timeout:60000,success:function(){UI.ShowMsg(Lang.SuccessSendReport,true,true)},error:function(g,k,h){if(h){throw h}else{throw new Error(Lang.CouldnotSendReport+Options.report_value+(k?(": "+k):""))}}};UI.ShowMsg(Lang.SendingReport,false,false);$.ajax(e)}catch(c){var a;if(c instanceof Error){a=c.name+": "+c.message}else{if(c.toString){a=c.toString()}else{a=Lang.CouldnotSendReport+Options.report_value}}UI.ShowMsg(a,true,false);return false}break;default:Prez.Close(false);break}},interactionType:{MOUSE_CLICK:1,KEY_STROKE:2,TEXT_BOX:3,DROP_AREA:4,TRUE_FALSE:5,MULTI_CHOICE:6,MULTI_RESPONSE:7,ESSAY:8,FILL_BLANK:9,FILL_MULTI_BLANK:10,SEQUENCE:11,DRAG_DROP:12},interactionResult:{NA:1,CORRECT:2,INCORRECT:3,INCOMPLETE:5,},GetReportData:function(p){if(arguments.length==0){p=ReportFormat.OBJECT}var f,a,h,s;var c="";var e="\n";var o="\t";var g=": ";var k=new Date();var n=Prez.GetPoints();var b=Prez.GetMaxPoints();var q=$.cookie("userid")||"";if(p!=ReportFormat.OBJECT){while(q==""){q=prompt(Lang.EnterUserID,"")}if(q===null){return null}$.cookie("userid",q)}var r=Math.ceil(Prez.Session.Elapsed/1000);switch(p){case ReportFormat.OBJECT:c={userId:q,points:n,maxPoints:b,passed:Prez.GetResult(),slideCount:Prez.GetSlideCount(),takenSlideCount:Prez.GetTakenSlideCount(),interactionCount:Prez.GetInteractionCount(),takenInteractionCount:Prez.GetTakenInteractionCount(),correctInteractionCount:Prez.GetTakenInteractionCount(Judge.CORRECT),takenTime:r,slides:[]};h=ReportUI.GetReportResult();a=h.length;var m,l=-1;for(f=0;f<a;++f){s=h[f];if(s.slideidx>l){l=s.slideidx;m={};c.slides[l]=m}m[s.name]={type:s.type,reportId:s.reportid,attempts:s.attempts,points:s.points,maxPoints:s.maxPoints,result:s.judge,value:s.objAnswers}}break;case ReportFormat.PLAIN:e="\n";g=": ";c=Lang.Presentation+g+PrezInfo.Name+e;c+=Lang.Description+g+PrezInfo.Description+e;c+=Lang.Date1+g+k.toUTCString()+e;c+=Lang.UserID+g+q+e;c+=Lang.TotalTime+g+Math.floor(r/3600)+" h : "+Math.floor((r%3600)/60)+" m : "+(r%60)+" s"+e;c+=Lang.TotalSlides+g+Prez.GetSlideCount()+e;c+=Lang.TakenSlides+g+Prez.GetTakenSlideCount()+e;c+=Lang.TotalInteractions+g+Prez.GetInteractionCount()+e;c+=Lang.TakenInteractions+g+Prez.GetTakenInteractionCount()+e;c+=Lang.CorrectCount+g+Prez.GetTakenInteractionCount(Judge.CORRECT)+e;c+=Lang.Points+g+n+" / "+b+e;c+=Lang.Percentage+g+parseInt(n*100/b)+"%"+e;c+=Lang.Result+g+(Prez.GetResult()?Lang.Passed:Lang.Failed)+" - "+Prez.GetRequirements()+e;c+=e;h=ReportUI.GetReportResult();a=h.length;for(f=0;f<a;++f){s=h[f];c+=(f+1)+". ";c+=Lang.Slide+g+(parseInt(s.slideidx)+1)+", ";c+="ID"+g+s.reportid+", ";c+=Lang.Attempts+g+s.attempts+", ";c+=Lang.Points+g+s.points+", ";c+=Lang.MaxPoints+g+s.maxPoints+", ";c+=Lang.Result+g+s.strJudge+", ";c+=Lang.InteractionType+g+s.strType+", ";c+=Lang.Answer+g+s.answers+e}break;case ReportFormat.CSV:e="\n";g=",";c='"'+Lang.Presentation+'"'+g;c+='"'+Lang.Description+'"'+g;c+='"'+Lang.Date1+'"'+g;c+='"'+Lang.UserID+'"'+g;c+='"'+Lang.TotalTime+'"'+g;c+='"'+Lang.TotalSlides+'"'+g;c+='"'+Lang.TakenSlides+'"'+g;c+='"'+Lang.TotalInteractions+'"'+g;c+='"'+Lang.TakenInteractions+'"'+g;c+='"'+Lang.CorrectCount+'"'+g;c+='"'+Lang.Points+'"'+g;c+='"'+Lang.MaxPoints+'"'+g;c+='"'+Lang.Percentage+'"'+g;c+='"'+Lang.Result+'"'+e;c+='"'+PrezInfo.Name+'"'+g;c+='"'+PrezInfo.Description+'"'+g;c+='"'+k.toUTCString()+'"'+g;c+='"'+q+'"'+g;c+='"'+r+'"'+g;c+='"'+Prez.GetSlideCount()+'"'+g;c+='"'+Prez.GetTakenSlideCount()+'"'+g;c+='"'+Prez.GetInteractionCount()+'"'+g;c+='"'+Prez.GetTakenInteractionCount()+'"'+g;c+='"'+Prez.GetTakenInteractionCount(Judge.CORRECT)+'"'+g;c+='"'+n+'"'+g;c+='"'+b+'"'+g;c+='"'+parseInt(n*100/b)+'"'+g;c+='"'+(Prez.GetResult()?Lang.Passed:Lang.Failed)+'"'+e;c+=e;c+='"#"'+g;c+='"'+Lang.Slide+'"'+g;c+='"ID"'+g;c+='"'+Lang.Attempts+'"'+g;c+='"'+Lang.Points+'"'+g;c+='"'+Lang.MaxPoints+'"'+g;c+='"'+Lang.Result+'"'+g;c+='"'+Lang.InteractionType+'"'+g;c+='"'+Lang.Answer+'"'+e;h=ReportUI.GetReportResult();a=h.length;for(f=0;f<a;++f){s=h[f];c+='"'+(f+1)+'"'+g;c+='"'+(parseInt(s.slideidx)+1)+'"'+g;c+='"'+s.reportid+'"'+g;c+='"'+s.attempts+'"'+g;c+='"'+s.points+'"'+g;c+='"'+s.maxPoints+'"'+g;c+='"'+s.strJudge+'"'+g;c+='"'+s.strType+'"'+g;c+='"'+s.answers+'"'+e}break;case ReportFormat.XML:c='<?xml version="1.0" encoding="UTF-8"?>'+e;c+="<Content>"+e;c+=o+"<Report>"+e;c+=o+o+"<Name>"+PrezInfo.Name+"</Name>"+e;c+=o+o+"<Description>"+PrezInfo.Description+"</Description>"+e;c+=o+o+"<Date>"+k.toUTCString()+"</Date>"+e;c+=o+o+"<UserID>"+q+"</UserID>"+e;c+=o+o+"<TotalTime>"+r+"</TotalTime>"+e;c+=o+o+"<SlideCount>"+Prez.GetSlideCount()+"</SlideCount>"+e;c+=o+o+"<TakenSlide>"+Prez.GetTakenSlideCount()+"</TakenSlide>"+e;c+=o+o+"<TotalInteraction>"+Prez.GetInteractionCount()+"</TotalInteraction>"+e;
c+=o+o+"<TakenInteraction>"+Prez.GetTakenInteractionCount()+"</TakenInteraction>"+e;c+=o+o+"<Correct>"+Prez.GetTakenInteractionCount(Judge.CORRECT)+"</Correct>"+e;c+=o+o+"<Points>"+n+"</Points>"+e;c+=o+o+"<MaxPoints>"+b+"</MaxPoints>"+e;c+=o+o+"<Percent>"+parseInt(n*100/b)+"</Percent>"+e;c+=o+o+"<Result>"+Prez.GetResult()+"</Result>"+e;c+=o+o+"<Details>"+e;h=ReportUI.GetReportResult();a=h.length;for(f=0;f<a;++f){s=h[f];c+=o+o+o+"<Interaction>"+e;c+=o+o+o+o+"<SlideIndex>"+(parseInt(s.slideidx)+1)+"</SlideIndex>"+e;c+=o+o+o+o+"<ReportID>"+s.reportid+"</ReportID>"+e;c+=o+o+o+o+"<Attempts>"+s.attempts+"</Attempts>"+e;c+=o+o+o+o+"<Points>"+s.points+"</Points>"+e;c+=o+o+o+o+"<MaxPoints>"+s.maxPoints+"</MaxPoints>"+e;c+=o+o+o+o+"<Result>"+s.strJudge+"</Result>"+e;c+=o+o+o+o+"<Type>"+s.strType+"</Type>"+e;c+=o+o+o+o+"<Answers>"+s.answers+"</Answers>"+e;c+=o+o+o+"</Interaction>"+e}c+=o+o+"</Details>"+e;c+=o+"</Report>"+e;c+="</Content>"+e;break;case ReportFormat.JSON:c="{"+e;c+=o+'"Name":"'+PrezInfo.Name+'",'+e;c+=o+'"Description":"'+PrezInfo.Description+'",'+e;c+=o+'"Date":"'+k.toUTCString()+'",'+e;c+=o+'"UserID":"'+q+'",'+e;c+=o+'"TotalTime":"'+r+'",'+e;c+=o+'"SlideCount":'+Prez.GetSlideCount()+","+e;c+=o+'"TakenSlide":'+Prez.GetTakenSlideCount()+","+e;c+=o+'"TotalInteraction":'+Prez.GetInteractionCount()+","+e;c+=o+'"TakenInteraction":'+Prez.GetTakenInteractionCount()+","+e;c+=o+'"Correct":'+Prez.GetTakenInteractionCount(Judge.CORRECT)+","+e;c+=o+'"Points":'+n+","+e;c+=o+'"MaxPoints":'+b+","+e;c+=o+'"Percent":"'+parseInt(n*100/b)+'",'+e;c+=o+'"Result":'+Prez.GetResult()+","+e;c+=o+'"Details":['+e;h=ReportUI.GetReportResult();a=h.length;for(f=0;f<a;++f){s=h[f];c+=o+o+"{"+e;c+=o+o+o+'"SlideIndex":'+(parseInt(s.slideidx)+1)+","+e;c+=o+o+o+'"ReportID":"'+s.reportid+'",'+e;c+=o+o+o+'"Attempts":'+s.attempts+","+e;c+=o+o+o+'"Points":'+s.points+","+e;c+=o+o+o+'"MaxPoints":'+s.maxPoints+","+e;c+=o+o+o+'"Result":"'+s.strJudge+'",'+e;c+=o+o+o+'"Type":"'+s.strType+'",'+e;c+=o+o+o+'"Answers":"'+s.answers+'"'+e;if(f==a-1){c+=o+o+"}"+e}else{c+=o+o+"},"+e}}c+=o+"]"+e;c+="}";break}return c},GetImage:function(a){return"data/img_"+this.Session.SlideIndex+"."+a+".png"},GetSlideImage:function(a){return"data/slide_"+a+"."+Options.image_format},GetResource:function(b,a){return"data/res_"+b+"."+a},Zoom:function(d){if(d==this.Scale){return}if(ZoomUI.Scale!=1){var c=$(ZoomUI.GetElement());var a=c.position();c.css({top:a.top*d/Prez.Scale,left:a.left*d/Prez.Scale})}this.Scale=d;d*=ZoomUI.Scale;var b,e;if(this.preSlideUI){b=this.preSlideUI.allCtrlUIs;for(e in b){b[e].Zoom(d,true)}}if(this.prjSldUI){this.prjSldUI.ZoomPointerEffect(d);b=this.prjSldUI.allCtrlUIs;for(e in b){b[e].Zoom(d,true)}}if(this.slideUI){b=this.slideUI.allCtrlUIs;for(e in b){b[e].Zoom(d,true)}}ClosedCaptionUI.Zoom()},GetMediaUI:function(b){var a=this.slideUI?this.slideUI.GetMediaUI(b):null;if(!a&&this.prjSldUI){a=this.prjSldUI.GetMediaUI(b)}return a}};EvtMan.StopEvent=function(b){b=$.event.fix(b||window.event||{});b.preventDefault();b.stopPropagation();try{if(b.originalEvent){b.originalEvent.keyCode=0}}catch(a){}return false};EvtMan.DoActions=function(d,c){var e=d.length;if(e>0){var a=-1;function b(){if(++a<e){var f=d[a];if(c&&(f.type==ActType.CONTINUE||d.type==ActType.SKIP)){c.SetWaited(true)}EvtMan.DoAction(f,b)}}b()}};EvtMan.DoAction=function(b,f){var a;switch(b.type){case ActType.WAIT:Prez.Pause(PrezStreams.MAIN);break;case ActType.SKIP:case ActType.CONTINUE:Prez.Resume(PrezStreams.ALL);break;case ActType.END:Prez.OnPrezEnd(false);return;case ActType.SUBMIT:if(!b.dat||b.dat<=0){Prez.slideUI.Submit()}else{a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a&&a.Submit){a.Submit()}}break;case ActType.CLEAR_INPUT:if(!b.dat||b.dat<=0){Prez.slideUI.ClearUserInput(true)}else{a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a&&a.ClearUserInput){a.ClearUserInput(true)}}break;case ActType.SHOW_NON_BLOCKING:a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a&&a.ctrl.duration!=0){a.Update(true);a.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true)}break;case ActType.SHOW:a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a&&a.ctrl.duration!=0){if(a.ctrl.duration<0){a.ctrl.duration=3000}if(a.ctrl.flags&CtrlFlags.LOOP){a.ctrl.flags&=~CtrlFlags.LOOP}if(f){a.SetOnHideCallback(f)}a.Update(true);a.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true);return}break;case ActType.PLAY_AUDIO:a=b.audioUI;if(a){a.Update(true);a.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true)}break;case ActType.HIDE:a=Prez.slideUI.GetCtrlUI(b.dat,true);if(a){a.SetHiddenByEvent(true);a.Hide(true)}break;case ActType.EMAIL:try{if(!b.dat.fullMail){if(!b.dat.to){b.dat.to=""}var m="mailto:"+encodeURIComponent(b.dat.to)+"?";if(b.dat.subject){m+="subject="+encodeURIComponent(b.dat.subject)+"&"}if(b.dat.cc){m+="cc="+encodeURIComponent(b.dat.cc)+"&"}if(b.dat.bcc){m+="bcc="+encodeURIComponent(b.dat.bcc)+"&"}if(b.dat.body){m+="body="+encodeURIComponent(b.dat.body)+"&"}b.dat.fullMail=m}var c=window.open(b.dat.fullMail,"_blank");if(c){setTimeout(function(){if(c){c.close()}},1000)}}catch(d){var g=Lang.CouldnotSendMail+b.dat.to;if(d instanceof Error){g+="<br /><br />"+d.name+": "+d.message}else{if(d.toString){g+="<br /><br />"+d.toString()}}UI.ShowMsg(g)}break;case ActType.WEB:try{if(!b.dat.specs){b.dat.specs=""}var k=window.open(b.dat.url,encodeURIComponent(b.dat.name),b.dat.specs);if(!k){var e=Lang.CouldnotOpenWeb+b.dat.url+Lang.DisablePopupBlocker;e+='<b><a href="'+b.dat.url+'" target="'+b.dat.name+'">'+b.dat.url+"</a></b>";UI.ShowMsg(e)}else{k.focus()}}catch(d){var g=Lang.CouldnotOpenWeb+b.dat.url;if(d instanceof Error){g+="<br /><br />"+d.name+": "+d.message}else{if(d.toString){g+="<br /><br />"+d.toString()}}UI.ShowMsg(g)}break;case ActType.SCRIPT:try{var l=g_userScripts[b.dat];if(l){l()}}catch(d){var g=Lang.CouldnotRunAction+b.dat;if(d instanceof Error){g+="<br /><br />"+d.name+": "+d.message}else{if(d.toString){g+="<br /><br />"+d.toString()}}UI.ShowMsg(g)}break;case ActType.SLIDE_ID:Prez.ShowSlideByID(b.dat);return;case ActType.SLIDE_IDX:Prez.ShowSlideByIndex(b.dat);return;case ActType.NEXT:Prez.ShowSlideByIndex(Prez.Session.SlideIndex+parseInt(b.dat));return;case ActType.PREV:var h=Prez.Session.SlideIndex-parseInt(b.dat);if(h>=0){Prez.ShowSlideByIndex(h)}return}if(f){f()}};EvtMan.SubmitCode={AUTO:-1,MANUAL:-2};function EvtMan(a){this.evt=a;this.curAtp=0}EvtMan.prototype={constructor:EvtMan,IsEnabled:function(){return !this.timeout&&(this.evt.atp<0||this.evt.atp>this.curAtp||this.evt.atp===undefined)},IsLastAttempt:function(){return(this.evt.atp==this.curAtp)&&(this.curAtp>0)},SetTimeExpired:function(){this.timeout=true},Update:function(){this.timeout=false},GetResponse:function(r,a,k,b,g){var d={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(!b){b=this}if(g===undefined){g=true}var h=!(b.evt.mod&EvtMode.SURVEY);var m=this.evt[r];var q=r==EvtType.TEXT&&a=="";var f=false;switch(r){case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:if(h){if(!m||!m.length){if(r!=EvtType.TEXT||a==""){d.jud=Judge.CORRECT;d.pt=this.evt.pt;if(g){d.acts=b.GetActions(EvtType.CORRECT)}}else{d.jud=Judge.WRONG;if(g){d.acts=b.GetActions(EvtType.WRONG)}}}else{for(var e=0,c=m.length;e<c;++e){var l=InputUI.CheckEvtValue(r,a,m[e].val,k);if(l==Judge.PARTIAL_CORRECT&&r==EvtType.TEXT){if(this.evt.submit!=EvtMan.SubmitCode.AUTO){l=Judge.WRONG}}if(l!=Judge.WRONG){d.jud=l;if(l==Judge.CORRECT){if(this.evt.mod&EvtMode.PARTIAL_SCORE){d.pt=m[e].pt}else{d.pt=this.evt.pt}if(this.evt.mod&EvtMode.PARTIAL_ACTION){d.acts=m[e].acts}if(g){d.acts=d.acts.concat(b.GetActions(EvtType.CORRECT))}break}}}if(d.jud==Judge.UNEXPECTED||(q&&d.jud==Judge.PARTIAL_CORRECT)){if(q){var p=b.GetActions(EvtType.INCOMPLETE);f=(p.length>0);if(g){d.acts=p}}if(f){d.jud=Judge.INCOMPLETE}else{if(d.jud==Judge.UNEXPECTED){d.jud=Judge.WRONG;if(g){d.acts=b.GetActions(EvtType.WRONG)}}}}}}else{if(q){var p=b.GetActions(EvtType.INCOMPLETE);f=(p.length>0);if(g){d.acts=p}}if(f){d.jud=Judge.INCOMPLETE}else{d.jud=Judge.NEUTRAL;if(g){d.acts=b.GetActions(EvtType.COMPLETE)}}}break;case EvtType.REJECT:if(h){d.jud=Judge.WRONG;
d.acts=this.GetActions(EvtType.REJECT);if(g){d.acts=d.acts.concat(b.GetActions(EvtType.WRONG))}}break;case EvtType.ACCEPT:if(h){d.jud=Judge.CORRECT;var o=null;if(a&&a.ctrl){o=this.GetEvent(EvtType.ACCEPT_SPECIFIC,a.ctrl.id)}if(o){if(this.evt.mod&EvtMode.PARTIAL_SCORE){d.pt=o.pt}else{d.pt=this.evt.pt}if(this.evt.mod&EvtMode.PARTIAL_ACTION){d.acts=o.acts||[]}d.acts=d.acts.concat(this.GetActions(EvtType.ACCEPT))}else{d.pt=this.evt.pt}if(g){d.acts=d.acts.concat(b.GetActions(EvtType.CORRECT))}}else{d.jud=Judge.NEUTRAL;if(g){d.acts=b.GetActions(EvtType.COMPLETE)}}break}return d},GetFirstEventValue:function(b){var a=this.evt[b];if(a&&a.length){return a[0].val}if(b==EvtType.TEXT){return""}return 0},GetPoints:function(e,c){if(e===undefined){return this.evt.pt||0}var a=this.evt[e];if(!a){return 0}if(c===undefined){return(a.all&&a.all.pt)||0}switch(e){case EvtType.TEXT:case EvtType.CLICK:case EvtType.KEY_DOWN:for(var b=0,d=a.length;b<d;++b){if(a[b].val==c){return a[b].pt||0}}return 0;default:return(a[c]&&a[c].pt)||0}},GetMaxPoints:function(g){if(this.evt.ptMax!==undefined){return this.evt.ptMax}var b=0;if(this.evt.mod&EvtMode.PARTIAL_SCORE){var a=this.evt[g],d;if(a&&(typeof a==="object")){if($.isArray(a)){for(var c=0,f=a.length;c<f;++c){d=a[c].pt;if(d>b){b=d}}}else{for(var e in a){d=a[e].pt;if(d>b){b=d}}}}}else{b=this.evt.pt||0}return(this.evt.ptMax=b)},GetActions:function(g,d){var b=this.evt[g];if(!b){return[]}if(d===undefined&&g!=EvtType.WRONG){return(b.all&&b.all.acts)||[]}switch(g){case EvtType.WRONG:var e=[];if(d===undefined){d=this.curAtp+1}var c=d==this.evt.atp;if(b[d]){e=b[d].acts}if(d>0){if(b[AtpType.ALL]){e=e.concat(b[AtpType.ALL].acts)}if(!c&&b[AtpType.ALL_BUT_LAST]){e=e.concat(b[AtpType.ALL_BUT_LAST].acts)}if(c&&b[AtpType.LAST]){e=e.concat(b[AtpType.LAST].acts)}if(e.length==0&&b[AtpType.OTHERS]){e=b[AtpType.OTHERS].acts}}return e||[];case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:for(var a=0,f=b.length;a<f;++a){if(b[a].val===d){return b[a].acts||[]}}return[];default:return(b[d]&&b[d].acts)||[]}},HasEvent:function(b,a){return !!this.GetEvent(b,a)},GetEvent:function(e,c){var b=this.evt[e];if(!b){return null}switch(e){case EvtType.WRONG:if(c===undefined){c=this.curAtp+1}return b[c]||null;break;case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:for(var a=0,d=b.length;a<d;++a){if(b[a].val===c){return b[a]}}break;default:if(c===undefined){c="all"}return b[c]||null;break}return null},CreatePlayedAudioUIs:function(f){if(!EvtMan._ctrlAudio){EvtMan._ctrlAudio={kind:CtrlKind.AUDIO,startTime:-1,duration:-1,showMode:PlayModes.DEMO|PlayModes.TUT|PlayModes.PRAC|PlayModes.TEST,flags:CtrlFlags.NOT_WAIT,rect:{t:0,l:0,w:2,h:2}}}var l,h,k,e,d,a,c,b,g;for(l in this.evt){h=this.evt[l];if(!h||(typeof h!=="object")){continue}if($.isArray(h)){for(e=0,a=h.length;e<a;++e){k=h[e].acts;if(k){for(d=0,c=k.length;d<c;++d){if(k[d].type==ActType.PLAY_AUDIO){b=$.extend({},EvtMan._ctrlAudio);b.audio=k[d].dat;if(!f._evtAudioId){f._evtAudioId=1}b.id="evt_audio_"+f._evtAudioId;++f._evtAudioId;g=f.CreateControl(b);k[d].audioUI=g;if(g){g.Attach(f);if(!g.IsTriggeredByEvent()){f.ctrlUIs.push(g)}}}}}}}else{for(e in h){if(h[e]&&h[e].acts){k=h[e].acts;for(d=0,c=k.length;d<c;++d){if(k[d].type==ActType.PLAY_AUDIO){b=$.extend({},EvtMan._ctrlAudio);b.audio=k[d].dat;if(!f._evtAudioId){f._evtAudioId=1}b.id="evt_audio_"+f._evtAudioId;++f._evtAudioId;g=f.CreateControl(b);k[d].audioUI=g;if(g){g.Attach(f);if(!g.IsTriggeredByEvent()){f.ctrlUIs.push(g)}}}}}}}}},CleanUp:function(){}};SlideUI.currentLayerIdx=1;SlideUI.ClearLayer=function(c,b){var a=UI.GetSlideLayerID(c);$("#"+a+" > :not(.ap-ctrl-media,.ap-wmk)").remove();$("#"+a+" > .ap-ctrl-media").hide();if(b){$("#"+a+"_bg").remove()}};SlideUI.GetOtherLayerIndex=function(a){if(a==1){return 2}return 1};SlideUI.projSldID="sld_prj";function SlideUI(f){this.slide=f;this.isPrjSld=f==Prez.prjSlide;if(this.isPrjSld){this.layerIdx=3;this.id=SlideUI.projSldID;if(BrowserInfo.canPlayMultiSounds&&f.clkSounds&&f.clkSounds.length){this.clkSoundId=this.GetDOMCtrlID("clkSound");this.clkSounds=f.clkSounds;this.clkSoundPlayer=null;this.clkSoundPaused=false;this.bIncBuffCount=false;this.lastDOMId=this.clkSoundId}this.pointerEffectId="fg_pointerEffect";this.pointerEffectCurRect={x:0,y:0,w:1,h:1};this.pointerEffectRenderer=new PointerEffect();var l=mediaStats.nMaxProjSlideAudio+mediaStats.nMaxSlideAudio;if(l>0){this.lastDOMId=MediaManager.GetPlayerContainerId(l-1,this.id,true)}$("#"+this.pointerEffectId).remove();var g='<div id="'+this.pointerEffectId+'" style="position:absolute;left:0px;top:0px;width:1px;height:1px;display:none;overflow:hidden;z-index:'+ZIndexBase.ClickEffects+';"><img id="'+this.pointerEffectId+'_bg" src="'+UI.BlankImgUrl()+'" alt="'+Lang.ClickEffect+'" style="position:absolute;top:0px;left:0px;"/><canvas id="'+this.pointerEffectId+'_canvas" width="100%" height="100%" style="position:absolute;top:0px;left:0px;width:100%;height:100%;"></canvas></div>';UI.$Slides.append(g);$("#"+this.id).remove();var h="";h+='<div class="slide" id="'+this.id+'" style="z-index:'+ZIndexBase.SlidePrjCtrls+';">';if(this.clkSoundId){h+=MediaManager.CreatePlayerElements2(this.clkSoundId,true)}for(e=0;e<mediaStats.nMaxProjSlideAudio+mediaStats.nMaxSlideAudio;++e){h+=MediaManager.CreatePlayerElements(e,this.id,true)}for(e=0;e<mediaStats.nMaxProjSlideVideo;++e){h+=MediaManager.CreatePlayerElements(e,this.id,false)}h+="</div>";UI.$Slides.append(h)}else{this.layerIdx=SlideUI.GetOtherLayerIndex(SlideUI.currentLayerIdx);SlideUI.currentLayerIdx=this.layerIdx;this.id=UI.GetSlideLayerID(this.layerIdx);SlideUI.ClearLayer(this.layerIdx);this.wmkid="appwmk"+this.layerIdx}this.bgId=this.id+"_bg";$("#"+this.bgId).remove();if(!this.isPrjSld){UI.$Slides.append('<img id="'+this.bgId+'" style="display:none;" class="bgimg" src="'+Prez.GetSlideImage(this.slide.idx)+'" alt="'+(this.slide.acctext||"")+'" width="100%" height="100%" />')}this.ts=-1;this.ctrlUIs=[];this.allCtrlUIs={};this.mapNameCtrlUIs={};this.inputUIs=[];this.triggeredUIs=[];this.zoomUI=null;this.CCaption=null;this.nVideoPlayerIndex=0;this.nSoundPlayerIndex=(this.isPrjSld?0:mediaStats.nMaxProjSlideAudio);var m=f.ineff;if(m&&!m.inited){EffectMan.InitEffect(m,{t:0,l:0,w:UI.slideW,h:UI.slideH});m.inited=true}var d=f.ctrls;var e,a=d.length;for(e=0;e<a;++e){var c=this.CreateControl(d[e]);if(c){c.Attach(this);if(!c.IsTriggeredByEvent()){this.ctrlUIs.push(c)}}}if(f.cursor){f.cursor.kind=CtrlKind.CURSOR;var k=this.CreateControl(f.cursor);if(k){k.Attach(this);this.ctrlUIs.push(k)}}if(f.ccaption&&(g_closedCaption.modes&Prez.Session.PMode)){this.CCaption=new SlideCCaptionUI(f.ccaption,this)}if(f.zoomAreas){this.zoomUI=new ZoomUI(f.zoomAreas,this)}for(var b in this.allCtrlUIs){this.allCtrlUIs[b].OnAttached()}}SlideUI.prototype={constructor:SlideUI,GetDOM:function(){return $("#"+this.id)},GetIndex:function(){return this.slide.idx},GetAudioPlayerId:function(){var a=MediaManager.GetPlayerContainerId(this.nSoundPlayerIndex,SlideUI.projSldID,true);this.nSoundPlayerIndex++;return a},GetVideoPlayerId:function(){var a=MediaManager.GetPlayerContainerId(this.nVideoPlayerIndex,this.id,false);this.nVideoPlayerIndex++;return a},CreateControl:function(b,a){if(!b){return null}var d=true;if(!a||b.startTime<0){d=(b.showMode&Prez.Session.PMode)==Prez.Session.PMode}if(!d&&b.kind!=CtrlKind.BUTTON&&b.kind!=CtrlKind.INPUT&&b.kind!=CtrlKind.DROP){return null}var c=null;switch(b.kind){case CtrlKind.TEXTINPUT:c=new TxtInputUI(b,this,a);break;case CtrlKind.TOGGLE:c=new ToggleUI(b,this,a);break;case CtrlKind.BUTTON:b.type=InputUI.MOUSE;b.flags=CtrlFlags.FOCUSABLE;case CtrlKind.INPUT:c=new InputUI(b,this,a);break;case CtrlKind.DROP:c=new DropAreaUI(b,this,a);break;case CtrlKind.GESTURE:c=new GestureUI(b,this,a);break;case CtrlKind.ANSWER:c=new AnswerUI(b,this,a);break;case CtrlKind.QUIZ:c=new QuizUI(b,this,a);break;case CtrlKind.AUDIO:case CtrlKind.VIDEO:c=new MediaUI(b,this,a);break;case CtrlKind.CURSOR:c=new CursorUI(b,this,a);break;case CtrlKind.FEEDBACK:c=new FeedbackUI(b,this,a);
break;default:c=new CtrlUI(b,this,a);break}if(c){this.allCtrlUIs[c.ctrlKey]=c;if(this.mapNameCtrlUIs[c.ctrl.name]){window.console&&console.log("Object name isn't unique: "+c.ctrl.name)}else{this.mapNameCtrlUIs[c.ctrl.name]=c}}return c},GetDOMCtrlID:function(a){return"ctrl_"+this.layerIdx+"_"+a},GetCtrlUI:function(a,b){if(b){a=this.GetDOMCtrlID(a)}return this.allCtrlUIs[a]},GetObject:function(a){return this.mapNameCtrlUIs[a]},GetMediaUI:function(a){if(a==this.clkSoundId){return this}return this.allCtrlUIs[a]},_IncBufCount:function(){if(this.cleaned){return}if(!this.bIncBuffCount){this.bIncBuffCount=true;Prez.IncBufferingCount()}},_DecBufCount:function(){if(this.cleaned){return}if(this.bIncBuffCount){this.bIncBuffCount=false;Prez.DecBufferingCount()}},CreateClickSoundPlayer:function(){if(!this.clkSoundId){return}var b="";for(i=0,nCount=this.clkSounds.length-1;i<nCount;++i){b+="data/res_"+this.clkSounds[i]+"."+MediaManager.strAudioExt+","}b+="data/res_"+this.clkSounds[i]+"."+MediaManager.strAudioExt;var a={context:this,ready:function(){this._OnPlayerReady()},end:function(){},statechanged:function(){this._OnPlayerStateChanged()}};$("#"+this.clkSoundId).show();this.clkSoundPlayer=MediaManager.CreatePlayer({files:b,mode:"audio"},this.clkSoundId,a)},PlayClickSound:function(a){if(!BrowserInfo.canPlayMultiSounds){return}if(!this.clkSoundPlayer){this.CreateClickSoundPlayer()}if(this.clkSoundPlayer){$(this).stopTime("playclicksound");$(this).oneTime(1,"playclicksound",function(){this.needPlayClickSound=true;var b=$.inArray(a,this.clkSounds);if(b>=0){this.clkSoundPlayer.LoadItem(b);var c=this.clkSoundPlayer.GetState();Log("PlayClickSound Player State: "+c);if(c==MediaStates.NOT_READY||c==MediaStates.OPENING||c==MediaStates.BUFFERING||c==MediaStates.CLOSED){}else{if(c!=MediaStates.ERROR){if(Prez.runningStreams!=PrezStreams.NONE){this.clkSoundPlayer.Play(true)}this.needPlayClickSound=false}}}})}},_OnPlayerReady:function(){return;if(this.clkSoundPlayer&&BrowserInfo.canPlayMultiSounds){$("#"+this.clkSoundPlayer.GetId()).attr("tabindex","-1");this.clkSoundPlayer.SetVolume(Prez.GetVolume(true));var a=this.clkSoundPlayer.GetState();Log("Mouse Click Sound _OnPlayerReady | State: "+a);if(a==MediaStates.NOT_READY||a==MediaStates.OPENING||a==MediaStates.BUFFERING||a==MediaStates.CLOSED){this._IncBufCount()}else{this._DecBufCount()}}},_OnPlayerStateChanged:function(){if(!this.needPlayClickSound){return}if(!BrowserInfo.canPlayMultiSounds){return}if(!this.clkSoundPlayer){return}var a=this.clkSoundPlayer.GetState();if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){if(Prez.runningStreams!=PrezStreams.NONE){this.clkSoundPlayer.Play(true)}this.needPlayClickSound=false}},PlayPointerEffect:function(m,d,g,o,v,e,q,f,r,b,p){var u="rgba("+((q>>16)&255)+", "+((q>>8)&255)+", "+(q&255)+", "+(((q>>24)&255)/255).toFixed(6)+")";if(b<0){return}$(this).stopTime("pointer_effect");var a=$("#"+this.pointerEffectId);var t=$("#"+this.pointerEffectId+"_bg");var h=$("#"+this.pointerEffectId+"_canvas");g-=v/2;o-=e/2;this.pointerEffectCurRect={x:g,y:o,w:v,h:e};var n=Prez.Scale*ZoomUI.Scale;a.hide();a.css({left:g*n+"px",top:o*n+"px",width:v*n+"px",height:e*n+"px"});var c=document.getElementById(this.pointerEffectId+"_canvas");var l=(c&&c.getContext&&typeof(c.getContext)==="function")?c.getContext("2d"):null;if(l){t.hide();h.show();h.attr("width",v).attr("height",e);var k=this.pointerEffectRenderer;$(this).everyTime(b,"pointer_effect",function(s){if(s==1){a.show()}if(s>=p){a.hide()}if(m){k.RenderMouseEffect(l,d,v/2,e/2,s/p,u,f)}else{k.RenderTouchEffect(l,d,v/2,e/2,s/p,u)}},p)}else{h.hide();t.show();t.attr("src","data/"+r).css({left:"0%",top:"0%",width:100*p+"%",height:"100%"});$(this).everyTime(b,"pointer_effect",function(s){a.css("overflow","hidden");t.css("left",-(s*100)+"%");if(s==1){a.show()}if(s>=p){a.hide()}},p)}},ZoomPointerEffect:function(b){var a=this.pointerEffectCurRect;$("#"+this.pointerEffectId).css({left:a.x*b+"px",top:a.y*b+"px",width:a.w*b+"px",height:a.h*b+"px"})},Mute:function(a){for(var b in this.allCtrlUIs){this.allCtrlUIs[b].Mute(a)}if(this.clkSoundPlayer){this.clkSoundPlayer.SetVolume(a?0:Prez.GetVolume())}},SetVolume:function(a){for(var b in this.allCtrlUIs){this.allCtrlUIs[b].SetVolume(a)}if(this.clkSoundPlayer){this.clkSoundPlayer.SetVolume(a)}},Raise:function(){if(!this.isPrjSld){var a=UI.GetSlideLayerID(SlideUI.GetOtherLayerIndex(this.layerIdx));$("#"+a+"_bg").css("z-index",ZIndexBase.SlideBgrOld);$("#"+a).css("z-index",ZIndexBase.SlideCtrlsOld);$("#"+this.bgId).css("z-index",ZIndexBase.SlideBgrNew);$("#"+this.id).css("z-index",ZIndexBase.SlideCtrlsNew)}},Show:function(c,g){if(!this.isPrjSld){Prez.Session.SlideIndex=this.slide.idx}this.inputUIs.length=0;this.triggeredUIs.length=0;this.ts=c||0;var d=$("#"+this.id),b=$("#"+this.bgId),f=this;if(this.slide.ineff&&this.ts<this.slide.ineff.duration){if(this.isPrjSld){EffectMan.Stop(d[0],false)}else{EffectMan.Stop(b[0],false);EffectMan.Stop(d[0],false);this.Raise()}this._Update();b.show();d.show();var a={exitEffect:false,secondStream:false,startTime:this.ts};if(!this.isPrjSld){EffectMan.Start(b[0],this.slide.ineff,a)}a.callback=function(){f._OnShow();if(g){g.call(this)}};EffectMan.Start(d[0],this.slide.ineff,a)}else{if(!this.isPrjSld){EffectMan.Stop(b[0],true,false);this.Raise();b.show()}EffectMan.Stop(d[0],true,false);d.show();this._Update();this._OnShow();if(g&&d[0]){g.call(d[0])}}for(var e in this.allCtrlUIs){this.allCtrlUIs[e]._FixSize()}},_Update:function(){if(!this.isPrjSld){var b,a=this.ctrlUIs.length;for(b=0;b<a;++b){this.ctrlUIs[b].SetWaited(false)}this.WaitIfNeed(this.ts-1,this.ts)}if(this.zoomUI){this.zoomUI.Update()}else{if(!this.isPrjSld){ZoomUI.Reset()}}for(var c in this.allCtrlUIs){this.allCtrlUIs[c].Update()}if(this.CCaption){this.CCaption.Update()}else{if(!this.isPrjSld){ClosedCaptionUI.ClearCaption()}}if(!this.isPrjSld){if(this.slide.onload!==undefined){EvtMan.DoAction({type:ActType.SCRIPT,dat:this.slide.onload})}}},_OnShow:function(){if(!this.isPrjSld){$(this).oneTime(500,"removeprev",function(){SlideUI.ClearLayer(SlideUI.GetOtherLayerIndex(SlideUI.currentLayerIdx),true)})}if(!this.isPrjSld){if(this.slide.wm){$("#"+this.wmkid).show()}else{$("#"+this.wmkid).hide()}}if(!this.isPrjSld){CanvasNav.Focus(false)}},UpdatePrezStateChanged:function(){if(this.cleaned){return}var b,a,c;c=this.triggeredUIs;for(b=0,a=c.length;b<a;++b){c[b].UpdatePrezStateChanged()}c=this.ctrlUIs;for(b=0,a=c.length;b<a;++b){c[b].UpdatePrezStateChanged()}if(this.CCaption){this.CCaption.UpdatePrezStateChanged()}},WaitIfNeed:function(d,f){var c,b=this.ctrlUIs.length,e,a,g;for(c=0;c<b;++c){e=this.ctrlUIs[c];a=e.GetWaitingTS();if(!isNaN(a)&&d<a&&a<=f){e.SetWaited(true);if(isNaN(g)){g=a}else{if(a>g){g=a}}}}if(!isNaN(g)){Prez.Pause(PrezStreams.MAIN)}return g},Tick:function(){if(this.zoomUI){this.zoomUI.Tick()}var a=this.ctrlUIs.length;for(var b=0;b<a;++b){this.ctrlUIs[b].Tick()}if(this.CCaption){this.CCaption.Tick()}},IsEnd:function(){return this.slide.duration<=this.ts},CleanUp:function(){$(this).stopTime();if(!this.isPrjSld){EffectMan.Stop($("#"+this.bgId)[0],true,false)}else{$(this).stopTime("pointer_effect");$("#"+this.pointerEffectId).remove();this.pointerEffect=null}EffectMan.Stop($("#"+this.id)[0],true,false);if(this.zoomUI){this.zoomUI.CleanUp()}for(var a in this.allCtrlUIs){this.allCtrlUIs[a].CleanUp()}if(this.CCaption){this.CCaption.CleanUp()}if(this.clkSoundPlayer){this.clkSoundPlayer.CleanUp();this.clkSoundPlayer=null;this.clkSounds=null;$("#"+this.clkSoundId).hide()}this.ctrlUIs.length=0;this.inputUIs.length=0;this.triggeredUIs.length=0;this.CCaption=null;this.zoomUI=null;this.cleaned=true},Submit:function(){var c,b,a=this.ctrlUIs.length;for(b=0;b<a;++b){c=this.ctrlUIs[b];if(c.showState!=CtrlShowState.HIDE&&c.Submit&&c.evtMan&&c.ctrl.evt.submit!=EvtMan.SubmitCode.AUTO){c.Submit()}}},ClearUserInput:function(a){var d,c,b=this.ctrlUIs.length;for(c=0;c<b;++c){d=this.ctrlUIs[c];if(d.showState!=CtrlShowState.HIDE&&d.ClearUserInput){d.ClearUserInput(a)
}}},AddInputUI:function(a){if($.inArray(a,this.inputUIs)==-1){this.inputUIs.push(a)}},RemoveInputUI:function(b){var a=$.inArray(b,this.inputUIs);if(a>-1){this.inputUIs.splice(a,1)}},AddTriggeredUI:function(a){if($.inArray(a,this.triggeredUIs)==-1){this.triggeredUIs.push(a)}},RemoveTriggeredUI:function(b){var a=$.inArray(b,this.triggeredUIs);if(a>-1){this.triggeredUIs.splice(a,1)}},LoadSubmitedData:function(){var c=Prez.Session.RestoreData.slides;if(!c){return}var d=c[this.slide.idx];if(!d){return}var a=this.ctrlUIs.length;for(var b=0;b<a;++b){this.ctrlUIs[b].LoadSubmitedData(d)}},GetSubmitedDataObject:function(){var a=Prez.Session.RestoreData.slides;if(!a){a=[];Prez.Session.RestoreData.slides=a}var b=a[this.slide.idx];if(!b){b={};a[this.slide.idx]=b}return b},AcceptResumeToken:function(){for(var b in this.allCtrlUIs){var a=this.allCtrlUIs[b];if(a.AcceptResumeToken&&a.AcceptResumeToken()){return true}}return false}};CtrlUI.GenCSSRect=function(a,b){return"top:"+(b*a.t)+"px;left:"+(b*a.l)+"px;width:"+(b*a.w)+"px;height:"+(b*a.h)+"px;"};function CtrlUI(d,a,c){this.ctrl=d;this.parentUI=c;this.slideUI=a;this.ctrlKey=a.GetDOMCtrlID(d.id);this.id=this.ctrlKey;this.inputId=this.id;if(this.ctrl.flags&CtrlFlags.DRAGGABLE){this.inputId=this.id+"_inp"}this.waited=false;if(d.fshtml!==undefined){d.html=d.fshtml;d.css=d.fscss;if(Options.zoom_percent!=100){ScaleFont(d,Options.zoom_percent/100)}d.fshtml=undefined;d.fscss=undefined}this.showState=CtrlShowState.HIDE;if(d.evt){this.evtMan=new EvtMan(d.evt);this.evtMan.CreatePlayedAudioUIs(a)}this.InitEffects(true);this.role="alert";this.bIncBuffCount=false;if(!this.parentUI&&this.ctrl.startTime>=0){if(this.ctrl.duration<0||((this.ctrl.flags&CtrlFlags.LOOP)&&this.ctrl.duration>0)){if(this.startOut!==undefined){this.endTime=this.slideUI.slide.duration}else{this.endTime=-1}}else{this.endTime=this.ctrl.startTime+this.ctrl.duration;if(this.endTime>=this.slideUI.slide.duration-100&&this.startOut===undefined){this.endTime=-1}}}if(d.audio&&d.kind!=CtrlKind.AUDIO){var b=(d.kind==CtrlKind.BUTTON||(d.kind==CtrlKind.INPUT&&d.type==InputUI.MOUSE));if(!b){this.playerId=a.GetAudioPlayerId()}}if((d.flags&(CtrlFlags.DROPPABLE|CtrlFlags.DRAGGABLE))==CtrlFlags.DROPPABLE){this.dropHelper=new DropHelper(this)}}$.extend(CtrlUI.prototype,{constructor:CtrlUI,GetParent:function(){return this.parentUI},SetParent:function(a){this.parentUI=a},GetTopLevel:function(){var b=this,a=this.parentUI;while(a){b=a;a=a.parentUI}return b},IsTopLevel:function(){return !this.parentUI},IsEnabled:function(a){if(this.cleaned){return false}if(!a&&Prez.runningStreams==PrezStreams.NONE){return false}if(Prez.Session.PMode&PlayModes.DEMO){return false}if(this.evtMan&&(this.evtMan.evt.mod&EvtMode.INDEPENDENT)){return this.evtMan.IsEnabled()}var b=this.GetTopLevel();if(b.evtMan){return b.evtMan.IsEnabled()}if(this.ctrl.flags&(CtrlFlags.DROPPABLE|CtrlFlags.DRAGGABLE)){return true}return false},IsShown:function(){return(this.showState!=CtrlShowState.HIDE)&&(!this.parentUI||this.parentUI.IsShown())},IsTriggeredByEvent:function(){return this.ctrl.startTime<0},GetSlide:function(){return this.slideUI},GetEventMan:function(){return this.evtMan},GetDOM:function(){return $("#"+this.id)},SetText:function(d){this.ctrl.html=d;var c=Prez.Scale*ZoomUI.Scale,a=$("#"+this.id+"_lb"),b;if(this.scale!==undefined){c*=this.scale}b=this.GetLabelHTML(c);if(a.length){a.replaceWith(b)}else{this.GetDOM().append(b)}},GetText:function(a){return a?$("#"+this.id+"_lb").text():$("#"+this.id+"_lb").html()},GetLabelHTML:function(b){if(!this.ctrl.html){return""}if(b===undefined||b==1){return'<div id="'+this.id+'_lb" class="label" style="'+CtrlUI.GenCSSRect(this.ctrl.tr,1)+this.ctrl.css+'">'+this.ctrl.html+"</div>"}var a={html:this.ctrl.html,css:this.ctrl.css};ScaleFont(a,b);return'<div id="'+this.id+'_lb" class="label" style="'+CtrlUI.GenCSSRect(this.ctrl.tr,b)+a.css+'">'+a.html+"</div>"},GetHTML:function(){var c,a="";if(this.ctrl.acctext){a=this.ctrl.acctext}if(UI.IEBLOW){c='<img id="'+this.id+'_bg" class="bgimg" src="'+UI.BlankImgUrl()+'" alt="'+a+'" role="presentation" width="100%" height="100%" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src=\''+this.GetImg()+"');\" />"}else{c='<img id="'+this.id+'_bg" class="bgimg" src="'+this.GetImg()+'" alt="'+a+'" role="presentation" width="100%" height="100%" />'}var b="";if(this.id==this.inputId){b=this.GetARIAAttrs()}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,Prez.Scale)+'" aria-hidden="true" '+b+">"+c+this.GetLabelHTML(Prez.Scale)+this.GetInputHTML()+"</div>"},GetInputHTML:function(){if(this.inputId!=this.id){return'<div id="'+this.inputId+'" class="evtreceiver" '+this.GetARIAAttrs()+"></div>"}else{return""}},GetARIAAttrs:function(){var a="";if(this.role){a+=' role="'+this.role+'"'}if(this.ctrl.acctext){a+=' aria-label="'+this.ctrl.acctext+'"'}return a},Zoom:function(e,d){var a=$("#"+this.id)[0];if(!a){return}var b=a.style,c=this.ctrl.rect;if(d&&(this.showState!=CtrlShowState.SHOWING||(this.ctrl.ineff.type!=Effect.Type.FLY&&this.ctrl.ineff.type!=Effect.Type.PEEK))&&(this.showState!=CtrlShowState.HIDING||(this.ctrl.outeff.type!=Effect.Type.FLY&&this.ctrl.outeff.type!=Effect.Type.PEEK))){b.top=(e*(this.pos?this.pos.t:c.t))+"px";b.left=(e*(this.pos?this.pos.l:c.l))+"px"}if(this.scale!==undefined){e*=this.scale}b.width=(e*c.w)+"px";b.height=(e*c.h)+"px";if(this.ctrl.html){$("#"+this.id+"_lb").replaceWith(this.GetLabelHTML(e));this._FixSize()}},_FixSize:function(){if(!this.ctrl.html){return}if(!this.ctrl.autofit){return}var b=$("#"+this.id),d=$("#"+this.id+"_lb"),f,a,c=0,g=5,h,e;f=d.height();a=d.width();d.css("height","auto");while(c<=20){e=d.height();if(f+g>e){break}c++;d.width(a+5*c)}if(a+5*c+g>b.width()){b.width(a+5*c+g)}d.height(f)},GetIniProps:function(){return{opacity:this.opacity!==undefined?this.opacity:1,left:this.pos?this.pos.l:this.ctrl.rect.l,top:this.pos?this.pos.t:this.ctrl.rect.t}},GetPosition:function(){return{x:this.pos?this.pos.l:this.ctrl.rect.l,y:this.pos?this.pos.t:this.ctrl.rect.t}},SetPosition:function(a,c){this.ctrl.rect.l=a;this.ctrl.rect.t=c;delete this.pos;this.InitEffects(false);var b=Prez.Scale*ZoomUI.Scale;this.GetDOM().css({left:a*b,top:c*b})},InitEffects:function(e){var b=this.ctrl;var a,c={},d;if(this.opacity!==undefined){c.opacity=this.opacity}d=this.pos||b.rect;if(d){c.t=d.t;c.l=d.l}if(b.rect){c.w=b.rect.w;c.h=b.rect.h}if(this.scale!==undefined){c.w*=this.scale;c.h*=this.scale}d=this.transform||b.tf;if(d&&d.r){c.transform={r:d.r,oX:d.oX,oY:d.oY}}a=b.ineff;if(a){EffectMan.InitEffect(a,c);if(e){this.endIn=a.duration;if(b.startTime>0){this.endIn+=b.startTime}}}a=b.outeff;if(a){EffectMan.InitEffect(a,c);if(e){if(b.duration<0||((b.flags&CtrlFlags.LOOP)&&b.duration>0)){this.startOut=this.slideUI.slide.duration-a.duration}else{this.startOut=b.duration-a.duration;if(b.startTime>0){this.startOut+=b.startTime}}}}},Attach:function(a){if(a.lastDOMId===undefined){$("#"+a.id).prepend(this.GetHTML())}else{$("#"+a.lastDOMId).after(this.GetHTML())}a.lastDOMId=this.id},InitAudioPlayer:function(){if(this.ctrl.audio&&this.ctrl.kind!=CtrlKind.AUDIO&&this.ctrl.kind!=CtrlKind.BUTTON&&(this.ctrl.kind!=CtrlKind.INPUT||this.ctrl.type!=InputUI.MOUSE)){var b={context:this,ready:function(){this._OnPlayerReady()},end:function(){this._OnPlayerEnded()},statechanged:function(){this._OnPlayerStateChanged()}};var a={file:"data/res_"+this.ctrl.audio+"."+MediaManager.strAudioExt,mode:"audio"};$("#"+this.playerId).show();this.sound=MediaManager.CreatePlayer(a,this.playerId,b)}},OnAttached:function(){var g=this;if(this.ctrl.flags&CtrlFlags.DRAGGABLE){var d={rlCtrlUI:g,start:function(m,n){if(!Prez.slideUI||!g.IsEnabled()){return false}var h=g.GetDropCtrlUI(),p,o,q=Prez.Scale*ZoomUI.Scale,l=n.position.left+m.pageX-n.offset.left,k=n.position.top+m.pageY-n.offset.top;if(h&&h.dropHelper){h.dropHelper.StartDragOut(g,{mouseX:l,mouseY:k})}g.ClearDropCtrlUI();DropHelper.DragEffect(g,true,l,k);
p=parseFloat(g.GetDOM().css("left"))||0;o=parseFloat(g.GetDOM().css("top"))||0;g.dragOffsetX=(p-n.position.left)/q;g.dragOffsetY=(o-n.position.top)/q},drag:function(h,k){var l=Prez.Scale*ZoomUI.Scale;if(g.dragOffsetX){k.position.left+=g.dragOffsetX*l}if(g.dragOffsetY){k.position.top+=g.dragOffsetY*l}},stop:function(k,r){DropHelper.DragEffect(g,false,r.position.left+k.pageX-r.offset.left,r.position.top+k.pageY-r.offset.top);delete g.dragOffsetX;delete g.dragOffsetY;if(!Prez.slideUI){return}var p=g.GetDropCtrlUI();if(p&&p.dropHelper){var q={left:parseFloat(g.GetDOM().css("left"))||0,top:parseFloat(g.GetDOM().css("top"))||0};if(!p.dropHelper.Drop(g,q)){g.ClearDropCtrlUI()}}else{if(g.ctrl.dragOpt.revert){var m=Prez.Scale*ZoomUI.Scale;g.GetDOM().animate({top:g.ctrl.rect.t*m,left:g.ctrl.rect.l*m},DropHelper.RevertTime)}if(!g.parentUI){var h=Prez.slideUI.inputUIs,s;for(var o=0,l=h.length;o<l;++o){s=h[o];if(s.ctrl.kind==CtrlKind.DROP&&s.slideUI==Prez.slideUI){s.Submit(EvtType.REJECT,g)}}}}}};this.GetDOM().bind("mousedown",function(h){h.stopPropagation()}).draggable(d)}else{if(this.ctrl.flags&CtrlFlags.DROPPABLE){var e={tolerance:"pointer",activate:function(h,k){},deactivate:function(h,k){DropHelper.DropHoverEffect(g,false)},drop:function(k,l){if(!l.draggable.length||!Prez.slideUI||!g.IsEnabled()){return}var h=g.slideUI.GetCtrlUI(l.draggable[0].id,false);if(h&&h.parentUI==g.parentUI){h.SetDropCtrlUI(g)}},over:function(k,l){if(!l.draggable.length||!Prez.slideUI||!g.IsEnabled()){return}var h=g.slideUI.GetCtrlUI(l.draggable[0].id,false);if(h&&h.parentUI==g.parentUI){DropHelper.DropHoverEffect(g,true);g.MouseEnter()}},out:function(k,l){DropHelper.DropHoverEffect(g,false);if(!l.draggable.length||!Prez.slideUI||!g.IsEnabled()){return}var h=g.slideUI.GetCtrlUI(l.draggable[0].id,false);if(h&&h.parentUI==g.parentUI){g.MouseLeave()}}};if(this.ctrl.tf){e.rlTransform=this.ctrl.tf;e.rlRect=this.ctrl.rect}this.GetDOM().droppable(e)}}var c=this.ctrl.tf;if(c){this.GetDOM().css({transformOrigin:c.oX+"% "+c.oY+"%",transform:"rotate("+c.r+"deg)"})}if(this.evtMan&&!BrowserInfo.iDevice&&!BrowserInfo.android){var a=$("#"+this.inputId);var b=this.evtMan.GetActions(EvtType.MOUSE_ENTER);if(b.length){a.mouseenter(function(){g.MouseEnter()})}var f=this.evtMan.GetActions(EvtType.MOUSE_LEAVE);if(f.length){a.mouseleave(function(){g.MouseLeave()})}}},GetShowState:function(a,b){var c=this.ctrl.startTime;b.ctrlTs=a-c;if(this.hiddenByEvent){b.value=CtrlShowState.HIDE;return}if(a<c){b.value=CtrlShowState.HIDE}else{if(this.endIn&&a<this.endIn){b.value=CtrlShowState.SHOWING;b.ts=b.ctrlTs}else{if(this.startOut!==undefined){if(a<=this.startOut){b.value=CtrlShowState.SHOW}else{if(a<this.endTime){b.value=CtrlShowState.HIDING;b.ts=a-this.startOut}else{b.value=CtrlShowState.HIDE}}}else{if(this.endTime<0||a<=this.endTime){b.value=CtrlShowState.SHOW}else{b.value=CtrlShowState.HIDE}}}}},Show:function(a,e){if(!a||a.value===undefined){if(a||arguments.length==0){this.Update(true);this.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true)}else{this.SetHiddenByEvent(true);this.Hide(true)}return}var b=false;if((this.showState==CtrlShowState.HIDE||e)&&a.value!=CtrlShowState.HIDE){if(this.ctrl.startTime<0){this.slideUI.AddTriggeredUI(this)}$(this).stopTime("hide");if(e&&(this.ctrl.duration==0||(this.ctrl.duration>0&&!(this.ctrl.flags&CtrlFlags.LOOP)))&&(this.ctrl.outeff||(this.ctrl.kind!=CtrlKind.AUDIO&&this.ctrl.kind!=CtrlKind.VIDEO))){var f=this.ctrl.duration;if(this.ctrl.outeff){f-=this.ctrl.outeff.duration}$(this).oneTime(f,"hide",function(){this.Hide(true)})}$(this).stopTime("timelimit");if(this.evtMan&&!this.parentUI&&this.IsEnabled(true)){var h=this.ctrl.evt.timeLimit;if(h!==undefined&&h>=0){$(this).oneTime(h,"timelimit",function(){this._Timeout()})}}b=true}this.showState=a.value;var k=this,c=$("#"+this.id);var d=c[0];var g={secondStream:this.ctrl.startTime<0||this.hiddenByEvent,startTime:a.ts};switch(a.value){case CtrlShowState.SHOWING:EffectMan.Stop(d,false);EffectMan.Reset(d,this.GetIniProps());c.show().attr("aria-hidden","false");g.exitEffect=false;g.callback=function(){k.showState=CtrlShowState.SHOW};EffectMan.Start(d,this.ctrl.ineff,g);break;case CtrlShowState.HIDING:EffectMan.Stop(d,false);EffectMan.Reset(d,this.GetIniProps());c.show().attr("aria-hidden","false");g.exitEffect=true;g.callback=function(){k._OnHideComplete()};EffectMan.Start(d,this.ctrl.outeff,g);break;case CtrlShowState.HIDE:EffectMan.Stop(d,false);this._OnHideComplete();break;default:EffectMan.Stop(d,false);EffectMan.Reset(d,this.GetIniProps());c.show().attr("aria-hidden","false");break}if(b){this._FixSize();this._OnShowStart(a.ctrlTs)}},_IncBufCount:function(){if(this.cleaned){return}if(!this.bIncBuffCount){this.bIncBuffCount=true;Prez.IncBufferingCount()}},_DecBufCount:function(){if(this.cleaned){return}if(this.bIncBuffCount){this.bIncBuffCount=false;Prez.DecBufferingCount()}},_OnShowStart:function(c){$("#"+this.id).attr("aria-hidden","false");if(!this.sound){this.InitAudioPlayer()}if(this.sound){var b=this.sound.GetState();Log(this.id+": _OnShowStart Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.sound.Play(false,a)}b=this.sound.GetState();Log(this.id+": _OnShowStart Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this.soundPaused=true;this._IncBufCount()}else{if(b!=MediaStates.ERROR){if(Prez.runningStreams==PrezStreams.NONE){this.sound.Play(false);this.soundPaused=true}else{this.sound.Play(true)}this.soundPaused=false}}}},Hide:function(a){if(arguments.length==0){a=true}$(this).stopTime("hide");if(a&&this.ctrl.outeff&&this.showState!=CtrlShowState.HIDE){if(this.showState==CtrlShowState.HIDING){EffectMan.Resume($("#"+this.id)[0])}else{this.Show({value:CtrlShowState.HIDING,ts:0,ctrlTs:this.startOut},false)}}else{this.Show({value:CtrlShowState.HIDE},false)}},_OnHideComplete:function(){$("#"+this.id).hide().attr("aria-hidden","true");this.showState=CtrlShowState.HIDE;if(this.sound&&this.ctrl.meddur>this.ctrl.duration){var a=this.sound.GetState();if(a==MediaStates.BUFFERING||a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.sound.Play(false)}this.sound.SetPlayerReady(false)}$(this).stopTime("showstart").stopTime("hide").stopTime("timelimit");if(this.ctrl.startTime<0){this.slideUI.RemoveTriggeredUI(this)}var b=this;if(this.onHide){window.setTimeout(function(){if(b.onHide){b.onHideTmp=b.onHide;delete b.onHide;b.onHideTmp();delete b.onHideTmp}},1)}},SetOnHideCallback:function(b){if(!b){return}var a=this.onHide;this.onHide=function(){if(a){a.call(this)}b.call(this)}},UpdatePrezStateChanged:function(){if(Prez.runningStreams==PrezStreams.NONE){$(this).pauseTime("timelimit");$(this).pauseTime("hide");if(!Prez.IsBuffering()){if(this.sound&&this.showState!=CtrlShowState.HIDE){var a=this.sound.GetState();if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.BUFFERING){this.sound.Play(false)}else{Log(this.id+": Pause a non ready player, state: "+a)}}this.soundPaused=true}}if(Prez.runningStreams&PrezStreams.SECOND){$(this).resumeTime("timelimit");$(this).resumeTime("hide");if(this.soundPaused&&this.sound&&this.showState!=CtrlShowState.HIDE){var a=this.sound.GetState();if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.sound.Play(true)}else{Log(this.id+": Resume a non ready player, state: "+a)}}this.soundPaused=false}},_Timeout:function(){$(this).stopTime("timelimit");if(this.showState!=CtrlShowState.HIDE&&this.IsEnabled()&&this.evtMan){this.evtMan.SetTimeExpired();EvtMan.DoActions(this.evtMan.GetActions(EvtType.TIMEOUT))}},Update:function(b){if(this.evtMan){this.evtMan.Update()}delete this.doingLastAttempt;this.soundPaused=false;if(b){this._DecBufCount()}else{this.bIncBuffCount=false}if(this.sound){this.sound.Play(false)}this.hiddenByEvent=false;if(!b){if(this.onHide){delete this.onHide
}var c={},a=this.slideUI.ts;if(this.ctrl.startTime<0){c.value=CtrlShowState.HIDE}else{if(this.parentUI){c.value=CtrlShowState.SHOW;c.ctrlTs=a-this.ctrl.startTime}else{this.GetShowState(a,c)}}this.showState=CtrlShowState.HIDE;this.Show(c)}},Tick:function(){if(this.ctrl.startTime<0){return}var b={},a=this.slideUI.ts;switch(this.showState){case CtrlShowState.SHOW:case CtrlShowState.HIDE:this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b)}break}},SetWaited:function(a){this.waited=a},GetWaitingTS:function(){if(this.evtMan&&!this.waited&&!this.parentUI&&(this.IsEnabled()||this.doingLastAttempt)&&(this.ctrl.startTime>=0)){var a=this.ctrl.evt.startWait;if(!isNaN(a)&&a>=0){a+=this.ctrl.startTime;return a}}},CleanUp:function(){$(this).stopTime();$("#"+this.id).stop(true);EffectMan.Stop($("#"+this.id)[0],true,false);if(this.onHide){delete this.onHide}if(this.sound){this.sound.CleanUp();this.sound=null;$("#"+this.playerId).hide()}$("#"+this.inputId).unbind();if(this.evtMan){this.evtMan.CleanUp()}this.cleaned=true},Submit:function(){},LoadSubmitedData:function(){},GetSubmitedDataObject:function(){var b=this.slideUI.GetSubmitedDataObject();var a=b[this.ctrl.id];if(!a){a={};b[this.ctrl.id]=a}return a},GetImg:function(){return"data/img_"+this.slideUI.slide.idx+"."+this.ctrl.id+".png"},_OnPlayerReady:function(){if(this.sound){this.sound.SetVolume(Prez.GetVolume(true));if(this.showState==CtrlShowState.HIDE){return}var b=this.sound.GetState();Log(this.id+": _OnPlayerReady Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.sound.Play(false,a)}b=this.sound.GetState();Log(this.id+": _OnPlayerReady Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this._IncBufCount()}else{this._DecBufCount()}}},_OnPlayerEnded:function(){},_OnPlayerStateChanged:function(){if(this.showState==CtrlShowState.HIDE||!this.sound){return}var a=this.sound.GetState();if(!this.bIncBuffCount){if(a==MediaStates.OPENING||a==MediaStates.BUFFERING){this._IncBufCount()}}else{if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.ERROR||a==MediaStates.STOPPED){this._DecBufCount()}}},_GetTimeStamp:function(){var a=0;if(this.ctrl.startTime>=0){a=this.slideUI.ts-this.ctrl.startTime;if(a<0){a=0}}return a},Mute:function(a){if(a===undefined){a=true}this.SetVolume(a?0:Prez.GetVolume())},SetVolume:function(a){if(this.sound){this.sound.SetVolume(a)}},IsFocusable:function(){return false},Focus:function(){return false},MouseEnter:function(){if(!this.evtMan){return}var a=this.evtMan.GetActions(EvtType.MOUSE_ENTER);if(a.length&&this.IsEnabled()){EvtMan.DoActions(a)}},MouseLeave:function(){if(!this.evtMan){return}var a=this.evtMan.GetActions(EvtType.MOUSE_LEAVE);if(a.length&&this.IsEnabled()){EvtMan.DoActions(a)}},GetDropCtrlUI:function(){return this.dropUI},SetDropCtrlUI:function(a){this.dropUI=a},ClearDropCtrlUI:function(){delete this.dropUI},SetHiddenByEvent:function(a){this.hiddenByEvent=a}});InputUI.MOUSE=1;InputUI.KEY=2;InputUI.MOUSE_HOVER=3;InputUI.GetCombinedCode=function(c,d,a,e){switch(c){case Key.CTRL:d=true;c=0;break;case Key.SHIFT:a=true;c=0;break;case Key.ALT:e=true;c=0;break}var b=0;if(d){b|=Key.MOD_CTRL}if(a){b|=Key.MOD_SHIFT}if(e){b|=Key.MOD_ALT}return((b<<24)|c)};InputUI.GetEvtValue=function(a){return InputUI.GetCombinedCode(a.apWhich,a.ctrlKey,a.shiftKey,a.altKey)};InputUI.CheckEvtValue=function(h,b,g,a){if(h==EvtType.TEXT&&!a){b=b.toLowerCase();g=g.toLowerCase()}if(b==g){return Judge.CORRECT}if(h==EvtType.TEXT){if(g.substr(0,b.length)==b&&b.length<g.length){return Judge.PARTIAL_CORRECT}}else{var c=b&16777215,e=g&16777215,d=b>>24,f=g>>24;if(h==EvtType.KEY_DOWN){if((c==0||c==e)&&(d&f)==d){return Judge.PARTIAL_CORRECT}}else{if(c==0&&(d&f)==d){return Judge.PARTIAL_CORRECT}}}return Judge.WRONG};function InputUI(c,a,b){CtrlUI.call(this,c,a,b);this.inputId=this.id+"_inp";this.bgId=this.id+"_bg";if(this.ctrl.html){this.labelId=this.id+"_lb"}this.showShape=true;if(this.IsTopLevel()||this.IsTriggeredByEvent()){this.showShape=(this.ctrl.showMode&Prez.Session.PMode)==Prez.Session.PMode}if(this.ctrl.flags&CtrlFlags.FOCUSABLE){this.role="button"}}$.extend(InputUI.prototype,CtrlUI.prototype,{constructor:InputUI,GetInputHTML:function(){var a='<div id="'+this.inputId+'" class="evtreceiver" onclick="void(0)" '+this.GetARIAAttrs();if(this.ctrl.flags&CtrlFlags.FOCUSABLE){a+=' tabindex="-1"></div>'}else{a+="></div>"}return a},OnAttached:function(){var b=$("#"+this.inputId);if(this.showShape){b.css("cursor","pointer")}else{$("#"+this.bgId).css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}var a=this;if(this.ctrl.flags&CtrlFlags.FOCUSABLE){if(this.ctrl.type==InputUI.MOUSE){b.bind("keydown",function(c){if(!a.IsEnabled()){return}if(c.apWhich===undefined){c.apWhich=Key.ToMozKey(c.which)}if(c.apWhich==Key.SPACE||c.apWhich==Key.ENTER){$(document).trigger("feedback",[c]);a.Submit(EvtType.CLICK,a.evtMan.GetFirstEventValue(EvtType.CLICK));return EvtMan.StopEvent(c)}})}b.bind("mousedown.focus",function(){if(a.IsFocusable()){a.Focus()}});b.focus(function(){if(Options.HilightFocus){$("#"+a.id).addClass("focused")}CanvasNav.OnCtrlFocused(a)}).blur(function(){if(Options.HilightFocus){$("#"+a.id).removeClass("focused")}})}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(Options.FlashABSpeed>0&&this.IsTopLevel()&&this.ctrl.type!=InputUI.MOUSE_HOVER){$(this).stopTime("flashing");$(this).everyTime(Options.FlashABSpeed,"flashing",function(){this._Flashing()})}if(this.IsEnabled(true)){if(this.ctrl.type!=InputUI.MOUSE_HOVER){this.slideUI.AddInputUI(this)}}if(!CanvasNav.GetFocusedCtrl()&&this.IsFocusable()){this.Focus()}else{CanvasNav.Focus(false)}},_OnHideComplete:function(){$(this).stopTime("flashing");this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},UpdatePrezStateChanged:function(){if(Prez.runningStreams==PrezStreams.NONE){$(this).stopTime("flashing");if(this.showShape){$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}}}if(Prez.runningStreams&PrezStreams.SECOND){if(this.showState!=CtrlShowState.HIDE&&Options.FlashABSpeed&&this.IsTopLevel()&&this.ctrl.type!=InputUI.MOUSE_HOVER){var a=this;$(this).stopTime("flashing");$(this).everyTime(Options.FlashABSpeed,"flashing",function(){a._Flashing()})}}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},_Flashing:function(){if(!this.showShape){return}var a=$("#"+this.bgId);if(a.css("visibility")=="hidden"){a.css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}}else{a.css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}},Submit:function(g,f,c){if(!c){c=this.GetResponse(g,f)}if(c.jud!=Judge.UNEXPECTED&&c.jud!=Judge.PARTIAL_CORRECT){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}if(this.ctrl.kind==CtrlKind.INPUT&&this.ctrl.type!=InputUI.MOUSE_HOVER){var b=this.GetSubmitedDataObject();b.v=f;b.a=this.evtMan.curAtp;b.p=c.pt;b.j=c.jud;if(bSendToLMS){try{scormStoreCtrlInteractionData(this,c.jud,c.pt,g,f)}catch(d){if(!bSuppressSCORMException){alert(d.toString())}}}}var a=EvtMan.DoActions(c.acts,this);if(c.jud==Judge.WRONG&&(Prez.Session.PMode&(PlayModes.PRAC|PlayModes.TUT))){this.ShowShape()}CtrlUI.prototype.Submit.call(this);return a}},GetResponse:function(d,b){var a={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled(true)||this.ctrl.type==InputUI.MOUSE_HOVER){return a}if(d==EvtType.CLICK&&b==Mouse.CLICK_OUTSIDE){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}return a}var c=this.ctrl.type==InputUI.KEY?EvtType.KEY_DOWN:EvtType.CLICK;if(d==EvtType.CLICK&&Mouse.fromTouchEvent){d=c;
b=this.evtMan.GetFirstEventValue(d)}if(d==c){a=this.evtMan.GetResponse(d,b)}else{if(d==EvtType.KEY_DOWN){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){if(b&16777215){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}else{a=this.evtMan.GetResponse(EvtType.CLICK,b)}}}}return a},IsFocusable:function(){return(this.ctrl.flags&CtrlFlags.FOCUSABLE)&&(this.showState!=CtrlShowState.HIDE)&&this.IsEnabled(true)},Focus:function(){$("#"+this.inputId).focus();this.slideUI.GetDOM().scrollLeft(0).scrollTop(0);return true},ShowShape:function(){this.showShape=true;$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}$("#"+this.inputId).css("cursor","pointer")},LoadSubmitedData:function(b){var a=b[this.ctrl.id];if(!a){return}this.evtMan.curAtp=a.a},CleanUp:function(){$(this).stopTime("flashing");if(this.showState!=CtrlShowState.HIDE){$("#"+this.inputId).removeClass("evtreceiver")}CtrlUI.prototype.CleanUp.call(this)},PlayClickSound:function(){if(this.ctrl.type==InputUI.MOUSE&&this.ctrl.audio&&this.IsEnabled(true)&&this.showState!=CtrlShowState.HIDE&&Prez.prjSldUI){Prez.prjSldUI.PlayClickSound(this.ctrl.audio)}}});function GestureUI(c,a,b){CtrlUI.call(this,c,a,b)}$.extend(GestureUI.prototype,CtrlUI.prototype,{constructor:GestureUI,_OnShowStart:function(g){CtrlUI.prototype._OnShowStart.call(this,g);$(this).stopTime("gesture_eff");var a=this.ctrl.eff_touchscr;if(a&&(a.showModes&Prez.Session.PMode)==Prez.Session.PMode){if(this.ctrl.startTime>=0){var b=this.ctrl.startTime;var k=(this.ctrl.duration>=0?this.ctrl.duration+b:Prez.slideUI.slide.duration);if(this.ctrl.ineff){b+=this.ctrl.ineff.duration}if(this.ctrl.outeff){k-=this.ctrl.outeff.duration}if(b<g+this.ctrl.startTime){b=g+this.ctrl.startTime}var c=k-b;if(c>2000){c=2000}var e=k-c;var h=e-(this.ctrl.startTime+g);if(h<1){h=1}var d=c/a.fr_count;if(d>=1){var f=this.ctrl.rect;$(this).oneTime(h,"gesture_eff",function(){Prez.prjSldUI.PlayPointerEffect(false,a.type,f.l+f.w/2,f.t+f.h/2,a.w,a.h,a.color,null,a.file,d,a.fr_count)})}}}},UpdatePrezStateChanged:function(){if(Prez.runningStreams&PrezStreams.MAIN){$(this).resumeTime("gesture_eff")}else{$(this).pauseTime("gesture_eff")}CtrlUI.prototype.UpdatePrezStateChanged.call(this)}});TxtInputUI.PASSWORD=1;TxtInputUI.MULTILINE=2;TxtInputUI.RETAIN=4;TxtInputUI.CASESENS=8;TxtInputUI.LASTCHARTIME=500;function TxtInputUI(c,a,b){CtrlUI.call(this,c,a,b);this.inputId=this.id+"_inp";this.textboxId=this.id+"_txtbox";this.labelId=this.id+"_lb";this.inputRc={t:c.tr.t+c.rect.t,l:c.tr.l+c.rect.l,w:c.tr.w,h:c.tr.h};this.inputFontSize=parseFloat($('<div style="'+c.css+'"></div>').css("font-size"));if(isNaN(this.inputFontSize)){this.inputFontSize=12}this.typingText="";this.prevSubmitedText=undefined;this.prevCorrectText="";this.role=""}$.extend(TxtInputUI.prototype,CtrlUI.prototype,{constructor:TxtInputUI,GetInputHTML:function(){var c="",a=CtrlUI.GenCSSRect(this.ctrl.tr,Prez.Scale);if(Prez.Scale==1){a+=this.ctrl.css}else{var b={html:"",css:this.ctrl.css};ScaleFont(b,Prez.Scale);a+=b.css}if(this.ctrl.flags&TxtInputUI.MULTILINE){c='<textarea id="'+this.textboxId+'" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1"></textarea>'}else{if(this.ctrl.flags&TxtInputUI.PASSWORD){c='<input id="'+this.textboxId+'" type="password" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1" autocomplete="off" />'}else{c='<input id="'+this.textboxId+'" type="text" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1" autocomplete="off" />'}}return'<div id="'+this.inputId+'" class="evtreceiver">'+c+"</div>"},OnAttached:function(){if(Prez.Session.PMode==PlayModes.DEMO&&this.IsTopLevel()){this.typingText=this.evtMan.GetFirstEventValue(EvtType.TEXT);if(!this.typingText){this.typingText=""}}if(this.typingText.length){var b=this.ctrl.duration;if(b<0){b=this.slideUI.slide.duration-this.ctrl.startTime}b-=TxtInputUI.LASTCHARTIME;this.typingDelay=0;if(this.ctrl.ineff){this.typingDelay=this.ctrl.ineff.duration;b-=this.typingDelay}if(this.ctrl.outeff){b-=this.ctrl.outeff.duration}this.typingInterval=Math.floor(b/this.typingText.length);this.typingTs=0}var e=$("#"+this.inputId),d=$("#"+this.textboxId),c=this;d.focus(function(){$("#"+c.labelId).hide();if(Options.HilightFocus){$("#"+c.id).addClass("focused")}CanvasNav.OnCtrlFocused(c)}).blur(function(){if(!this.value){$("#"+c.labelId).show()}if(Options.HilightFocus){$("#"+c.id).removeClass("focused")}});e.bind("click",function(f){if(c.IsFocusable()){c.Focus()}}).bind("mousedown mouseup",function(f){if(f.type=="mousedown"){Mouse.Norm(f,false);$(document).trigger("feedback",[f])}f.stopPropagation()});var a=this.ctrl.evt.submit;if(a==EvtMan.SubmitCode.AUTO){d.bind("keyup",function(){if(!c.IsEnabled()){return}c.Submit()})}else{if(a>0){d.bind("keydown keyup",function(f){if(!c.IsEnabled()){return}if(f.apWhich===undefined){f.apWhich=Key.ToMozKey(f.which)}if(Key.ShouldHandleKeyUp(f.apWhich)){if(f.type!="keyup"){return EvtMan.StopEvent(f)}}else{if(f.type!="keydown"){return EvtMan.StopEvent(f)}}if(a==InputUI.GetEvtValue(f)){$(document).trigger("feedback",[f]);c.Submit();return EvtMan.StopEvent(f)}})}}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(c){CtrlUI.prototype._OnShowStart.call(this,c);if(this.IsEnabled(true)){this.slideUI.AddInputUI(this)}if(!CanvasNav.GetFocusedCtrl()&&this.IsFocusable()){this.Focus()}if(this.typingText!=""){var b=0;if(this.typingTs>=this.typingDelay){if(this.typingInterval>0){b=Math.floor((this.typingTs-this.typingDelay)/this.typingInterval)}else{b=this.typingText.length}}this.SetValue(this.typingText.substr(0,b));if(b<this.typingText.length){$(this).stopTime("typing").everyTime(this.typingInterval,"typing",function(){this._SimulateTyping()})}var a=this.GetValue().length;this.SetSelection(a,a)}},_OnHideComplete:function(){if(this.typingText!=""){$(this).stopTime("typing")}this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},Update:function(a){if(this.typingText!=""){this.typingTs=this.slideUI.ts-this.ctrl.startTime;if(this.typingTs<0){this.typingTs=0}}this.prevSubmitedText=undefined;this.prevCorrectText="";CtrlUI.prototype.Update.call(this,a)},UpdatePrezStateChanged:function(){if(this.typingText!=""){if(Prez.runningStreams&PrezStreams.MAIN){$(this).resumeTime("typing")}else{$(this).pauseTime("typing")}}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},Zoom:function(e,d){CtrlUI.prototype.Zoom.call(this,e,d);var f=$("#"+this.textboxId);var a=f[0],b,c;if(a){b=a.style;c=this.ctrl.tr;if(this.scale!==undefined){e*=this.scale}b.top=(e*c.t)+"px";b.left=(e*c.l)+"px";b.width=(e*c.w)+"px";b.height=(e*c.h)+"px";f.css("font-size",this.inputFontSize*e)}},Submit:function(f,d,b){if(f===undefined){f=EvtType.TEXT}if(d===undefined){d=this.GetValue()}if(f==EvtType.TEXT&&d===this.prevSubmitedText&&(d!==""||this.ctrl.evt.submit==EvtMan.SubmitCode.AUTO)){return}if(!b){b=this.GetResponse(f,d)}if(b.jud!=Judge.UNEXPECTED&&b.jud!=Judge.PARTIAL_CORRECT){if(b.jud!=Judge.INCOMPLETE){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}if(!this.parentUI){var a=this.GetSubmitedDataObject();a.a=this.evtMan.curAtp;a.v=this.GetValue();a.p=b.pt;a.j=b.jud;if(bSendToLMS){try{scormStoreCtrlInteractionData(this,b.jud,b.pt,f,d)}catch(c){if(!bSuppressSCORMException){alert(c.toString())}}}}}if(b.jud==Judge.WRONG&&f==EvtType.TEXT){this.SetSelection(this.prevCorrectText.length,d.length)}EvtMan.DoActions(b.acts,this);CtrlUI.prototype.Submit.call(this)}if(b.jud!=Judge.UNEXPECTED&&f==EvtType.TEXT){this.prevSubmitedText=d;if(b.jud!=Judge.WRONG){this.prevCorrectText=d}}},SetSelection:function(e,c){var a=$("#"+this.textboxId)[0];if(!a){return}if(this.IsFocusable()){this.Focus()}try{if(a.createTextRange){var b=a.createTextRange();b.collapse(true);b.moveStart("character",e);b.moveEnd("character",c-e);b.select()}else{if(a.setSelectionRange){a.setSelectionRange(e,c)}else{if(a.selectionStart){a.selectionStart=e;a.selectionEnd=c}}}}catch(d){}},GetResponse:function(c,b){var a={jud:Judge.UNEXPECTED,pt:0,acts:[]};
if(this.showState==CtrlShowState.HIDE||!this.IsEnabled(true)){return a}if(c===undefined){c=EvtType.TEXT}if(b===undefined){b=this.GetValue()}if(c==EvtType.CLICK&&b==Mouse.CLICK_OUTSIDE){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}return a}if(c==EvtType.TEXT){a=this.evtMan.GetResponse(c,b,this.ctrl.flags&TxtInputUI.CASESENS)}else{if(c==EvtType.KEY_DOWN){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}}}return a},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled(true))){return}this.SetValue("")},IsFocusable:function(){return(this.showState!=CtrlShowState.HIDE)&&this.IsEnabled(true)},Focus:function(){$("#"+this.textboxId).focus();if(UI.IEBrowser){var a=this;window.setTimeout(function(){a.slideUI.GetDOM().scrollLeft(0).scrollTop(0)},0)}else{this.slideUI.GetDOM().scrollLeft(0).scrollTop(0)}return true},GetValue:function(){return $("#"+this.textboxId).val()},SetValue:function(a){$("#"+this.textboxId).val(a)},SetText:function(a){this.SetValue(a)},GetText:function(){return this.GetValue()},IsCaseSensitive:function(){return this.ctrl.flags&TxtInputUI.CASESENS},LoadSubmitedData:function(b){var a=b[this.ctrl.id];if(!a){return}this.SetValue(a.v);this.evtMan.curAtp=a.a},CleanUp:function(){if(this.showState!=CtrlShowState.HIDE){$("#"+this.inputId).removeClass("evtreceiver")}CtrlUI.prototype.CleanUp.call(this)},_SimulateTyping:function(){this.typingTs+=this.typingInterval;if(this.typingTs<this.typingDelay){return}var a;if(this.typingInterval<=0){a=this.typingText.length}else{a=Math.floor((this.typingTs-this.typingDelay)/this.typingInterval);if(a>this.typingText.length){a=this.typingText.length}}if(this.GetValue().length!=a){this.SetValue(this.typingText.substr(0,a));this.SetSelection(a,a)}if(a>=this.typingText.length){$(this).stopTime("typing")}}});function DropAreaUI(c,a,b){CtrlUI.call(this,c,a,b);this.inputId=this.id+"_inp";this.bgId=this.id+"_bg";if(this.ctrl.html){this.labelId=this.id+"_lb"}this.showShape=true;if(this.IsTopLevel()||this.IsTriggeredByEvent()){this.showShape=(this.ctrl.showMode&Prez.Session.PMode)==Prez.Session.PMode}}$.extend(DropAreaUI.prototype,CtrlUI.prototype,{constructor:DropAreaUI,GetInputHTML:function(){return'<div id="'+this.inputId+'" class="evtreceiver" '+this.GetARIAAttrs()+"></div>"},OnAttached:function(){if(!this.showShape){$("#"+this.bgId).css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(this.IsEnabled(true)){this.slideUI.AddInputUI(this)}},_OnHideComplete:function(){this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},Submit:function(g,f,c){if(!c){c=this.GetResponse(g,f)}if(c.jud!=Judge.UNEXPECTED&&c.jud!=Judge.PARTIAL_CORRECT){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}var b=this.GetSubmitedDataObject();b.v=c.v;b.rv=c.rv;b.a=this.evtMan.curAtp;b.p=c.pt;b.j=c.jud;if(bSendToLMS){try{scormStoreCtrlInteractionData(this,c.jud,c.pt,g,f)}catch(d){if(!bSuppressSCORMException){alert(d.toString())}}}var a=EvtMan.DoActions(c.acts,this);if(c.jud==Judge.WRONG&&(Prez.Session.PMode&(PlayModes.PRAC|PlayModes.TUT))){this.ShowShape()}CtrlUI.prototype.Submit.call(this);return a}},GetResponse:function(h,e){var a={jud:Judge.UNEXPECTED,pt:0,acts:[],v:"",rv:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled(true)){return a}var d=false;switch(h){case EvtType.ACCEPT:d=true;a=this.evtMan.GetResponse(h,e);break;case EvtType.REJECT:d=true;a=this.evtMan.GetResponse(h,e);break;default:if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}break}if(d){if(e.ctrl){a.v=e.ctrl.id}}a.rv=[];if(this.dropHelper){var g=this.dropHelper.GetDroppedUIs(),c,f,b;for(c=0,f=g.length;c<f;++c){b=g[c];if(this.dropHelper.IsAbsoluteDroppedPos()&&b.pos){a.rv.push({id:b.ctrl.id,t:b.pos.t,l:b.pos.l})}else{a.rv.push(b.ctrl.id)}}}return a},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled(true))){return}if(this.dropHelper){this.dropHelper.ResetAllDropped()}},ShowShape:function(){this.showShape=true;$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}},LoadSubmitedData:function(d){var a=d[this.ctrl.id];if(!a){return}this.evtMan.curAtp=a.a;var e=a.rv;if(e&&e.length){var c,h,b,g={top:0,left:0},f=Prez.Scale*ZoomUI.Scale;for(c=0,h=e.length;c<h;++c){if(typeof e[c]==="object"){b=this.slideUI.GetCtrlUI(e[c].id,true);g.top=e[c].t*f;g.left=e[c].l*f}else{b=this.slideUI.GetCtrlUI(e[c],true)}if(b){this.dropHelper.Drop(b,g,false)}}}}});AnswerUI.Type={RADIO:1,CHECK:2,TEXT:3,COMBO:4};function AnswerUI(c,a,b){CtrlUI.call(this,c,a,b);this.actUI=a.CreateControl(this.ctrl.act,this);this.noteUI=a.CreateControl(this.ctrl.note,this)}$.extend(AnswerUI.prototype,CtrlUI.prototype,{constructor:AnswerUI,GetHTML:function(){var a='<div id="'+this.id+'" class="comctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,Prez.Scale)+'">';if(this.noteUI){a+=this.noteUI.GetHTML()}if(this.actUI){a+=this.actUI.GetHTML()}a+="</div>";return a},SetText:function(a){window.console&&console.log("Answer doesn't support SetText")},GetText:function(a){window.console&&console.log("Answer doesn't support GetText")},OnAttached:function(){if(this.actUI&&this.noteUI&&this.actUI.ctrl.kind==CtrlKind.TOGGLE){var b=this.actUI,a=this.noteUI.id;$('<div id="'+a+'_inp" class="evtreceiver"></div>').appendTo($("#"+a)).click(function(){b.Click();return false}).hover(function(){b.Hover(true)},function(){b.Hover(false)}).bind("mousedown mouseup",function(c){c.stopPropagation()}).css("cursor","pointer")}CtrlUI.prototype.OnAttached.call(this)}});QuizUI.Type={MULTI_CHOICE:1,MULTI_RESPONSE:2,TRUE_FALSE:3,SINGLELINE_TEXT:4,MULTI_SINGLELINE_TEXT:5,MULTILINE_TEXT:6,DROPDOWN:8,MULTI_DROPDOWN:9,SEQUENCE_DRAGDROP:10,MATCH_DRAGDROP:12};function QuizUI(a,o,n){function e(s,t){var r=CtrlKind.ANSWER,q=undefined;switch(s.type){case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:r=CtrlKind.TEXTINPUT;break;case QuizUI.Type.DROPDOWN:r=CtrlKind.COMBO;break;case QuizUI.Type.SEQUENCE_DRAGDROP:r=CtrlKind.NOTE;q=NoteType.ANSWER;break;case QuizUI.Type.MATCH_DRAGDROP:return !isNaN(t.flags)&&(t.flags&(CtrlFlags.DRAGGABLE|CtrlFlags.DROPPABLE))!=0}return(t.kind==r)&&(q===undefined||t.type==q)}CtrlUI.call(this,a,o,n);this.html='<div id="'+this.id+'" class="comctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,Prez.Scale)+'">';this.ansUIs=[];var d=this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP&&!this.ctrl.ansPos;var h=[];var c,f=this.ctrl.ctrls,b=f.length,l;for(l=0;l<b;++l){c=o.CreateControl(f[l],this);if(c){if(e(this.ctrl,c.ctrl)){this.ansUIs.push(c);if(d){h.push({top:c.ctrl.rect.t,left:c.ctrl.rect.l})}}this.html+=c.GetHTML()}}if(d){h.sort(function(r,q){return(r.top-q.top)||(r.left-q.left)});this.ctrl.ansPos=h;b=this.ansUIs.length;var m=RandomPermutation(b),g,a;for(l=0;l<b;++l){a=this.ansUIs[l].ctrl;a.curOrder=m[l];for(g=0;g<b;++g){if(h[g].top==a.rect.t&&h[g].left==a.rect.l){a.correctOrder=g;break}}}}var k,p;if(this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP){for(l=0,b=this.ansUIs.length;l<b;++l){c=this.ansUIs[l];c.curOrder=c.ctrl.curOrder;k=c.ctrl.rect;p=this.ctrl.ansPos[c.curOrder];k.t=p.top;k.l=p.left}}this.html+="</div>"}$.extend(QuizUI.prototype,CtrlUI.prototype,{constructor:QuizUI,GetHTML:function(){return this.html},SetText:function(a){window.console&&console.log("Question doesn't support SetText")},GetText:function(a){window.console&&console.log("Question doesn't support GetText")},OnAttached:function(){var g=this;if(this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP){var a={cursor:"default",start:function(l,n){g.draggingUI=g.slideUI.GetCtrlUI(this.id,false);if(!g.draggingUI||!g.draggingUI.IsEnabled()){g.draggingUI=null;return false}if(g.draggingUI){DropHelper.DragEffect(g.draggingUI,true);
var o=ZoomUI.Scale*Prez.Scale,k=g.draggingUI.ctrl.rect,m='<div class="ctrl" id="ctrl_placeholder" style="'+CtrlUI.GenCSSRect(k,o)+'"></div>',h=g.draggingUI.ctrl.tf;g.draggingUI.holder=$(m).appendTo(g.draggingUI.parentUI?g.draggingUI.parentUI.GetDOM():g.slideUI.GetDOM());if(h){g.draggingUI.holder.css({transformOrigin:h.oX+"% "+h.oY+"%",transform:"rotate("+h.r+"deg)"});g.draggingUI.dragOffsetX=(k.l*o-n.position.left)/o;g.draggingUI.dragOffsetY=(k.t*o-n.position.top)/o}}},stop:function(h,k){if(g.draggingUI){DropHelper.DragEffect(g.draggingUI,false);var l=g.ctrl.ansPos[g.draggingUI.curOrder];k.helper.animate({top:l.top*ZoomUI.Scale*Prez.Scale,left:l.left*ZoomUI.Scale*Prez.Scale},DropHelper.RevertTime,function(){g.draggingUI.holder.remove();delete g.draggingUI.holder;delete g.draggingUI.dragOffsetX;delete g.draggingUI.dragOffsetY;g.draggingUI=null})}},drag:function(h,w){if(!g.draggingUI){return}var r=w.position.left+h.pageX-w.offset.left,o=w.position.top+h.pageY-w.offset.top,v={},k,t,q,y,x,u,m,p=ZoomUI.Scale*Prez.Scale,s,l;if(g.draggingUI.dragOffsetX){w.position.left+=g.draggingUI.dragOffsetX*p}if(g.draggingUI.dragOffsetY){w.position.top+=g.draggingUI.dragOffsetY*p}for(s=0,l=g.ansUIs.length;s<l;++s){k=g.ansUIs[s];if(k==g.draggingUI){continue}t=k.ctrl.rect;q=t.l*p;y=t.t*p;x=t.w*p;u=t.h*p;v.x=r;v.y=o;m=k.ctrl.tf;if(m){v=RotatePoint(r,o,-m.r,q+x*m.oX/100,y+u*m.oY/100)}if(IsInside(q,y,x,u,v.x,v.y)){g.draggingUI.holder.css({top:y,left:q});g.SortAnswers(g.draggingUI,k);break}}}};var d=ZoomUI.Scale*Prez.Scale;for(var b=0,f=this.ansUIs.length;b<f;++b){var c=this.ansUIs[b];var e=this.ctrl.ansPos[c.ctrl.curOrder];c.GetDOM().append('<div id="'+c.id+'_inp" class="evtreceiver"></div>').css({top:e.top*d,left:e.left*d}).bind("mousedown",function(h){h.stopPropagation()}).draggable(a)}}CtrlUI.prototype.OnAttached.call(this)},Zoom:function(d,c){CtrlUI.prototype.Zoom.call(this,d,c);if(this.draggingUI&&this.draggingUI.holder){var a=this.draggingUI.ctrl.rect;var b={width:a.w*d,height:a.h*d};if(c){b.top=a.t*d;b.left=a.l*d}this.draggingUI.holder.css(b)}},Submit:function(d){if(!this.IsEnabled(true)){return}var s=this.GetSubmitedDataObject();s.v={};var m=!(this.ctrl.evt.mod&EvtMode.SURVEY);var p=(m&&((this.ctrl.evt.mod&EvtMode.PARTIAL_SCORE)==EvtMode.PARTIAL_SCORE)),c=(m&&((this.ctrl.evt.mod&EvtMode.PARTIAL_ACTION)==EvtMode.PARTIAL_ACTION)),n=0,f=[],b=false,a,o;var r=0;var k=0,q=this.ansUIs.length;if(!m){o=Judge.NEUTRAL}else{o=Judge.CORRECT}switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:c=false;case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(k=0;k<q;++k){a=this.ansUIs[k].actUI;if(m){if(a.IsChecked()){++n;if(!a.ctrl.checked){o=Judge.WRONG}if(a.evtMan){if(p){r+=a.evtMan.GetPoints(EvtType.CHECK)}if(c){f=a.evtMan.GetActions(EvtType.CHECK)}}}else{if(a.ctrl.checked&&o!=Judge.WRONG){o=Judge.PARTIAL_CORRECT}}}else{if(a.IsChecked()){++n}}s.v[a.ctrl.id]=a.IsChecked()}if(n==0){f=this.evtMan.GetActions(EvtType.INCOMPLETE);if(f.length){o=Judge.INCOMPLETE;b=true}else{if(m){o=Judge.WRONG}else{o=Judge.NEUTRAL}}}else{if(m){if(o==Judge.CORRECT){if(!p){r=this.ctrl.evt.pt}}else{if(this.ctrl.type==QuizUI.Type.MULTI_RESPONSE&&o==Judge.WRONG){r=0;f.length=0}o=Judge.WRONG}}else{o=Judge.NEUTRAL;r=0}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(k=0;k<q;++k){a=this.ansUIs[k];a.ctrl.curOrder=a.curOrder;if(o==Judge.CORRECT){if(a.curOrder!=a.ctrl.correctOrder){o=Judge.WRONG}}s.v[a.ctrl.id]=a.curOrder}if(o==Judge.CORRECT){r=this.ctrl.evt.pt}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:a=this.ansUIs[0];if(a&&a.ctrl.kind==CtrlKind.TEXTINPUT){var h=a.evtMan.GetResponse(EvtType.TEXT,a.GetValue(),a.IsCaseSensitive(),this.evtMan,true);o=h.jud;r=h.pt;f=h.acts;b=true;s.v[a.ctrl.id]=a.GetValue()}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:var g=false,h;for(k=0;k<q;++k){a=this.ansUIs[k].actUI;h=a.evtMan.GetResponse(EvtType.TEXT,a.GetValue(),a.IsCaseSensitive(),this.evtMan,false);if(h.jud==Judge.INCOMPLETE){o=Judge.INCOMPLETE;break}else{if(h.jud==Judge.WRONG){g=true}else{if(h.jud==Judge.CORRECT){r+=h.pt}}}s.v[a.ctrl.id]=a.GetValue()}if(o==Judge.INCOMPLETE){r=0}else{if(m){if(g){o=Judge.WRONG}if(!p){r=o==Judge.WRONG?0:this.ctrl.evt.pt}}else{r=0}}break;case QuizUI.Type.MATCH_DRAGDROP:if(!d){d=this.GetResponse()}b=true;o=d.jud;if(o==Judge.PARTIAL_CORRECT){o=Judge.WRONG}r=d.pt;f=d.acts;s.v=d.v;break}if(!b){switch(o){case Judge.INCOMPLETE:f=this.evtMan.GetActions(EvtType.INCOMPLETE);break;case Judge.NEUTRAL:f=this.evtMan.GetActions(EvtType.COMPLETE);break;case Judge.CORRECT:f=f.concat(this.evtMan.GetActions(EvtType.CORRECT));break;case Judge.WRONG:f=f.concat(this.evtMan.GetActions(EvtType.WRONG));break}}if(o!=Judge.INCOMPLETE){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}}s.a=this.evtMan.curAtp;s.p=r;s.j=o;if(bSendToLMS){try{scormStoreQuizInteractionData(this,o,r)}catch(l){if(!bSuppressSCORMException){alert(l.toString())}}}EvtMan.DoActions(f,this)},GetResponse:function(){var h={jud:Judge.UNEXPECTED,pt:0,acts:[],v:{}};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled(true)){return h}if(this.ctrl.type!=QuizUI.Type.MATCH_DRAGDROP){return h}var p,k,e,f,b,q,a,o,d=false,t=false,l=false,s=false,c=this.ctrl.dragdrops,g=this.ansUIs,r;for(p=0,e=g.length;p<e;++p){if(!(g[p].ctrl.flags&CtrlFlags.DRAGGABLE)){if(g[p].ctrl.flags&CtrlFlags.DROPPABLE){q=g[p];o=q.ctrl.id;r=q.dropHelper?q.dropHelper.GetDroppedUIs():[];f=r.length;if(f>0){if(!h.v[o]){h.v[o]=[]}for(k=0;k<f;++k){b=r[k];if(q.dropHelper.IsAbsoluteDroppedPos()&&b.pos){h.v[o].push({id:b.ctrl.id,t:b.pos.t,l:b.pos.l})}else{h.v[o].push(b.ctrl.id)}}}}continue}d=true;b=g[p];a=b.ctrl.id;q=b.GetDropCtrlUI();if(q){o=q.ctrl.id;t=true;if(c){if(c[a]&&c[a][o]!==undefined){h.pt+=c[a][o]}else{l=true}}}else{if(!s&&!l&&c&&c[a]){s=true}}}if(d&&!t){h.acts=this.evtMan.GetActions(EvtType.INCOMPLETE);if(h.acts.length){h.jud=Judge.INCOMPLETE;h.pt=0}else{if(!s&&c){s=true}}}if(h.jud!=Judge.INCOMPLETE){if(this.ctrl.evt.mod&EvtMode.SURVEY){h.jud=Judge.NEUTRAL;h.pt=0;h.acts=this.evtMan.GetActions(EvtType.COMPLETE)}else{if(l||s){h.jud=l?Judge.WRONG:Judge.PARTIAL_CORRECT;h.acts=this.evtMan.GetActions(EvtType.WRONG)}else{h.jud=Judge.CORRECT;h.acts=this.evtMan.GetActions(EvtType.CORRECT)}if((this.ctrl.evt.mod&EvtMode.PARTIAL_SCORE)!=EvtMode.PARTIAL_SCORE){h.pt=h.jud==Judge.WRONG?0:this.ctrl.evt.pt}}}return h},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled(true))){return}var b=0,d=this.ansUIs.length,f=ZoomUI.Scale*Prez.Scale,e,g;switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(b=0;b<d;++b){this.ansUIs[b].actUI.Check(false)}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(b=0;b<d;++b){e=this.ansUIs[b];e.curOrder=e.ctrl.curOrder;g=this.ctrl.ansPos[e.curOrder];e.GetDOM().css({top:g.top*f,left:g.left*f});e.ctrl.rect.t=g.top;e.ctrl.rect.l=g.left}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:e=this.ansUIs[0];if(e&&e.SetValue){e.SetValue("")}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(b=0;b<d;++b){e=this.ansUIs[b].actUI;if(e&&e.SetValue){e.SetValue("")}}break;case QuizUI.Type.MATCH_DRAGDROP:var c=this.ansUIs;for(b=0;b<c.length;++b){if(c[b].dropHelper){c[b].dropHelper.ResetAllDropped()}}break}},RadioChecked:function(c){for(var a=0,d=this.ansUIs.length;a<d;++a){var b=this.ansUIs[a].actUI;if(b!=c&&b.IsChecked&&b.IsChecked()){b.Check(false)}}},SortAnswers:function(b,h){var a,d,k,l,g,c=this.ansUIs.length,m=b.curOrder,f=h.curOrder,e=ZoomUI.Scale*Prez.Scale;for(g=0;g<c;++g){a=this.ansUIs[g];if(a==b){b.curOrder=f;k=this.ctrl.ansPos[f];l=a.ctrl.rect;l.t=k.top;l.l=k.left;continue}d=a.curOrder;if(d>m){--d}if(d>=f){++d}if(d!=a.curOrder){a.curOrder=d;k=this.ctrl.ansPos[d];l=a.ctrl.rect;a.GetDOM().css({top:k.top*e,left:k.left*e});l.t=k.top;l.l=k.left}}},LoadSubmitedData:function(o){var n=o[this.ctrl.id];if(!n){return}if(n.a){this.evtMan.curAtp=n.a}var b=n.v;if(!b){return}var c,k,l;var h=0,m=this.ansUIs.length,e=ZoomUI.Scale*Prez.Scale;
switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(h=0;h<m;++h){c=this.ansUIs[h].actUI;k=b[c.ctrl.id];if(k!=undefined){c.Check(k)}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(h=0;h<m;++h){c=this.ansUIs[h];c.curOrder=b[c.ctrl.id];c.ctrl.curOrder=c.curOrder;l=this.ctrl.ansPos[c.curOrder];c.GetDOM().css({top:l.top*e,left:l.left*e});c.ctrl.rect.t=l.top;c.ctrl.rect.l=l.left}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:c=this.ansUIs[0];if(c&&c.ctrl.kind==CtrlKind.TEXTINPUT){k=b[c.ctrl.id];if(k!=undefined){c.SetValue(k)}}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(h=0;h<m;++h){c=this.ansUIs[h].actUI;k=b[c.ctrl.id];if(k!=undefined){c.SetValue(k)}}break;case QuizUI.Type.MATCH_DRAGDROP:var d=this.ansUIs;for(h=0;h<d.length;++h){if(d[h].dropHelper){d[h].dropHelper.ResetAllDropped()}}var g,f,a,l={top:0,left:0};for(g in b){if(b.hasOwnProperty(g)){f=this.slideUI.GetCtrlUI(g,true);if(f&&f.dropHelper){for(h=0;h<b[g].length;++h){if(typeof b[g][h]==="object"){a=this.slideUI.GetCtrlUI(b[g][h].id,true);l.top=b[g][h].t*e;l.left=b[g][h].l*e}else{a=this.slideUI.GetCtrlUI(b[g][h],true)}if(a){f.dropHelper.Drop(a,l,false)}}}}}break}}});ToggleUI.State={COUNT:3,CHECKED:1,HOVERED:2,DISABLED:4,PUSHED:8};function ToggleUI(c,a,b){CtrlUI.call(this,c,a,b);this.bgId=this.id+"_bg";this.inputId=this.id+"_inp";this.curState=0}$.extend(ToggleUI.prototype,CtrlUI.prototype,{constructor:ToggleUI,GetHTML:function(){var b,a="";if(this.ctrl.acctext){a=this.ctrl.acctext}if(UI.IEBLOW){b='<img id="'+this.bgId+'" class="togglebgimg" src="'+UI.BlankImgUrl()+'" alt="'+a+'" role="presentation" width="200%" height="300%" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src=\''+this.GetImg()+"');\" />"}else{b='<img id="'+this.bgId+'" class="togglebgimg" src="'+this.GetImg()+'" alt="'+a+'" role="presentation" width="200%" height="300%" />'}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,Prez.Scale)+'">'+b+'<div id="'+this.inputId+'" class="evtreceiver"></div></div>'},SetText:function(a){window.console&&console.log("Checkbox and Radio button don't support SetText")},GetText:function(a){window.console&&console.log("Checkbox and Radio button don't support GetText")},OnAttached:function(){this.UpdateBGPos();var a=this;$("#"+this.inputId).click(function(b){a.Click();return false}).hover(function(){a.Hover(true)},function(){a.Hover(false)}).bind("mousedown mouseup",function(b){b.stopPropagation()}).css("cursor","pointer");CtrlUI.prototype.OnAttached.call(this)},IsEnabled:function(a){if(this.curState&ToggleUI.State.DISABLED){return false}return CtrlUI.prototype.IsEnabled.call(this,a)},GetImg:function(){return Prez.GetResource(this.ctrl.image,"png")},Check:function(a){if(a){this.curState|=ToggleUI.State.CHECKED}else{this.curState&=~ToggleUI.State.CHECKED}this.UpdateBGPos()},IsChecked:function(){return(this.curState&ToggleUI.State.CHECKED)},Click:function(){if(!this.IsEnabled()){return}if(!this.ctrl.radio){this.curState^=ToggleUI.State.CHECKED;this.UpdateBGPos()}else{if((this.curState&ToggleUI.State.CHECKED)==0){this.curState|=ToggleUI.State.CHECKED;this.UpdateBGPos();var a=this.GetTopLevel();if(a.RadioChecked){a.RadioChecked(this)}}}},Hover:function(a){if(!this.IsEnabled()){return}if(a){this.curState|=ToggleUI.State.HOVERED}else{this.curState&=~ToggleUI.State.HOVERED}this.UpdateBGPos()},UpdateBGPos:function(){var a=0,b=0;if(!(this.curState&ToggleUI.State.CHECKED)){a=-100}if(this.curState&ToggleUI.State.DISABLED){b=2}else{if(this.curState&ToggleUI.State.PUSHED){b=3}else{if(this.curState&ToggleUI.State.HOVERED){b=1}}}if(b>ToggleUI.State.COUNT-1){b=0}if(b!=0){b*=-100}$("#"+this.bgId).css({top:b+"%",left:a+"%"})},CleanUp:function(){var a=$("#"+this.inputId);if(this.showState!=CtrlShowState.HIDE){a.removeClass("evtreceiver")}a.unbind();CtrlUI.prototype.CleanUp.call(this)}});function FeedbackUI(c,a,b){CtrlUI.call(this,c,a,b);this.keyH=c.rect.h;this.keySpacing=Math.floor(this.keyH/6);this.mouseW=Math.floor((this.keyH-1)*2/3)+1;this.LMBgPos=-(6*this.keyH+2);this.RMBgPos=-(-this.LMBgPos+this.mouseW+2);this.minTextW=this.keyH-2*c.tr.l;if(this.minTextW<0){this.minTextW=0}this.prevModifiers=0}$.extend(FeedbackUI.prototype,CtrlUI.prototype,{constructor:FeedbackUI,GetHTML:function(){var a='<div id="'+this.id+'" class="feedbackctrl" style="top:'+(this.ctrl.rect.t*Prez.Scale)+"px;left:"+(this.ctrl.rect.l*Prez.Scale)+'px;">'+this._GetKeyHTML(this.id+"_c","Ctrl")+this._GetKeyHTML(this.id+"_s","Shift")+this._GetKeyHTML(this.id+"_a","Alt")+this._GetKeyHTML(this.id+"_k","A")+this._GetMouseHTML(this.id+"_m")+"</div>";return a},SetText:function(a){window.console&&console.log("Feedback doesn't support SetText")},GetText:function(a){window.console&&console.log("Feedback doesn't support GetText")},_GetKeyHTML:function(d,c){var a=" url('"+this.GetImg()+"') no-repeat;";var b='<div id="'+d+'" class="ctrl" style="width:'+this.keyH+"px;height:"+this.keyH+'px;top:0px;left:0px;"><div id="'+d+'_l" style="background:'+a+"width:"+this.keyH+'px;height:100%;"></div><div id="'+d+'_r" style="background:top right'+a+'position:absolute;top:0;left:0;width:100%; height:100%;"><div id="'+d+'_text" style="position:absolute;white-space:nowrap;top:'+this.ctrl.tr.t+"px;margin:0px "+this.ctrl.tr.l+"px;"+this.ctrl.css+'">'+c+"</div></div></div>";return b},_GetMouseHTML:function(b){var a='<div id="'+b+'" class="ctrl" style="width:'+this.mouseW+"px;height:"+this.keyH+"px;top:0px;left:0px;background:"+this.LMBgPos+"px 0px url('"+this.GetImg()+"') no-repeat;\"></div>";return a},_SetKey:function(d,c){var a=this.keyH,b=this._GetTextWidth(c);if(b>this.minTextW){a+=(b-this.minTextW)}$("#"+d).width(a);$("#"+d+"_l").width(a-Math.floor(this.keyH/2)+3);$("#"+d+"_text").text(c).width(a-2*this.ctrl.tr.l)},_GetTextWidth:function(c){var a=$('<span style="position:absolute;top:-1000px;left:-1000px;'+this.ctrl.css+'"></span>');var b=a.text(c).appendTo(UI.ViewPort()).width();a.remove();return b},OnAttached:function(){this._SetKey(this.id+"_c","Ctrl");this._SetKey(this.id+"_s","Shift");this._SetKey(this.id+"_a","Alt");CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);var b=this;$(document).bind("feedback."+this.id,function(d,c){b.SetValue(c)})},_OnHideComplete:function(){$(document).unbind("feedback."+this.id);CtrlUI.prototype._OnHideComplete.call(this)},Zoom:function(f,e){var c=$("#"+this.id)[0];if(!c){return}var d=$(ZoomUI.GetElement()).position();var a=c.style,b=this.ctrl.rect;a.top=(b.t*Prez.Scale-d.top)+"px";a.left=(b.l*Prez.Scale-d.left)+"px"},CleanUp:function(){$(document).unbind("feedback."+this.id);CtrlUI.prototype.CleanUp.call(this)},SetValue:function(c){$(this).stopTime("hidekeys");var f=0,b=0;if(c.ctrlKey){f+=$("#"+this.id+"_c").show().width()+this.keySpacing;b|=Key.MOD_CTRL}else{$("#"+this.id+"_c").hide()}if(c.shiftKey){f+=$("#"+this.id+"_s").css("left",f+"px").show().width()+this.keySpacing;b|=Key.MOD_SHIFT}else{$("#"+this.id+"_s").hide()}if(c.altKey){f+=$("#"+this.id+"_a").css("left",f+"px").show().width()+this.keySpacing;b|=Key.MOD_ALT}else{$("#"+this.id+"_a").hide()}var d=b!=this.prevModifiers;this.prevModifiers=b;var a=c.apWhich;switch(a){case Key.CTRL:case Key.SHIFT:case Key.ALT:$("#"+this.id+"_k").hide();if(d){$("#"+this.id+"_m").hide()}break;case Mouse.Buttons.LEFT:case Mouse.Buttons.DBLEFT:$("#"+this.id+"_k").hide();f+=this.keySpacing;$("#"+this.id+"_m").css({left:f+"px","background-position":this.LMBgPos+"px 0px"}).show();break;case Mouse.Buttons.RIGHT:case Mouse.Buttons.DBRIGHT:$("#"+this.id+"_k").hide();f+=this.keySpacing;$("#"+this.id+"_m").css({left:f+"px","background-position":this.RMBgPos+"px 0px"}).show();break;default:var e;if((Key.NUMBER0<=a&&a<=Key.NUMBER9)||(Key.A<=a&&a<=Key.Z)){e=String.fromCharCode(a)}else{if(Key.NUMPAD0<=a&&a<=Key.NUMPAD9){e="Numpad "+(a-Key.NUMPAD0)}else{if(Key.F1<=a&&a<=Key.F12){e="F"+(a-Key.F1+1)
}else{e=KeyNames[a];if(e===undefined){e="Unrecognized"}}}}$("#"+this.id+"_m").hide();this._SetKey(this.id+"_k",e);$("#"+this.id+"_k").css("left",f+"px").show();break}$(this).oneTime(1000,"hidekeys",function(){$("#"+this.id+"_c").hide();$("#"+this.id+"_s").hide();$("#"+this.id+"_a").hide();$("#"+this.id+"_k").hide();$("#"+this.id+"_m").hide();this.prevModifiers=0})}});function GetMediaAltHTML(){return""}function MediaUI(f,a,e){CtrlUI.call(this,f,a,e);if(f.kind==CtrlKind.AUDIO){f.rect={t:0,l:0,w:1,h:1};if(f.audio>0){this.resUrl="data/res_"+f.audio+"."+MediaManager.strAudioExt}this.playerId=a.GetAudioPlayerId()}else{if(f.video>0){this.resUrl="data/res_"+f.video+"."+MediaManager.strVideoExt}this.playerId=a.GetVideoPlayerId();a.lastDOMId=this.playerId}this.id=this.playerId;$("#"+this.id).attr("style",CtrlUI.GenCSSRect(this.ctrl.rect,this.ctrl.kind==CtrlKind.AUDIO?1:Prez.Scale));if(f.kind==CtrlKind.VIDEO){this.vStartFrameId=this.id+"_vstart_frame";this.vEndFrameId=this.id+"_vend_frame";var b="";if(this.ctrl.acctext){b=this.ctrl.acctext}if(this.resUrl){var d="data/vstart_img_"+this.slideUI.slide.idx+"."+this.ctrl.id+".jpg";var c="data/vend_img_"+this.slideUI.slide.idx+"."+this.ctrl.id+".jpg";$("#"+this.vStartFrameId).attr("alt",b).attr("src",d).show();$("#"+this.vEndFrameId).attr("alt",b).attr("src",c).show();this.firstFrameHidden=false}else{$("#"+this.vStartFrameId).attr("alt",b).attr("src","").hide();$("#"+this.vEndFrameId).attr("alt",b).attr("src","").hide()}}this.player=null;this.bIncBuffCount=false;if(!this.IsTriggeredByEvent()){if(!this.resUrl||((this.ctrl.outeff||(!isNaN(this.endTime)&&this.endTime<0))&&!(this.ctrl.flags&CtrlFlags.NOT_WAIT))){this.hideWhenComplete=false}else{this.hideWhenComplete=true}}this.waitForTimeUpdate=false;this.resumeTokenAccepted=false;this.mediaSeeked=true}$.extend(MediaUI.prototype,CtrlUI.prototype,{constructor:MediaUI,GetHTML:function(){return""},SetText:function(a){window.console&&console.log("Audio and Video don't support SetText")},GetText:function(a){window.console&&console.log("Audio and Video don't support GetText")},InitMediaPlayer:function(){if(!this.resUrl){return}var a={width:this.ctrl.rect.w,height:this.ctrl.rect.h,file:this.resUrl,repeat:(this.ctrl.flags&CtrlFlags.LOOP)?"true":"false",mode:"audio"};if(this.ctrl.kind==CtrlKind.VIDEO){a.width*=Prez.Scale;a.height*=Prez.Scale;a.displayheight=a.height;a.mode="video";a.v_w=this.ctrl.v_w;a.v_h=this.ctrl.v_h}var b={context:this,ready:function(){this._OnPlayerReady()},end:function(){this._OnPlayerEnded()},statechanged:function(){this._OnPlayerStateChanged()},timeupdated:function(c){this._OnPlayerTimeUpdated(c)}};$("#"+this.playerId).show();this.player=MediaManager.CreatePlayer(a,this.playerId,b)},Attach:function(a){if(this.ctrl.kind!=CtrlKind.AUDIO){if(a.lastDOMId===undefined){$("#"+a.id).prepend(this.GetHTML())}else{$("#"+a.lastDOMId).after(this.GetHTML())}a.lastDOMId=this.id}},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(c){CtrlUI.prototype._OnShowStart.call(this,c);if(this.IsTriggeredByEvent()){if(!this.resUrl||(this.ctrl.outeff&&(this.ctrl.duration==0||(this.ctrl.duration>0&&!(this.ctrl.flags&CtrlFlags.LOOP))))){this.hideWhenComplete=false}else{this.hideWhenComplete=true}}if(!this.player){this.InitMediaPlayer()}if(!this.player){return}this.mediaSeeked=true;this.waitForTimeUpdate=false;var b=this.player.GetState();Log(this.id+": _OnShowStart Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.player.Play(false,a)}b=this.player.GetState();Log(this.id+": _OnShowStart Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this.playingPaused=true;this._IncBufCount()}else{if(b!=MediaStates.ERROR){if(Prez.runningStreams==PrezStreams.NONE||(Prez.runningStreams==PrezStreams.SECOND&&!(this.ctrl.flags&CtrlFlags.NOT_WAIT)&&!this.IsTriggeredByEvent())){this.player.Play(false);this.playingPaused=true}else{if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){this._IncBufCount();this.player.Play(true);this.playingPaused=false;this.waitForTimeUpdate=true;this.mediaSeeked=false}else{this.player.Play(true);this.playingPaused=false}}}}},_OnHideComplete:function(){if(this.player){var a=this.player.GetState();if(a==MediaStates.BUFFERING||a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.player.Play(false)}this.player.SetPlayerReady(false)}CtrlUI.prototype._OnHideComplete.call(this)},Tick:function(){if(this.ctrl.startTime<0){return}var b={},a=this.slideUI.ts;switch(this.showState){case CtrlShowState.SHOW:this.GetShowState(a,b);if(b.value!=this.showState&&(b.value!=CtrlShowState.HIDE||!this.hideWhenComplete)){this.Show(b)}break;case CtrlShowState.HIDE:if(!this.ended){this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b)}}break}},Update:function(a){if(this.player){this.player.Play(false)}if(a){this._DecBufCount()}else{this.bIncBuffCount=false}this.playingPaused=false;this.ended=false;if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).show()}CtrlUI.prototype.Update.call(this,a)},UpdatePrezStateChanged:function(){if((Prez.runningStreams==PrezStreams.NONE&&(!Prez.IsBuffering()||!(this.ctrl.flags&CtrlFlags.NOT_WAIT)))||(Prez.runningStreams==PrezStreams.SECOND&&!(this.ctrl.flags&CtrlFlags.NOT_WAIT)&&!this.IsTriggeredByEvent())){if(this.player&&this.showState!=CtrlShowState.HIDE){var a=this.player.GetState();if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.BUFFERING){this.player.Play(false)}else{Log(this.id+": Pause a non ready player, state: "+a)}}this.playingPaused=true}if(Prez.runningStreams==PrezStreams.ALL||(Prez.runningStreams==PrezStreams.SECOND&&((this.ctrl.flags&CtrlFlags.NOT_WAIT)||this.IsTriggeredByEvent()))){if(this.playingPaused&&this.player&&this.showState!=CtrlShowState.HIDE){var a=this.player.GetState();if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.player.Play(true)}else{Log(this.id+": Resume a non ready player, state: "+a)}}this.playingPaused=false}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},Zoom:function(b,a){if(this.ctrl.kind!=CtrlKind.AUDIO){CtrlUI.prototype.Zoom.call(this,b,a)}},CleanUp:function(){if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).hide();$(this).stopTime("hide_vstart_frame")}if(this.player){this.player.CleanUp();this.player=null}CtrlUI.prototype.CleanUp.call(this)},Mute:function(a){if(a===undefined){a=true}this.SetVolume(a?0:Prez.GetVolume())},SetVolume:function(a){if(this.player){this.player.SetVolume(a)}},AcceptResumeToken:function(){if(!this.player){return false}if(Prez.runningStreams==PrezStreams.ALL||(Prez.runningStreams==PrezStreams.SECOND&&((this.ctrl.flags&CtrlFlags.NOT_WAIT)||this.IsTriggeredByEvent()))){if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying&&this.mediaSeeked){this.playingPaused=false;this.resumeTokenAccepted=true;this.mediaSeeked=false;Log(this.id+": AcceptResumeToken: Accepted");this.player.Play(true);return true}}return false},_OnPlayerReady:function(){if(this.player){this.player.SetVolume(Prez.GetVolume(true));if(this.showState==CtrlShowState.HIDE){return}this.mediaSeeked=true;this.waitForTimeUpdate=false;var b=this.player.GetState();Log(this.id+": _OnPlayerReady Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.player.Play(false,a)}b=this.player.GetState();Log(this.id+": _OnPlayerReady Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this._IncBufCount()}else{this._DecBufCount()}}},_OnPlayerEnded:function(){if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).hide()
}if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){this._OnPlayerTimeUpdated(1)}if(this.player&&this.player.IsReady()){if(!(this.ctrl.flags&CtrlFlags.LOOP)){if(this.hideWhenComplete){this.Hide(false)}this.ended=true}}},_OnPlayerStateChanged:function(){if(this.showState==CtrlShowState.HIDE||!this.player){return}var b=this.player.GetState();if(!this.firstFrameHidden&&MediaManager.ePlayerType!=MediaPlayerTypes.HTML5&&this.ctrl.kind==CtrlKind.VIDEO&&b==MediaStates.PLAYING){this.firstFrameHidden=true;var a=this;$(this).stopTime("hide_vstart_frame");$(this).oneTime(200,"hide_vstart_frame",function(){$("#"+a.vStartFrameId).hide()})}if(!this.bIncBuffCount){if(b==MediaStates.OPENING||b==MediaStates.BUFFERING){this._IncBufCount()}}else{if(b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.ERROR||b==MediaStates.STOPPED){this._DecBufCount()}}},_OnPlayerTimeUpdated:function(a){if(!this.firstFrameHidden&&MediaManager.ePlayerType==MediaPlayerTypes.HTML5&&this.ctrl.kind==CtrlKind.VIDEO&&a>0){this.firstFrameHidden=true;$("#"+this.vStartFrameId).hide()}if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){if(a>0){if(this.waitForTimeUpdate){this.waitForTimeUpdate=false;this._DecBufCount()}if(this.resumeTokenAccepted){this.resumeTokenAccepted=false;Prez.Resume(Prez.shouldResumeStreams);Prez.shouldResumeStreams=PrezStreams.NONE}}}},_GetTimeStamp:function(){var a=0;if(this.ctrl.startTime>=0){a=this.slideUI.ts-this.ctrl.startTime}if(this.ctrl.flags&CtrlFlags.LOOP){var b=this.ctrl.duration;if(b>0){while(a>=b){a-=b}}}if(a<0){a=0}return a}});CursorUI.State={START:1,MOVING:2,STOP:3};CursorUI.Interval=20;function CursorUI(c,a,b){CtrlUI.call(this,c,a,b);this.bgId=this.id+"_bg";this.curIdx=0;if(!c.rect){if(c.cursors[0]){c.rect=c.cursors[0].rect}else{c.rect={t:0,l:0,w:0,h:0}}}this.curCursor=null;this.nextCursor=null;this.cursorTs=0;this.state=CursorUI.State.START;this.timerAnimate=undefined;this.animatePaused=false;this.element=null;this.prevAnimTime=0;this.clicked=false}$.extend(CursorUI.prototype,CtrlUI.prototype,{constructor:CursorUI,GetHTML:function(){var a=this.ctrl.cursors[this.curIdx];if(a){return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(a.rect,Prez.Scale)+'"><img id="'+this.bgId+'" class="bgimg" src="data/'+a.img+'" alt="'+Lang.Cursor+'" width="100%" height="100%" /></div>'}else{return'<div id="'+this.id+'" class="ctrl" style="width:1px;height:1px;"><img id="'+this.bgId+'" class="bgimg" src="'+UI.BlankImgUrl()+'" alt="'+Lang.Cursor+'" width="100%" height="100%" /></div>'}},GetIniProps:function(){return{}},SetText:function(a){window.console&&console.log("Cursor doesn't support SetText")},GetText:function(a){window.console&&console.log("Cursor doesn't support GetText")},GetPosition:function(){if(this.element){var a=Prez.Scale*ZoomUI.Scale;return{x:this.element.style.left/a,y:this.element.style.top/a}}return{x:0,y:0}},SetPosition:function(a,c){if(!this.element){return}var b=Prez.Scale*ZoomUI.Scale;this.element.style.left=(a*b)+"px";this.element.style.top=(c*b)+"px"},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this);this.element=$("#"+this.id)[0]},IsTriggeredByEvent:function(){return false},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(Prez.runningStreams&PrezStreams.MAIN){this._StartAnimate()}else{this.animatePaused=true}},_OnHideComplete:function(){this._StopAnimate();CtrlUI.prototype._OnHideComplete.call(this)},Zoom:function(d,c){if(this.curCursor&&this.element){var a=this.element.style,b=this.curCursor.rect;if(c&&(this.state!=CursorUI.State.MOVING)){a.top=(d*b.t)+"px";a.left=(d*b.l)+"px"}a.width=(d*b.w)+"px";a.height=(d*b.h)+"px"}},UpdatePrezStateChanged:function(){if(Prez.runningStreams&PrezStreams.MAIN){if(this.animatePaused){this._StartAnimate();this.animatePaused=false}}else{if(this.timerAnimate!==undefined){this._StopAnimate();this.animatePaused=true}}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},_StartAnimate:function(){if(this.timerAnimate!==undefined){window.clearInterval(this.timerAnimate)}if(!this.element){return}var a=this;this.timerAnimate=window.setInterval(function(){a._OnInterval()},CursorUI.Interval);this.prevAnimTime=(new Date).getTime()},_StopAnimate:function(){if(this.timerAnimate!==undefined){window.clearInterval(this.timerAnimate);this.timerAnimate=undefined}},Update:function(){if(!this.element){return}this.curIdx=-1;this.curCursor=null;this.nextCursor=null;this.clicked=true;this._StopAnimate();var f,a,g,c=this.slideUI.ts,e,d=this.ctrl.cursors;for(a=0,g=d.length;a<g;++a){f=d[a];e=f.start+f.move+f.stop;if(c<=e||f.start<0){this.cursorTs=c;this.curIdx=a;this.curCursor=f;this.nextCursor=d[a+1];this._UpdateShape(true);if(c<=f.start||f.start<0){this.state=CursorUI.State.START;this._UpdatePos(f.rect)}else{if(c<(f.start+f.move)){this.state=CursorUI.State.MOVING;this._Move()}else{this.state=CursorUI.State.STOP;this._UpdatePos(this.nextCursor.rect)}}break}c-=e}this.showState=CtrlShowState.HIDE;if(this.curCursor){this.Show({value:CtrlShowState.SHOW,ts:0,ctrlTs:0});if(Prez.prjSldUI&&!isNaN(this.curCursor.click)){if(this.cursorTs==this.curCursor.click){if(this.curCursor.sound){Prez.prjSldUI.PlayClickSound(this.curCursor.sound)}if(this.curCursor.click_eff){var b=this.curCursor.click_eff;Prez.prjSldUI.PlayPointerEffect(true,b.type,this.curCursor.pos.l,this.curCursor.pos.t,b.w,b.h,b.color,b.radius,b.file,b.fr_dur,b.fr_count)}}else{if(this.cursorTs<this.curCursor.click){this.clicked=false}}}}else{this.Hide(false)}},_UpdateShape:function(b){var d=$("#"+this.bgId)[0],c=this.element.style,e=this.ctrl.cursors,g=ZoomUI.Scale*Prez.Scale,a=this.curIdx,f;while(a>=0){f=e[a];if(f.img){c.width=(g*f.rect.w)+"px";c.height=(g*f.rect.h)+"px";if(d){d.src="data/"+f.img}return}if(!b){return}--a}if(d){d.src=UI.BlankImgUrl()}},_UpdatePos:function(a){this.element.style.left=(ZoomUI.Scale*Prez.Scale*a.l)+"px";this.element.style.top=(ZoomUI.Scale*Prez.Scale*a.t)+"px"},Tick:function(){},_OnInterval:function(){if(this.cleaned){return}var d=this.curCursor,a=(new Date).getTime();this.cursorTs+=(a-this.prevAnimTime);this.prevAnimTime=a;var c=this.cursorTs;while(d){if(!isNaN(d.click)&&!this.clicked&&d.click<=c&&Prez.prjSldUI){if(d.sound){Prez.prjSldUI.PlayClickSound(d.sound)}if(d.click_eff){var b=d.click_eff;Prez.prjSldUI.PlayPointerEffect(true,b.type,d.pos.l,d.pos.t,b.w,b.h,b.color,b.radius,b.file,b.fr_dur,b.fr_count)}this.clicked=true}if(c<=d.start||d.start<0){this.state=CursorUI.State.START;if(d.start<0&&(this.clicked||(!d.sound&&!d.click_eff))){this._StopAnimate()}return}if(c<d.start+d.move){this.state=CursorUI.State.MOVING;this._Move();return}c-=(d.start+d.move+d.stop);if(c<0){if(this.state!=CursorUI.State.STOP){this.state=CursorUI.State.STOP;if(this.nextCursor){this._UpdatePos(this.nextCursor.rect)}}return}++this.curIdx;this.curCursor=d=this.nextCursor;this.nextCursor=this.ctrl.cursors[this.curIdx+1];this.cursorTs=c;this.state=CursorUI.State.START;this.clicked=false;if(d){this._UpdateShape(false);this._UpdatePos(d.rect)}}this.Hide(false)},_Move:function(){if(this.nextCursor){var a=$.easing.easeInOutQuad((this.cursorTs-this.curCursor.start)/this.curCursor.move,this.cursorTs-this.curCursor.start,0,1,this.curCursor.move);this.element.style.left=(ZoomUI.Scale*Prez.Scale*((1-a)*(1-a)*this.curCursor.pos.l+2*a*(1-a)*this.curCursor.cpos.l+a*a*this.nextCursor.pos.l-this.curCursor.rpos.l))+"px";this.element.style.top=(ZoomUI.Scale*Prez.Scale*((1-a)*(1-a)*this.curCursor.pos.t+2*a*(1-a)*this.curCursor.cpos.t+a*a*this.nextCursor.pos.t-this.curCursor.rpos.t))+"px"}},CleanUp:function(){this._StopAnimate();CtrlUI.prototype.CleanUp.call(this);this.element=null}});ZoomUI.Scale=1;ZoomUI.GetElement=function(){return UI.$Slides[0]};ZoomUI.Reset=function(){ZoomUI.Scale=1;var b=ZoomUI.GetElement();if(b){var a=b.style;a.top="0px";a.left="0px";a.width="100%";a.height="100%"}};function ZoomUI(b,a){this.slideUI=a;this.element=ZoomUI.GetElement();this.stateTs=0;this.timerAnimate=undefined;this.animatePaused=false;this.activeIndexChanged=true;
this.prevAnimTime=0;this.zoomAreas=[];var d,c;for(d=0,c=b.length;d<c;++d){if((b[d].showMode&Prez.Session.PMode)==Prez.Session.PMode){this.zoomAreas.push(b[d])}}this.activeIndex=-1;this.zooming=false;this.startTime=0}ZoomUI.prototype={constructor:ZoomUI,Update:function(){var c=this.slideUI.ts,b=this.zoomAreas;var a=b.length-1;while(a>=0&&b[a].startTime>c){--a}this._SetActiveZoom(a,c)},Pause:function(){if(this.pausedTime===undefined){this.pausedTime=+new Date}},Resume:function(){if(this.pausedTime!==undefined){this.startTime+=(new Date).getTime()-this.pausedTime;this.pausedTime=undefined}},Tick:function(){if(this.zooming){return}var d=this.slideUI.ts,b=this.zoomAreas;var c=b.length,a=this.activeIndex+1;while(a<c&&b[a].startTime<=d){++a}--a;if(a!=this.activeIndex){this._SetActiveZoom(a,d)}},Step:function(){if(this.pausedTime!==undefined){return true}var b=+new Date;if(b>=this.startTime+this.duration){this._DoZoom(this.X,this.Y,this.S);this.zooming=false;return false}else{var c=(b-this.startTime)/this.duration;var e=$.easing.easeInOutQuad(c,c,0,1,1);var a=this.preX+(this.X-this.preX)*e;var f=this.preY+(this.Y-this.preY)*e;var d=this.preS/(1-(1-this.preS/this.S)*e);this._DoZoom(a,f,d)}return true},_DoZoom:function(a,f,c){ZoomUI.Scale=c;if(this.element){var b=this.element.style;b.top=(-f*c*Prez.Scale)+"px";b.left=(-a*c*Prez.Scale)+"px";b.width=(100*c)+"%";b.height=(100*c)+"%"}c*=Prez.Scale;var d,e;if(Prez.prjSldUI){Prez.prjSldUI.ZoomPointerEffect(c);d=Prez.prjSldUI.allCtrlUIs;for(e in d){d[e].Zoom(c,true)}}d=this.slideUI.allCtrlUIs;for(e in d){d[e].Zoom(c,true)}},_SetActiveZoom:function(b,a){EffectMan.StopZoom(this);this.activeIndex=b;var d=this.zoomAreas[b-1];if(d){this.preX=d.pos.l;this.preY=d.pos.t;this.preS=d.scale/100}else{this.preX=this.preY=0;this.preS=1}d=this.zoomAreas[b];if(d){this.duration=d.inDuration;this.X=d.pos.l;this.Y=d.pos.t;this.S=d.scale/100;var c=a-d.startTime;if(c>=d.inDuration){this._DoZoom(this.X,this.Y,this.S);this.zooming=false}else{this.startTime=(new Date).getTime()-c;this.zooming=true;if(this.Step()){EffectMan.StartZoom(this)}}}else{this.X=this.Y=0;this.S=1;this._DoZoom(this.X,this.Y,this.S);this.zooming=false}},CleanUp:function(){EffectMan.StopZoom(this);this._DoZoom(0,0,1);this.element=null}};var ClosedCaptionUI={FSMARGIN:5,MARGIN:5,Init:function(){if(this.inited){return}this.id=UI.IDs.ClosedCaption;this.bgId=this.id+"_bg";this.textId=this.id+"_txt";this.$CCaption=$("#"+this.id);this.$CCaption.css("z-index",ZIndexBase.ClosedCaption);this.show=false;if(TemplateParams.IniCCShow){this.Show(true)}else{this.Show(false)}if(Options.zoom_percent!=100&&this.MARGIN==this.FSMARGIN){this.MARGIN=Math.floor((this.FSMARGIN*Options.zoom_percent)/100)}if(g_closedCaption.fscss!==undefined){g_closedCaption.css=g_closedCaption.fscss;if(Options.zoom_percent!=100){g_closedCaption.html="";ScaleFont(g_closedCaption,Options.zoom_percent/100)}delete g_closedCaption.fscss;delete g_closedCaption.html}this.$CCaption.empty();this.$CCaption.append('<img id="'+this.bgId+'" class="bgimg" alt="" src="data/'+g_closedCaption.bgimg+'" />');this.caption="";this.rect={t:0,l:0,w:2*this.MARGIN+1,h:2*this.MARGIN+1};this.$CCaption.append(this._GetCaptionNodeHTML(Prez.Scale));this.$Text=$("#"+this.textId);this.ClearCaption();this.inited=true},IsShown:function(){return this.show},Show:function(a){if(a===undefined){a=true}this.show=a;if(a){this.$CCaption.css("display","block");if(this.inited){var b=this.$Text.height()/Prez.Scale+2*this.MARGIN;this.rect.t-=b-this.rect.h;this.rect.h=b;this.$CCaption.css({top:(this.rect.t*Prez.Scale)+"px",height:(this.rect.h*Prez.Scale)+"px"})}}else{this.$CCaption.css("display","none")}if(UI.Toolbar){UI.Toolbar.SetCCaption(a)}},ToggleShow:function(){this.Show(!this.show)},SetCaption:function(a,c){this.rect={t:c.t,l:c.l,w:c.w,h:c.h};this.caption=a;this.$Text.html(a);this.$Text.width((c.w-2*this.MARGIN)*Prez.Scale);var b=this.$Text.height()/Prez.Scale+2*this.MARGIN;this.rect.t-=b-this.rect.h;this.rect.h=b;this.$CCaption.css({top:(this.rect.t*Prez.Scale)+"px",left:(this.rect.l*Prez.Scale)+"px",width:(this.rect.w*Prez.Scale)+"px",height:(this.rect.h*Prez.Scale)+"px",visibility:"visible"})},ClearCaption:function(){this.$CCaption.css("visibility","hidden")},Zoom:function(){if(!this.inited){return}this.$Text.replaceWith(this._GetCaptionNodeHTML(Prez.Scale));this.$Text=$("#"+this.textId);var a=this.$Text.height()/Prez.Scale+2*this.MARGIN;this.rect.t-=a-this.rect.h;this.rect.h=a;this.$CCaption.css({top:(this.rect.t*Prez.Scale)+"px",left:(this.rect.l*Prez.Scale)+"px",width:(this.rect.w*Prez.Scale)+"px",height:(this.rect.h*Prez.Scale)+"px"})},_GetCaptionNodeHTML:function(b){var a={css:g_closedCaption.css,html:this.caption};if(b!=1){ScaleFont(a,b)}return'<div id="'+this.textId+'" style="position:absolute;top:'+(this.MARGIN*b)+"px;left:"+(this.MARGIN*b)+"px;width:"+((this.rect.w-2*this.MARGIN)*b)+"px;"+a.css+'">'+a.html+"</div>"}};function SlideCCaptionUI(c,a){this.caption=c;this.slideUI=a;this.nodes=c.nodes;this.curNode=null;this.curIdx=-1;this.curNodeShow=false;if(!c.inited){var b=c.nodes,e=Options.zoom_percent/100,g=(Options.zoom_percent!=100),f,d,h;for(d=0,h=b.length;d<h;++d){f=b[d];if(f.fshtml!==undefined){f.html=f.fshtml;if(g){f.css="";ScaleFont(f,e)}delete f.fshtml;delete f.css}}c.inited=true}}SlideCCaptionUI.prototype={constructor:SlideCCaptionUI,Update:function(){this.curIdx=-1;this.curNode=null;ClosedCaptionUI.ClearCaption();var c,b,d,a=this.slideUI.ts+Prez.INTERVAL;for(b=0,d=this.nodes.length;b<d;++b){c=this.nodes[b];if((c.startTime+c.duration>=a)&&c.duration!=0){this.curIdx=b;this.curNode=c;this._ShowCurrentNode(c.startTime<a);return}}},Tick:function(){if(!this.curNode){return}var b=this.curNode,a=this.slideUI.ts+Prez.INTERVAL;if(this.curNodeShow){if(b.startTime+b.duration<a){do{++this.curIdx;b=this.nodes[this.curIdx]}while(b&&b.duration==0);this.curNode=b;this._ShowCurrentNode(b&&b.startTime<a)}}else{if(this.curNode.startTime<a){this._ShowCurrentNode(true)}}},UpdatePrezStateChanged:function(){},_ShowCurrentNode:function(a){if(a===undefined){a=true}this.curNodeShow=a;if(a&&this.curNode){ClosedCaptionUI.SetCaption(this.curNode.html,this.curNode.rect)}else{ClosedCaptionUI.ClearCaption()}},CleanUp:function(){}};Effect.Type={NONE:0,FADE:1,FLY:2,PEEK:3,WIPE:4,HILIGHT:500,ZOOM:501};Effect.Dir={NONE:0,BOTTOM:1,LEFT:2,RIGHT:3,TOP:4,BOTTOM_LEFT:5,BOTTOM_RIGHT:6,TOP_LEFT:7,TOP_RIGHT:8};function Effect(){}Effect.prototype={constructor:Effect,Start:function(b,d,a){a=a||{};this.elem=b;this.callback=a.callback;this.secondStream=a.secondStream;if(!d){if(a.callback){window.setTimeout(function(){a.callback.call(b)},1)}return false}if(a.exitEffect){this.starts=d.ends;this.ends=d.starts;this.mStarts=d.mEnds;this.mEnds=d.mStarts}else{this.starts=d.starts;this.ends=d.ends;this.mStarts=d.mStarts;this.mEnds=d.mEnds}this.duration=d.duration;var c=a.startTime;if(isNaN(c)||c<0){c=0}this.startTime=(new Date).getTime()-c;return this.Step(false,true,true)},Pause:function(){if(this.pausedTime===undefined){this.pausedTime=+new Date}},Resume:function(){if(this.pausedTime!==undefined){this.startTime+=(new Date).getTime()-this.pausedTime;this.pausedTime=undefined}},Step:function(e,h,p){if(this.pausedTime!==undefined&&!e){return true}if(!this.elem){return false}var m,a,q,d,n,g={},b=p?this.startTime:(+new Date),c=ZoomUI.Scale*Prez.Scale;if(e||b>=this.duration+this.startTime){n=this.ends;if(n){for(a in n){g[a]=n[a];if((c!=1)&&(a=="left"||a=="top"||a=="width"||a=="height")){g[a]*=c}}}if(g.opacity==1){g.opacity=""}if(this.mEnds){if(UI.IEBrowser){var k=$(this.elem).attr("style");if(k){$(this.elem).attr("style",k.replace(/clip[^;]+;?/gi,""))}$(this.elem).css(g)}else{g.clip="";$(this.elem).css(g)}}else{$(this.elem).css(g)}if(this.callback&&(h||h===undefined)){if(p){var f=this;window.setTimeout(function(){if(f&&f.callback&&f.elem){f.callback.call(f.elem)}},1)}else{this.callback.call(this.elem)}}return false}else{var o=(b-this.startTime)/this.duration;m=$.easing.easeInOutQuad(o,o,0,1,1);
d=this.mStarts;n=this.mEnds;if(d){var l={};for(a in d){q=d[a];l[a]=c*(q+(n[a]-q)*m)}g.clip="rect("+l.t+"px "+(l.l+l.w)+"px "+(l.t+l.h)+"px "+l.l+"px)"}d=this.starts;n=this.ends;if(d){for(a in d){q=d[a];g[a]=q+(n[a]-q)*m;if((c!=1)&&(a=="left"||a=="top"||a=="width"||a=="height")){g[a]*=c}}}$(this.elem).css(g)}return true},CleanUp:function(){this.elem=undefined},_Callback:function(){if(this.callback&&this.elem){this.callback.call(this.elem);this.callback=undefined}}};var EffectMan={INTERVAL:40,effects:[],timerId:undefined,zoomUI:null,StartZoom:function(a){this.zoomUI=a;if(Prez.runningStreams&PrezStreams.MAIN){this._CreateTimer()}else{a.Pause()}},StopZoom:function(a){if(this.zoomUI==a){this.zoomUI=null;if(!this.effects.length){this._DeleteTimer()}}},Start:function(c,e,a){var d=new Effect(),b=true;if(d.Start(c,e,a)){this.effects.push(d);if(d.secondStream){if(Prez.runningStreams&PrezStreams.SECOND){b=false}}else{if(Prez.runningStreams&PrezStreams.MAIN){b=false}}if(b){d.Pause()}else{this._CreateTimer()}}},Stop:function(c,b,e){if(!e){e=false}var d=this.effects;for(var a=d.length-1;a>=0;--a){if(d[a].elem==c){if(b){d[a].Step(true,e)}d[a].CleanUp();d.splice(a,1)}}if(!d.length&&!this.zoomUI){this._DeleteTimer()}},Reset:function(c,b){var a={};if(b.opacity!==undefined&&b.opacity!=1){a.opacity=b.opacity}else{a.opacity=""}if(b.top!==undefined){a.top=b.top*ZoomUI.Scale*Prez.Scale}if(b.left!==undefined){a.left=b.left*ZoomUI.Scale*Prez.Scale}if(UI.IEBrowser){var d=$(c).attr("style");if(d){$(c).attr("style",d.replace(/clip[^;]+;?/gi,""))}$(c).css(a)}else{a.clip="";$(c).css(a)}},UpdatePrezStateChanged:function(){this._Step();if(Prez.runningStreams==PrezStreams.NONE){this.Pause(null)}else{if(Prez.runningStreams==PrezStreams.ALL){this.Resume()}else{if(Prez.runningStreams==PrezStreams.SECOND){this.Pause(null,true);this.Resume(null,true)}}}},Pause:function(c,e){var d=this.effects;var b=0,f=d.length,a=0;if(c){for(b=0;b<f;++b){if(d[b].elem==c){if(e&&d[b].secondStream){continue}d[b].Pause();++a}}}else{if(this.zoomUI){this.zoomUI.Pause();++a}for(b=0;b<f;++b){if(e&&d[b].secondStream){continue}d[b].Pause();++a}}if(this.zoomUI){++f}if(a==f){this._DeleteTimer()}},Resume:function(d,b){var e=this.effects,a=false;var c=0,f=e.length;if(d){for(c=0;c<f;++c){if(e[c].elem==d){if(b&&!e[c].secondStream){continue}e[c].Resume();a=true}}}else{if(this.zoomUI&&!b){this.zoomUI.Resume();a=true}for(c=0;c<f;++c){if(b&&!e[c].secondStream){continue}e[c].Resume();a=true}}if(a){this._CreateTimer()}},CleanUp:function(){if(this.zoomUI){this.zoomUI.CleanUp();this.zoomUI=null}var b=this.effects;for(var a=0,c=b.length;a<c;++a){b[a].CleanUp()}b.length=0;this._DeleteTimer()},InitEffect:function(n,h){var d,a,b,k,e=0,c=0;switch(n.type){case Effect.Type.FADE:n.starts={opacity:0};n.ends={opacity:h.opacity!==undefined?h.opacity:1};break;case Effect.Type.FLY:var g;if(h.transform){var m=h.l+h.transform.oX*h.w/100,l=h.t+h.transform.oY*h.h/100,f=[];g={};f.push(RotatePoint(h.l,h.t,h.transform.r,m,l));f.push(RotatePoint(h.l+h.w,h.t,h.transform.r,m,l));f.push(RotatePoint(h.l+h.w,h.t+h.h,h.transform.r,m,l));f.push(RotatePoint(h.l,h.t+h.h,h.transform.r,m,l));f.sort(function(p,o){return p.x-o.x});g.l=f[0].x;g.w=f[3].x-f[0].x;f.sort(function(p,o){return p.y-o.y});g.t=f[0].y;g.h=f[3].y-f[0].y}else{g=h}d=-g.w-g.l;a=-g.h-g.t;b=UI.slideW-g.l;k=UI.slideH-g.t;case Effect.Type.PEEK:case Effect.Type.WIPE:if(n.type!=Effect.Type.FLY){d=-h.w;a=-h.h;b=h.w;k=h.h}switch(n.dir){case Effect.Dir.TOP:c=a;break;case Effect.Dir.BOTTOM:c=k;break;case Effect.Dir.RIGHT:e=b;break;case Effect.Dir.TOP_LEFT:e=d;c=a;break;case Effect.Dir.TOP_RIGHT:e=b;c=a;break;case Effect.Dir.BOTTOM_LEFT:e=d;c=k;break;case Effect.Dir.BOTTOM_RIGHT:e=b;c=k;break;default:e=d;break}if(n.type!=Effect.Type.WIPE){n.starts={left:h.l+e,top:h.t+c};n.ends={left:h.l,top:h.t};if(n.type==Effect.Type.PEEK){n.mStarts={t:h.t-n.starts.top,l:h.l-n.starts.left,w:h.w,h:h.h};n.mEnds={t:h.t-n.ends.top,l:h.l-n.ends.left,w:h.w,h:h.h}}}else{n.mStarts={t:c,l:e,w:h.w,h:h.h};n.mEnds={t:0,l:0,w:h.w,h:h.h}}break}},_Step:function(){if(this.zoomUI&&!this.zoomUI.Step()){this.zoomUI=null}var b=this.effects;for(var a=0;a<b.length;++a){if(!b[a].Step()){b[a].CleanUp();b.splice(a--,1)}}if(!b.length&&!this.zoomUI){this._DeleteTimer()}},_CreateTimer:function(){var a=this;if(!this.timerId){this.timerId=window.setInterval(function(){a._Step()},this.INTERVAL)}},_DeleteTimer:function(){if(this.timerId){window.clearInterval(this.timerId);this.timerId=undefined}}};function InitHandlers(){RemoveHandlers();Key.InitHandlers();Mouse.InitHandlers()}function RemoveHandlers(){Key.RemoveHandlers();Mouse.RemoveHandlers()}var Mouse={CLICK_OUTSIDE:-1,Buttons:{NONE:0,LEFT:1,MIDDLE:2,RIGHT:3,DBLEFT:4,DBRIGHT:5,SCROLLUP:6,SCROLLDOWN:7},DClickDelay:400,clkTimer:undefined,target:null,targetCtrlUI:null,time:undefined,value:undefined,fromTouchEvent:false,_handledTouchEvents:"touchstart pointerdown MSPointerDown",Norm:function(b,a){b.apWhich=b.which;if(a){switch(b.apWhich){case this.Buttons.LEFT:b.apWhich=this.Buttons.DBLEFT;break}}},InitHandlers:function(){Mouse.fromTouchEvent=(BrowserInfo.iDevice||BrowserInfo.android);$(document).bind(Mouse._handledTouchEvents,function(b){var a=b.originalEvent||b;if(a.pointerType!="mouse"&&a.pointerType!=4){Mouse.fromTouchEvent=true;$(document).unbind(Mouse._handledTouchEvents)}else{Mouse.fromTouchEvent=false}});$(document).bind("mousedown",Mouse.OnMouseDown);$(document).bind("mouseup",Mouse.OnMouseUp);$(document).bind("contextmenu",EvtMan.StopEvent)},RemoveHandlers:function(){this.CleanUp();this.fromTouchEvent=false;$(document).unbind(Mouse._handledTouchEvents);$(document).unbind("mousedown",Mouse.OnMouseDown);$(document).unbind("mouseup",Mouse.OnMouseUp);$(document).unbind("contextmenu",EvtMan.StopEvent)},ClickOnSlide:function(a){var b=a.target.id;return b.substr(0,4)=="sld_"||b.substr(0,5)=="ctrl_"||b.substr(0,6)=="appwmk"||b.substr(0,UI.IDs.ClosedCaption.length)==UI.IDs.ClosedCaption},OnMouseDown:function(a){a.timeStamp=(new Date()).getTime();if((Prez.Session.PMode&PlayModes.DEMO)||Prez.runningStreams==PrezStreams.NONE||!Prez.slideUI){Mouse.CleanUp();return EvtMan.StopEvent(a)}if(!Mouse.ClickOnSlide(a)){return}Mouse.Norm(a,false);$(document).trigger("feedback",[a]);if(Mouse.clkTimer===undefined){Mouse.target=a.target;Mouse.targetCtrlUI=null;Mouse.time=a.timeStamp}else{if(a.target!=Mouse.target){Mouse._Submit();Mouse.target=a.target;Mouse.targetCtrlUI=null;Mouse.time=a.timeStamp}}return EvtMan.StopEvent(a)},OnMouseUp:function(c){c.timeStamp=(new Date()).getTime();if((Prez.Session.PMode&PlayModes.DEMO)||Prez.runningStreams==PrezStreams.NONE||!Prez.slideUI){Mouse.CleanUp();return EvtMan.StopEvent(c)}if(!Mouse.target){return EvtMan.StopEvent(c)}if(c.target!=Mouse.target){if(Mouse.clkTimer===undefined){Mouse.target={};Mouse.targetCtrlUI=null;Mouse._Submit()}}else{if(Mouse.clkTimer!==undefined){if(Mouse.targetCtrlUI){Mouse.Norm(c,true);Mouse.value=InputUI.GetEvtValue(c)}Mouse._Submit()}else{Mouse.targetCtrlUI=null;var e=Prez.slideUI.inputUIs,a;var b=e.length;while(b>0){--b;a=e[b].id;if(c.target.id.substr(0,a.length)==a){Mouse.targetCtrlUI=e[b];Mouse.Norm(c,false);Mouse.value=InputUI.GetEvtValue(c);break}}if(Mouse.targetCtrlUI&&Mouse.targetCtrlUI.PlayClickSound){Mouse.targetCtrlUI.PlayClickSound()}var d=c.timeStamp-Mouse.time;if(d>=Mouse.DClickDelay){Mouse._Submit()}else{Mouse.clkTimer=window.setTimeout(function(){Mouse._Submit()},Mouse.DClickDelay-d)}}}return EvtMan.StopEvent(c)},CleanUp:function(){window.clearTimeout(this.clkTimer);this.target=this.targetCtrlUI=null;this.clkTimer=this.time=this.value=undefined},_Submit:function(){if(this.target){if(this.targetCtrlUI){this.targetCtrlUI.Submit(EvtType.CLICK,this.value)}else{var b=Prez.slideUI.inputUIs;for(var a=0,c=b.length;a<c;++a){b[a].Submit(EvtType.CLICK,this.CLICK_OUTSIDE)}}}this.CleanUp()}};var KeyNames={"2":"Middle Click","8":"Backspace","9":"Tab","12":"Clear","13":"Enter","19":"Pause/Break","20":"Caps Lock","27":"Esc","32":"Space","33":"Page Up","34":"Page Down","35":"End","36":"Home","37":"Left Arrow","38":"Up Arrow","39":"Right Arrow","40":"Down Arrow","44":"Print Screen","45":"Insert","46":"Delete","91":"Left Windows","92":"Right Windows","93":"Windows Menu","106":"Numpad *","107":"+","108":"Separator","109":"-","110":"Numpad .","111":"Numpad /","144":"Num Lock","145":"Scroll Lock","59":";","188":",","190":".","191":"/","192":"`","219":"[","220":"\\","221":"]","222":"'"};
var Key={MOD_ALT:1,MOD_CTRL:2,MOD_SHIFT:4,SHIFT:16,CTRL:17,ALT:18,F1:112,F12:123,PRTSCR:44,CANCEL:3,PAUSE:19,TAB:9,NUMBER0:48,NUMBER9:57,A:65,Z:90,NUMPAD0:96,NUMPAD9:105,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,UseMozKey:false,ToMozKey:function(a){if(a==this.CANCEL){return this.PAUSE}if(this.UseMozKey){return a}if(!this.IE2MOZ){this.IE2MOZ=[{ie:186,moz:59},{ie:187,moz:107},{ie:189,moz:109}]}for(var b=0,c=this.IE2MOZ.length;b<c;++b){if(this.IE2MOZ[b].ie==a){return this.IE2MOZ[b].moz}}return a},InitHandlers:function(){$(document).bind("keydown",Key.OnKeyDown);$(document).bind("keyup",Key.OnKeyUp);window.onhelp=EvtMan.StopEvent;document.onhelp=EvtMan.StopEvent;if($.browser.mozilla||$.browser.opera){this.UseMozKey=true}},RemoveHandlers:function(){$(document).unbind("keydown",Key.OnKeyDown);$(document).unbind("keyup",Key.OnKeyUp);window.onhelp=null;document.onhelp=null},ShouldHandleKeyUp:function(a){if(a==this.PRTSCR){return true}return false},OnKeyDown:function(a){if(a.apWhich===undefined){a.apWhich=Key.ToMozKey(a.which)}if(Key.ShouldHandleKeyUp(a.apWhich)){return EvtMan.StopEvent(a)}return Key.HandleKey(a)},OnKeyUp:function(a){if(a.apWhich===undefined){a.apWhich=Key.ToMozKey(a.which)}if(!Key.ShouldHandleKeyUp(a.apWhich)){return EvtMan.StopEvent(a)}return Key.HandleKey(a)},HandleKey:function(b){if(Options.AllowNavigate){if(b.apWhich==Key.TAB&&UI.MoveFocus(b.shiftKey)){return EvtMan.StopEvent(b)}if(b.apWhich==Key.TAB||b.apWhich==Key.SHIFT||b.shiftKey){return}}if((Prez.Session.PMode&PlayModes.DEMO)||Prez.runningStreams==PrezStreams.NONE||!Prez.slideUI){return EvtMan.StopEvent(b)}$(document).trigger("feedback",[b]);var f=InputUI.GetEvtValue(b);var d=false;var a=Prez.slideUI.inputUIs;var c=a.length;if(c==1){if(a[0].ctrl.kind==CtrlKind.TEXTINPUT){if(b.target){var h=b.target.nodeName.toLowerCase();d=(h=="textarea")||(h=="input")}}if(!d){a[0].Submit(EvtType.KEY_DOWN,f)}}else{if(c>1){var e=0;var l=new Array(c);for(e=0;e<c;++e){l[e]=a[e].GetResponse(EvtType.KEY_DOWN,f)}var k=true;for(e=0;e<c;++e){var g=l[e].jud;if(g==Judge.CORRECT||g==Judge.NEUTRAL){a[e].Submit(EvtType.KEY_DOWN,f,l[e]);k=false;break}if(g==Judge.PARTIAL_CORRECT){k=true}}if(k){if(b.target){var h=b.target.nodeName.toLowerCase();d=(h=="textarea")||(h=="input")}if(!d){for(e=0;e<c;++e){if(l[e].jud==Judge.WRONG){if(a[e].Submit(EvtType.KEY_DOWN,f,l[e])===false){break}}}}}}}if(!d||b.altKey||b.ctrlKey||(b.apWhich>=Key.F1&&b.apWhich<=Key.F12)){return EvtMan.StopEvent(b)}}};var Gesture={Type:{NONE:0,SINGLE_TAP:1,DOUBLE_TAP:2,HOLD:3,SINGLE_TAP_2FINGERS:4,DOUBLE_TAP_2FINGERS:5,SWIPE_UP:6,SWIPE_RIGHT:7,SWIPE_DOWN:8,SWIPE_LEFT:9,ROTATE_LEFT:10,ROTATE_RIGHT:11,PINCH_IN:12,PINCH_OUT:13,FINGERS:14}};var MediaPlayerTypes={HTML5:0,FLASH:1,SILVERLIGHT:2};var MediaManager={ePlayerType:MediaPlayerTypes.HTML5,strAudioExt:"mp3",strVideoExt:"mp4",arrPlayerIDs:[],arrPlayerTypes:[],requireAction:true,hasSilverlight:false,hasFlashPlayer:false,Init:function(){if(!Options.ExportHTML5){this.ePlayerType=Options.UseSilverlight?MediaPlayerTypes.SILVERLIGHT:MediaPlayerTypes.FLASH;if(this.ePlayerType==MediaPlayerTypes.SILVERLIGHT){this.hasSilverlight=Silverlight.isInstalled(silverlightVer)}else{this.hasFlashPlayer=getSWFObject().hasFlashPlayerVersion(flashPlayerVer)}return}var e={ogg:'audio/ogg; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"'};var a={mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"'};var d;var c=document.createElement("audio");if(!c.canPlayType){e={}}else{for(d in e){if(!c.canPlayType(e[d]).replace(/^no$/,"")){delete e[d]}}}var b=document.createElement("video");if(!b.canPlayType){a={}}else{for(d in a){if(!b.canPlayType(a[d]).replace(/^no$/,"")){delete a[d]}}}if((!e.mp3&&!e.ogg)||(!a.webm&&!a.mp4)){this.ePlayerType=Options.UseSilverlight?MediaPlayerTypes.SILVERLIGHT:MediaPlayerTypes.FLASH;if(this.ePlayerType==MediaPlayerTypes.SILVERLIGHT){this.hasSilverlight=Silverlight.isInstalled(silverlightVer)}else{this.hasFlashPlayer=getSWFObject().hasFlashPlayerVersion(flashPlayerVer)}}else{if(e.mp3){this.strAudioExt="mp3"}else{if(e.ogg){this.strAudioExt="ogg"}}if(a.mp4){this.strVideoExt="mp4"}else{if(a.webm){this.strVideoExt="webm"}}}},CreatePlayer:function(a,b,c){if(this.ePlayerType==MediaPlayerTypes.HTML5){return new MediaPlayerHTML5(a,b,c)}else{return new MediaPlayer(a,b,c)}},GetPlayerContainerId:function(a,b,c){return"ctrl_"+(c?"audio_":"video_")+b+"_"+a},GetPlayerId:function(a,b){if(this.ePlayerType==MediaPlayerTypes.HTML5){return a+(b?"_audio_player":"_video_player")}else{return a+"_plugin_player"}},CreatePlayerElements:function(b,c,d){var a=this.GetPlayerContainerId(b,c,d);return this.CreatePlayerElements2(a,d)},CreatePlayerElements2:function(a,d){var b="";b+='<div class="ctrl ap-ctrl-media" id="'+a+'" tabindex="-1">';if(this.ePlayerType==MediaPlayerTypes.HTML5){var c=BrowserInfo.ff?"":"";if(d){b+='<audio class="ap-audio-player" id="'+MediaManager.GetPlayerId(a,true)+'"'+c+' tabindex="-1"></audio>'}else{b+='<img src="'+UI.PlayerImageUrl("blank.gif")+'" class="bgimg" id="'+a+'_vend_frame" role="presentation" width="100%" height="100%" />';b+='<video class="ap-video-player" id="'+MediaManager.GetPlayerId(a,false)+'"'+c+' tabindex="-1"></video>';b+='<img src="'+UI.PlayerImageUrl("blank.gif")+'" class="bgimg" id="'+a+'_vstart_frame" role="presentation" width="100%" height="100%" />'}}b+="</div>";this.arrPlayerIDs.push(a);this.arrPlayerTypes.push(d);return b},ClearPlayerIDs:function(){this.arrPlayerIDs=[];this.arrPlayerTypes=[]},InitPlayers:function(p,d){if(!BrowserInfo.android&&!BrowserInfo.iDevice){this.requireAction=false;p.call(d);return}this.players=new Array(this.arrPlayerIDs.length);for(var f=0,c=this.players.length;f<c;++f){this.players[f]=null;var e={context:this,ready:function(){this._OnInitPlayerUpdate(p,d)},end:function(){},statechanged:function(){this._OnInitPlayerUpdate(p,d)}};var h;if(this.arrPlayerTypes[f]){h={mode:"audio",init:true}}else{h={mode:"video",init:true,width:1,height:1,displayheight:1}}this.players[f]=this.CreatePlayer(h,this.arrPlayerIDs[f],e)}var l='<div id="ViewPortDisabler" style="position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:100000;"><img id="UserActionReceiver" src="'+UI.PlayerImageUrl("play.png")+'" style="cursor:pointer;position:absolute;" /></div>';$(document.body).append(l);var g=$("#ViewPortDisabler");var n=$("#StageDiv");var m=g.offset();var b=n.offset();var a=$("#UserActionReceiver");var q=(b.left-m.left)+(n.width()-128)/2;var o=(b.top-m.top)+(n.height()-128)/2;a.css({top:o+"px",left:q+"px"});g.click(function(){return false});var k=this;a.click(function(){k._DispatchUserAction()});this.requireAction=true;this._OnInitPlayerUpdate(p,d)},_OnInitPlayerUpdate:function(e,c){if(!this.requireAction){$("#APInitBuffImg").remove();return}for(var b=0,a=this.players.length;b<a;++b){if(this.players[b].IsRequireUserAction()==true){return}}$("#ViewPortDisabler").remove();var d=this;$(this).oneTime(100,function(){for(var h=0,f=d.players.length;h<f;++h){var g=d.players[h];if(g){g.CleanUp()}}d.players=[];d.requireAction=false;if(e){e.call(c)}})},_DispatchUserAction:function(){for(var c=0,a=this.players.length;c<a;++c){var b=this.players[c];if(b.IsRequireUserAction()){b.DispatchUserAction()}}}};DropHelper.PosType={ABSOLUTE:0,ANCHOR:1,TILE:2};DropHelper.PosTileValue={TOPLEFT_RIGHT:0,BOTTOMLEFT_RIGHT:1,BOTTOMLEFT_TOP:2,TOPLEFT_BOTTOM:3,TOPRIGHT_LEFT:4,BOTTOMRIGHT_LEFT:5,BOTTOMRIGHT_TOP:6,TOPRIGHT_BOTTOM:7};DropHelper.PosTileMargin=0;DropHelper.RevertTime=200;DropHelper.DropTime=200;DropHelper.DefaultDropOpt={scale:100,alpha:255,posType:DropHelper.PosType.ANCHOR,posVal:4,maxAccept:-1,replace:false,acceptAny:true};DropHelper.ZoomEffectScale=1.1;DropHelper.DragEffect=function(a,o,e,d){var m={zIndex:o?ZIndexBase.CtrlDragging:""};if(!$.browser.msie||(parseInt($.browser.version)>=9)){m.opacity=o?0.8:""}a.GetDOM().css(m);if(!a.ctrl.dragOpt){return}switch(a.ctrl.dragOpt.effect){case Effect.Type.HILIGHT:if(o){a.GetDOM().addClass("ap-ctrl-dragging-hilight")
}else{a.GetDOM().removeClass("ap-ctrl-dragging-hilight")}break;case Effect.Type.ZOOM:var c=Prez.Scale*ZoomUI.Scale,n,l,g,f,k={x:parseFloat(a.GetDOM().css("left"))||0,y:parseFloat(a.GetDOM().css("top"))||0},b=a.ctrl.tf,h=a.ctrl.rect;if(o){n=1;l=DropHelper.ZoomEffectScale}else{n=DropHelper.ZoomEffectScale;l=1}if(b){g=k.x+h.w*c*n*b.oX/100;f=k.y+h.h*c*n*b.oY/100;k=RotatePoint(k.x,k.y,b.r,g,f)}k.x=e+(k.x-e)*l/n;k.y=d+(k.y-d)*l/n;if(b){g=e+(g-e)*l/n;f=d+(f-d)*l/n;k=RotatePoint(k.x,k.y,-b.r,g,f)}a.GetDOM().css({left:k.x,top:k.y});a.Zoom(c*l,false);break}};DropHelper.DropHoverEffect=function(a,e){if(!a.ctrl.dropOpt){return}switch(a.ctrl.dropOpt.effect){case Effect.Type.HILIGHT:if(e){a.GetDOM().addClass("ap-ctrl-droppable-hover-hilight")}else{a.GetDOM().removeClass("ap-ctrl-droppable-hover-hilight")}break;case Effect.Type.ZOOM:var f=Prez.Scale*ZoomUI.Scale,c=50,b=50,d={top:f*a.ctrl.rect.t,left:f*a.ctrl.rect.l};if(e){if(a.ctrl.tf){c=a.ctrl.tf.oX;b=a.ctrl.tf.oY}d.top+=f*(b/100*a.ctrl.rect.h*(1-DropHelper.ZoomEffectScale));d.left+=f*(c/100*a.ctrl.rect.w*(1-DropHelper.ZoomEffectScale));f*=DropHelper.ZoomEffectScale}a.GetDOM().css(d);a.Zoom(f,false);break}};function DropHelper(a){this.dropUI=a;this.droppedUIs=[];this.droppedZIdx=ZIndexBase.CtrlDroppedBase}DropHelper.prototype={constructor:DropHelper,GetDroppedUIs:function(){return this.droppedUIs},GetDroppedStrIDs:function(){var b=[],a,c;for(a=0,c=this.droppedUIs.length;a<c;++a){b.push(this.droppedUIs[a].ctrl.id+"")}return b},Drop:function(c,a,q){if(q===undefined){q=true}var h=this.dropUI,g=this.dropUI.ctrl.dropOpt||DropHelper.DefaultDropOpt,e=Prez.Scale*ZoomUI.Scale,f=g.maxAccept<0||this.droppedUIs.length<g.maxAccept,d=false,p=false;if(c.parentUI!=h.parentUI){f=false}else{if(!f){if(this.droppedUIs.length==g.maxAccept&&g.maxAccept>0){if(g.replace){d=true;f=true}else{p=true}}}if((f||p)&&!g.acceptAny){if(!h.evtMan.HasEvent(EvtType.ACCEPT_SPECIFIC,c.ctrl.id)){f=d=p=false}}}if(!f){if(q){c.GetDOM().animate({top:c.ctrl.rect.t*e,left:c.ctrl.rect.l*e},DropHelper.RevertTime,function(){if(h.ctrl.kind==CtrlKind.DROP&&!p){h.Submit(EvtType.REJECT,c)}else{var r=h.evtMan.GetActions(EvtType.REJECT);if(r.length){EvtMan.DoActions(r)}}})}else{c.GetDOM().css({top:c.ctrl.rect.t*e,left:c.ctrl.rect.l*e})}if(p){return}else{return false}}if(d){var m=this.droppedUIs[this.droppedUIs.length-1];if(m){this.StartDragOut(m,{revertPos:true,revertTime:(q?DropHelper.RevertTime:0)})}}this.droppedUIs.push(c);c.SetDropCtrlUI(h);var l={w:c.ctrl.rect.w,h:c.ctrl.rect.h};if(!isNaN(g.scale)&&g.scale!=100){l.w*=g.scale/100;l.h*=g.scale/100}switch(g.posType){default:g.posType=DropHelper.DefaultDropOpt.posType;g.posVal=DropHelper.DefaultDropOpt.posVal;case DropHelper.PosType.ANCHOR:this.GetAnchorPos(l,h.ctrl.rect,g.posVal);break;case DropHelper.PosType.TILE:this.GetNextTilePos(l,h.ctrl.rect,g.posVal);break;case DropHelper.PosType.ABSOLUTE:l.t=a.top/e;l.l=a.left/e;break}if(!isNaN(g.scale)&&g.scale!=100){c.scale=g.scale/100;c.Zoom(e,false)}c.GetDOM().css("z-index",this.droppedZIdx++);var o={top:l.t*e,left:l.l*e};c.pos={t:l.t,l:l.l};if(g.alpha!=255){o.opacity=g.alpha/255;c.opacity=o.opacity}var n=c.ctrl.tf,k=h.ctrl.tf,b=h.ctrl.rect;if(k){o.rlTransformOrg={sX:n?n.oX:50,sY:n?n.oY:50,eX:100*(b.l+b.w*k.oX/100-l.l)/l.w,eY:100*(b.t+b.h*k.oY/100-l.t)/l.h};o.rlRotate={s:n?n.r:0,e:k.r}}else{if(n){o.rlRotate={s:n.r,e:0}}}if(o.rlRotate){c.transform={r:o.rlRotate.e,oX:50,oY:50};if(o.rlTransformOrg){c.transform.oX=o.rlTransformOrg.eX;c.transform.oY=o.rlTransformOrg.eY}}c.InitEffects(false);if(q){c.GetDOM().animate(o,DropHelper.RevertTime,function(){if(h.ctrl.kind==CtrlKind.DROP){h.Submit(EvtType.ACCEPT,c)}else{var r=h.evtMan.GetActions(EvtType.ACCEPT_SPECIFIC,c.ctrl.id).concat(h.evtMan.GetActions(EvtType.ACCEPT));if(r.length){EvtMan.DoActions(r)}}})}else{c.GetDOM().css(o)}return true},StartDragOut:function(c,q){var k=$.inArray(c,this.droppedUIs);if(k<0){return true}if(!q){q={}}var f=this.dropUI.ctrl.dropOpt||DropHelper.DefaultDropOpt,d=Prez.Scale*ZoomUI.Scale,a=1,m=c.ctrl.tf,l=this.dropUI.ctrl.tf,h={w:c.ctrl.rect.w,h:c.ctrl.rect.h},b=this.dropUI.ctrl.rect,o={};if(!isNaN(f.scale)&&f.scale!=100){a=f.scale/100;h.w*=a;h.h*=a}h.t=c.pos.t;h.l=c.pos.l;delete c.pos;delete c.scale;delete c.opacity;delete c.transform;this.droppedUIs.splice(k,1);c.ClearDropCtrlUI();c.InitEffects(false);if(l){o.rlTransformOrg={sX:100*(b.l+b.w*l.oX/100-h.l)/h.w,sY:100*(b.t+b.h*l.oY/100-h.t)/h.h,eX:m?m.oX:50,eY:m?m.oY:50};o.rlRotate={s:l.r,e:m?m.r:0}}else{if(m){o.rlRotate={s:0,e:m.r}}}if(q.revertPos){o.top=c.ctrl.rect.t*d;o.left=c.ctrl.rect.l*d}else{if(q.mouseX!==undefined&&q.mouseY!==undefined){var g,e,n={x:h.l*d,y:h.t*d},p={x:n.x+d*h.w*(m?m.oX:50)/100,y:n.y+d*h.h*(m?m.oY:50)/100};if(o.rlRotate&&o.rlRotate.s){g=n.x+d*h.w*o.rlTransformOrg.sX/100;e=n.y+d*h.h*o.rlTransformOrg.sY/100;n=RotatePoint(n.x,n.y,o.rlRotate.s,g,e);p=RotatePoint(p.x,p.y,o.rlRotate.s,g,e)}if(o.rlRotate&&o.rlRotate.e!=o.rlRotate.s){n=RotatePoint(n.x,n.y,o.rlRotate.e-o.rlRotate.s,q.mouseX,q.mouseY);p=RotatePoint(p.x,p.y,o.rlRotate.e-o.rlRotate.s,q.mouseX,q.mouseY)}if(a!=1){n.x=q.mouseX+(n.x-q.mouseX)/a;n.y=q.mouseY+(n.y-q.mouseY)/a;p.x=q.mouseX+(p.x-q.mouseX)/a;p.y=q.mouseY+(p.y-q.mouseY)/a}if(m){n=RotatePoint(n.x,n.y,-m.r,p.x,p.y)}o.left=n.x;o.top=n.y}}if(a!=1){c.Zoom(d,false)}if(q.revertPos&&q.revertTime){c.GetDOM().animate(o,q.revertTime,function(){var r={zIndex:""};if(f.alpha!=255){r.opacity=""}$(this).css(r)})}else{o.zIndex="";if(f.alpha!=255){o.opacity=""}c.GetDOM().css(o)}if(f.posType==DropHelper.PosType.TILE){this.nextTileX=this.tileY=this.tileH=0;for(k=0;k<this.droppedUIs.length;++k){c=this.droppedUIs[k];h={w:c.ctrl.rect.w,h:c.ctrl.rect.h};if(a!=1){h.w*=a;h.h*=a}this.GetNextTilePos(h,this.dropUI.ctrl.rect,f.posVal);o={top:h.t*d,left:h.l*d};if(l){o.rlTransformOrg={eX:100*(b.l+b.w*l.oX/100-h.l)/h.w,eY:100*(b.t+b.h*l.oY/100-h.t)/h.h}}c.GetDOM().css(o);c.pos={t:h.t,l:h.l};c.InitEffects(false)}}return true},ResetAllDropped:function(){while(this.droppedUIs.length){var a=this.droppedUIs[this.droppedUIs.length-1];this.StartDragOut(a,{revertPos:true})}},IsAbsoluteDroppedPos:function(){var a=this.dropUI.ctrl.dropOpt||DropHelper.DefaultDropOpt;return a.posType==DropHelper.PosType.ABSOLUTE},GetAnchorPos:function(b,c,a){b.t=c.t+(c.h-b.h)*Math.floor(a/3)/2;b.l=c.l+(c.w-b.w)*(a%3)/2},GetNextTilePos:function(d,k,e){if(!this.nextTileX){this.nextTileX=DropHelper.PosTileMargin}if(!this.tileY){this.tileY=DropHelper.PosTileMargin}if(!this.tileH){this.tileH=0}var n,a,g,c,m,f;switch(e){case DropHelper.PosTileValue.TOPLEFT_RIGHT:case DropHelper.PosTileValue.BOTTOMLEFT_RIGHT:case DropHelper.PosTileValue.TOPRIGHT_LEFT:case DropHelper.PosTileValue.BOTTOMRIGHT_LEFT:default:g=d.w;c=d.h;m=k.w;f=false;break;case DropHelper.PosTileValue.BOTTOMLEFT_TOP:case DropHelper.PosTileValue.TOPLEFT_BOTTOM:case DropHelper.PosTileValue.BOTTOMRIGHT_TOP:case DropHelper.PosTileValue.TOPRIGHT_BOTTOM:g=d.h;c=d.w;m=k.h;f=true;break}if(this.nextTileX+g>m){this.tileY+=this.tileH+DropHelper.PosTileMargin;n=this.tileY;a=DropHelper.PosTileMargin;this.nextTileX=a+g+DropHelper.PosTileMargin;this.tileH=c}else{n=this.tileY;a=this.nextTileX;this.nextTileX+=g+DropHelper.PosTileMargin;if(c>this.tileH){this.tileH=c}}if(f){var b;b=n;n=a;a=b}switch(e){case DropHelper.PosTileValue.TOPLEFT_RIGHT:case DropHelper.PosTileValue.TOPLEFT_BOTTOM:default:d.t=k.t+n;d.l=k.l+a;break;case DropHelper.PosTileValue.BOTTOMLEFT_RIGHT:case DropHelper.PosTileValue.BOTTOMLEFT_TOP:d.t=k.t+k.h-n-d.h;d.l=k.l+a;break;case DropHelper.PosTileValue.TOPRIGHT_LEFT:case DropHelper.PosTileValue.TOPRIGHT_BOTTOM:d.t=k.t+n;d.l=k.l+k.w-a-d.w;break;case DropHelper.PosTileValue.BOTTOMRIGHT_LEFT:case DropHelper.PosTileValue.BOTTOMRIGHT_TOP:d.t=k.t+k.h-n-d.h;d.l=k.l+k.w-a-d.w;break}}};
/*!
 * Atomi HTML5 Player - UI Implementations
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2015/07/22
 */
var UI={IDs:{ViewPort:"ViewPortDiv",Stage:"StageDiv",Canvas:"CanvasDiv",ClosedCaption:"CCaptionDiv",Slides:"SlidesDiv"},IEBrowser:false,IEBLOW:false,SlideList:null,Toolbar:null,$Slides:null,slideW:0,slideH:0,AutoFitWindow:TemplateParams.IniAutoFit,dockables:[],focusedPane:null,PlayerImageUrl:function(a){return TemplateParams.ImagePath+a
},GetSlideLayerID:function(a){if(a==1){return"sld_layer1"}else{return"sld_layer2"}},IsAutoFit:function(){return this.AutoFitWindow},EnableAutoFit:function(a){if(a!=this.AutoFitWindow){this.AutoFitWindow=a;this.Layout()}},ToggleAutoFit:function(){this.EnableAutoFit(!this.AutoFitWindow)},BlankImgUrl:function(){return this.PlayerImageUrl("blank.gif")},ViewPort:function(){return $("#"+this.IDs.ViewPort)},Stage:function(){return $("#"+this.IDs.Stage)},Canvas:function(){return $("#"+this.IDs.Canvas)},CanvasScrollParent:function(){return $("#"+this.IDs.Stage)},FindDockable:function(b){for(var a=0;a<this.dockables.length;++a){if(this.dockables[a].GetId()==b){return this.dockables[a]}}return null},LayoutDockPane:function(g,k){var f=(g.attr("id")=="DockPaneLeft"||g.attr("id")=="DockPaneRight");var c=g.children();var b=c.length;var a=TemplateParams.DockPaneSize||250;g.css(f?"width":"height",b<=0?0:a);if(b<=0){return}var m=(k!==undefined);var d=0;var p=0;c.each(function(h,l){var r=$(l);d+=r.outerWidth(true);p+=r.outerHeight(true)});if(d<1){d=1}if(p<1){p=1}if(f){var n=g.height();var o=g.width();var q=0;c.each(function(h,t){var v=$(t);var l=o-parseInt(v.css("border-left-width"))-parseInt(v.css("border-right-width"));v.css("position","absolute").width(l).css("left",0);var s=(h==b-1)?n-q:(m?n/b:v.outerHeight(true)/p*n);var r=s-(parseInt(v.css("border-top-width"))+parseInt(v.css("border-bottom-width")));v.height(r).css("top",q);q+=s;var u=UI.FindDockable(v.attr("id"));if(u){u.LayoutContent();u.EnableMinimize(b>1);if(m){u.ClearMinimizedState()}}})}else{var n=g.height();var o=g.width();var e=0;c.each(function(h,t){var v=$(t);var s=n-parseInt(v.css("border-top-width"))-parseInt(v.css("border-bottom-width"));v.css("position","absolute").height(s).css("top",0);var r=(h==b-1)?o-e:(m?o/b:v.outerWidth(true)/d*o);var l=r-(parseInt(v.css("border-left-width"))+parseInt(v.css("border-right-width")));v.width(l).css("left",e);e+=r;var u=UI.FindDockable(v.attr("id"));if(u){u.LayoutContent();u.EnableMinimize(b>1);if(m){u.ClearMinimizedState()}}})}},Layout:function(){if(!UI.Toolbar){return}var A=UI.Toolbar.GetPadding();var e=UI.Toolbar.GetMinPlayerSize();var f=UI.IsAutoFit();var B=1;var r={w:$(window).innerWidth()-2*B,h:$(window).innerHeight()-2*B};var n=PrezInfo.ViewPort.width,t=PrezInfo.ViewPort.height;var b=$("#DockPaneLeft");var a=$("#DockPaneRight");var E=$("#DockPaneTop");var k=$("#DockPaneBottom");var v=UI.Stage();var d=UI.Canvas();var z=UI.ViewPort();var c=Math.max(e.w-b.width()-a.width()-A.l-A.r,1);var o=Math.max(e.h-E.height()-k.height()-A.t-A.b,1);if(f){var D=Math.max(r.w-b.width()-a.width()-A.l-A.r,1);var g=Math.max(r.h-E.height()-k.height()-A.t-A.b,1);if(D/g<n/t){g=Math.floor(t*D/n)}else{D=Math.floor(n*g/t)}if(D<c||g<o){if(D/g<c/o){D=c;g=t*D/n}else{g=o;D=n*g/t}}v.css("overflow","hidden").width(D).height(g);d.width(D).height(g)}else{var D=Math.min(n,r.w-b.width()-a.width()-A.l-A.r);var g=Math.min(t,r.h-E.height()-k.height()-A.t-A.b);if(D<c){D=c}if(g<o){g=o}v.css("overflow","auto").width(D).height(g);d.width(n-40).height(t-40);d.width(n).height(t)}var q=$("#ViewPortDisabler");var p=$("#UserActionReceiver");if(p.length&&q.length){var C=q.offset();var u=v.offset();var m=(u.left-C.left)+(D-p.width())/2;var l=(u.top-C.top)+(g-p.height())/2;p.css({top:l+"px",left:m+"px"})}z.width(b.width()+v.width()+a.width()+A.l+A.r);z.height(E.height()+v.height()+k.height()+A.t+A.b);z.css("left",Math.floor((r.w-z.width())/2)+B).css("top",0);b.css("left",A.l).css("top",A.t).height(z.height()-A.t-A.b);a.css("left",A.l+b.width()+v.width()).css("top",A.t).height(z.height()-A.t-A.b);E.css("left",A.l+b.width()).css("top",A.t).width(v.width());k.css("left",A.l+b.width()).css("top",A.t+E.height()+v.height()).width(v.width());v.css("left",A.l+b.width()).css("top",A.t+E.height());UI.LayoutDockPane(b);UI.LayoutDockPane(a);UI.LayoutDockPane(E);UI.LayoutDockPane(k);UI.Toolbar.Layout();for(var s=0;s<this.dockables.length;++s){if(this.dockables[s].IsFloating()){this.dockables[s].EnsureInsideStage()}}if(f){Prez.Zoom(v.width()/n)}else{Prez.Zoom(1)}},Init:function(){if(UI.Toolbar){return}var a='<div id="DockPaneLeft" class="ap-dock-pane"></div>\n<div id="DockPaneRight" class="ap-dock-pane"></div>\n<div id="DockPaneTop" class="ap-dock-pane"></div>\n<div id="DockPaneBottom" class="ap-dock-pane"></div>\n<div id="StageDiv" tabindex="-1">\n\t<div id="CanvasDiv" tabindex="-1">\n\t\t<div id="SlidesDiv"></div>\n\t\t<div id="CCaptionDiv"></div>\n\t</div>\n</div>';UI.ViewPort().empty().append(a);var b=location.href;b.toLowerCase();if(b.indexOf("autofit=false")!=-1){this.AutoFitWindow=false}else{if(b.indexOf("autofit=true")!=-1){this.AutoFitWindow=true}}UI.Toolbar=new APToolbar({sliderMin:0,sliderMax:Prez.prjSlide.duration,sliderVal:0});$(window).unbind("resize").resize(this.OnResizeWindow);UI.IEBrowser=$.browser.msie;UI.IEBLOW=(UI.IEBrowser&&(parseInt($.browser.version)<=7));UI.slideW=PrezInfo.ViewPort.width;UI.slideH=PrezInfo.ViewPort.height;UI.Layout()},OnPrezStart:function(a){CanvasNav.Init();$(window).unbind("resize").resize(this.OnResizeWindow);if(a){if(this.SlideList){this.SlideList.Hide();this.SlideList=null}if(this.SlideNotes){this.SlideNotes.Hide();this.SlideNotes=null}}this.$Slides=$("#"+this.IDs.Slides).empty();MediaManager.ClearPlayerIDs();var d=this.GetSlideLayerID(1);var g=this.GetSlideLayerID(2);var m="";for(var c=1;c<=2;++c){var b=(c==1?d:g);m+='<div class="slide" id="'+b+'" style="z-index:'+(c==1?ZIndexBase.SlideCtrlsOld:ZIndexBase.SlideCtrlsNew)+';" onclick="void(0)">';for(var e=0;e<mediaStats.nMaxSlideVideo;++e){m+=MediaManager.CreatePlayerElements(e,b,false)}m+="</div>"}this.$Slides.append(m);if(Prez.prjSlide.wmd){var l="da";l+="ta";l+=":i";l+="ma";l+="ge";l+="/p";l+="ng";l+=";b";l+="as";l+="e6";l+="4,";var h='<img id="appwmk1" class="bgimg ap-wmk" style="display:none; pointer-events:none;" src="'+l+Prez.prjSlide.wmd+'" alt="'+PrezInfo.Generator+'" width="100%" height="100%" />';var f='<img id="appwmk2" class="bgimg ap-wmk" style="display:none; pointer-events:none;" src="'+l+Prez.prjSlide.wmd+'" alt="'+PrezInfo.Generator+'" width="100%" height="100%" />';$(h).error(function(){$("#appwmk1").remove()}).appendTo($("#"+d));$(f).error(function(){$("#appwmk2").remove()}).appendTo("#"+g)}this.Toolbar.Show();this.Toolbar.SetListener("onSeeking",UI,"OnSeeking");this.Toolbar.SetListener("onVolumeChanging",UI,"OnVolumeChanging");ClosedCaptionUI.Init();if(!this.SlideList&&TemplateParams.IniSlideListShow&&this.HasSlideList()){this.ShowSlideList()}if(!this.SlideNotes&&TemplateParams.IniSlideNotesShow&&this.HasSlideNotes()){this.ShowSlideNotes()}this.Layout()},HasSlideList:function(){if(TemplateParams.SlideListPos==UIPos.NONE){return false}if(TemplateParams.AlwaysShowSlideList){return true}if(Prez.Session.PMode!=PlayModes.PRAC&&Prez.Session.PMode!=PlayModes.TEST){return true}return false},HasSlideNotes:function(){return false;if(TemplateParams.SlideNotesPos==UIPos.NONE){return false}if(TemplateParams.AlwaysShowSlideNotes){return true}if(Prez.Session.PMode!=PlayModes.PRAC&&Prez.Session.PMode!=PlayModes.TEST){return true}return false},OnResizeWindow:function(a){if(!$(a.target).hasClass("ui-resizable")){UI.Layout()}},CleanUp:function(){CanvasNav.CleanUp();$(window).unbind("resize")},ShowSlideList:function(){if(!this.SlideList){this.SlideList=new SlideListUI();this.SlideList.Show();var a=Prez.GetSlideCompletions();this.SlideList.MarkComplete(a);if(Prez.slideUI){this.SlideList.SetCurrentSlide(Prez.slideUI&&Prez.slideUI.GetIndex())}else{this.SlideList.SetCurrentSlide(-1)}}},ShowSlideNotes:function(){if(!this.SlideNotes){this.SlideNotes=new SlideNotesUI();this.SlideNotes.Show();var a=Prez.GetSlideCompletions();this.SlideNotes.MarkComplete(a);if(Prez.slideUI){this.SlideNotes.SetCurrentSlide(Prez.slideUI&&Prez.slideUI.GetIndex())}else{this.SlideNotes.SetCurrentSlide(-1)}}},OnSeeking:function(g,c,b,f){if(!UI.SlideNavigationEnabled()){return false}var d,a,e=Prez.GetExportedSlides();for(d=e.length-1;d>=0;--d){a=e[d];if(b>=a.startTime){this.Toolbar.SetSliderTip(ToLocalNumber(d+1,PrezInfo.Language));
if(f){Prez.ShowSlide(a,b-a.startTime,false)}return}}},OnVolumeChanging:function(d,b,a,c){Prez.SetVolume(a)},ShowMsg:function(b,f,c,a){if(a==undefined){a=[]}if(f==undefined){f=true}if(c==undefined){c=false}var e=Prez.Pause(PrezStreams.ALL);$(document).bind("reveal.facebox",function(){Key.RemoveHandlers();Mouse.RemoveHandlers();$(document).unbind("reveal.facebox");$.facebox.showClose(f);var k=PrezInfo.TextDir;if(k=="rtl"){$("#facebox").find(".body").attr("dir",k).css("text-align","right");$("#facebox").find(".footer").attr("dir",k).css("text-align","left")}var l=-1;if(f){var h="facebox_close";a.push(h);l=a.length-1;$("#facebox .close").attr({id:h,title:Lang.Close,role:"button",tabindex:"0"}).focus();$("#facebox .close_image").attr("title",Lang.Close)}$("#facebox").attr("role","dialog");$(document).bind("keydown.facebox",function(n){var p=n.which;if(p==Key.TAB){var r=false;if(l>=0&&l<=a.length-1){var q=$("#"+a[l]);if(q.attr("tabindex")==0){r=true;q.attr("tabindex","-1");q.blur()}}if(l<0||l>a.length-1){l=0}else{l+=r?(n.shiftKey?-1:1):0;if(l<0){l=a.length-1}else{if(l>a.length-1){l=0}}}var m=$("#"+a[l]);m.attr("tabindex","0");m.focus()}else{if(p==Key.ESCAPE){$.facebox.trigger("close.facebox")}else{if(p==13||p==32){for(var o=0;o<a.length;++o){if(n.target.id==a[o]){n.stopPropagation();return true}}}}}return false}).bind("focus.facebox",function(n){if(l<0||l>a.length-1){l=0}var m=$("#"+a[l]);m.attr("tabindex","0");m.focus()}).bind("mousedown.facebox",function(m){$(this).focus();return false});for(var g=0;g<a.length;++g){$("#"+a[g]).focus(function(m){l=$.inArray($(this).attr("id"),a);$(this).attr("tabindex","0")}).blur(function(m){$(this).attr("tabindex","-1")})}$(document).focus()});var d=function(){$(document).unbind("mousedown.facebox").unbind("focus.facebox").unbind("keydown.facebox").unbind("close.facebox",d);Key.InitHandlers();Mouse.InitHandlers();if(c==true){Prez.Close(false)}else{Prez.Resume(e)}};$(document).bind("close.facebox",d);$.facebox(b)},ShowAbout:function(){var b=[];var a="";if(PrezInfo.Homepage!=""){a="<a id='about_homepage' href='"+PrezInfo.Homepage.quoteHTML()+"' target='_blank' tabindex='-1'>"+PrezInfo.Homepage.quoteHTML()+"</a>";b.push("about_homepage")}var c="<div style='font-family:verdana;font-size:14px;line-height:1.8;color:green;padding:5px;'>";c+="<b>"+PrezInfo.Name.quoteHTML()+"</b><br />"+Lang.Author+": <b>"+PrezInfo.Author.quoteHTML()+"</b><br />"+Lang.Copyright+": <b>"+PrezInfo.Copyright.quoteHTML()+"</b><br />"+Lang.Homepage+": <b>"+a+"</b></div><div style='font-family:verdana;font-size:10px;line-height:1.8;color:green;border-top:solid 1px #DDDDDD;padding:5px;'>"+Lang.BuiltWith+" <a id ='about_app_home' dir='ltr' href='"+PrezInfo.AppHomePage+"' title='"+PrezInfo.AppHomePage+"' target='_blank' tabindex = '-1'>"+PrezInfo.Generator.quoteHTML()+"</a><br />Atomi Systems, Inc.</div>";b.push("about_app_home");UI.ShowMsg(c,true,false,b)},UpdateTemplateParamsChanged:function(){var a=this;$(this).everyTime(500,"UpdatePrezParams",function(){if(!Prez.started){return}$(a).stopTime("UpdatePrezParams");if(UI.Toolbar){UI.Toolbar.Hide();UI.Toolbar=new APToolbar({sliderMin:0,sliderMax:Prez.prjSlide.duration,sliderVal:0});UI.Toolbar.Show();UI.Toolbar.SetListener("onSeeking",UI,"OnSeeking");UI.Toolbar.SetListener("onVolumeChanging",UI,"OnVolumeChanging")}if(UI.SlideList){UI.SlideList.Hide();UI.SlideList=undefined}if(UI.SlideNotes){UI.SlideNotes.Hide();UI.SlideNotes=undefined}if(!UI.SlideList&&TemplateParams.IniSlideListShow&&UI.HasSlideList()){UI.ShowSlideList()}if(!UI.SlideNotes&&TemplateParams.IniSlideNotesShow&&UI.HasSlideNotes()){UI.ShowSlideNotes()}UI.Layout()})},AddDockable:function(a){this.dockables.push(a)},RemoveDockable:function(a){this.dockables=jQuery.grep(this.dockables,function(b){return b!=a})},MoveFocus:function(e){var b=[CanvasNav];if(this.Toolbar){b.push(this.Toolbar)}if(this.SlideList){b.push(this.SlideList)}if(this.SlideNotes){b.push(this.SlideNotes)}var c=$.inArray(this.focusedPane,b),a=b.length,d=null;if(c<0){if(e){c=a}else{c=-1}}while(true){if(e){--c}else{++c}d=b[c];if(!d){this.focusedPane=null;return false}if(this.FocusPane(d)){return true}}return false},FocusPane:function(a){if(a&&a.Focus&&a.Focus()){this.focusedPane=a;return true}return false},OnPaneFocused:function(a){UI.focusedPane=a},SlideNavigationEnabled:function(){if(Prez.Session.PMode==PlayModes.PRAC){return(TemplateParams.NavInPractice==1)}else{if(Prez.Session.PMode==PlayModes.TEST){return false}}return true}};var CanvasNav={_focusedCtrlUI:null,Init:function(){UI.Canvas().bind("focusin.nav",function(){UI.OnPaneFocused(CanvasNav)});this._focusedCtrlUI=null;if(!Options.AllowNavigate){return}UI.Canvas().bind("keydown.nav",function(c){if(c.which!=Key.TAB){return}if((Prez.Session.PMode&PlayModes.DEMO)||!Prez.slideUI){return}var d=Prez.slideUI.ctrlUIs;var a=$.inArray(CanvasNav._focusedCtrlUI,d),e=null;if(c.shiftKey){if(a<0){a=d.length}e=CanvasNav._GetNextFocusedCtrl(a-1,true)}else{if(a<0){a=-1}e=CanvasNav._GetNextFocusedCtrl(a+1,false)}var b=CanvasNav._focusedCtrlUI;if(e&&e.Focus()){if(b&&b!=e&&b.IsShown()){b.MouseLeave()}e.MouseEnter();CanvasNav._focusedCtrlUI=e;return EvtMan.StopEvent(c)}if(b&&b.IsShown()){b.MouseLeave()}}).bind("mousedown",function(){CanvasNav.Focus(false,true)})},CleanUp:function(){UI.Canvas().unbind(".nav");this._focusedCtrlUI=null},Focus:function(a,c){if(a===undefined){a=true}var b=this._focusedCtrlUI;if(!b||!b.IsFocusable()){b=this._GetNextFocusedCtrl(0,false)}this._focusedCtrlUI=null;var e,d;if(c){e=UI.CanvasScrollParent().scrollLeft();d=UI.CanvasScrollParent().scrollTop()}if(b&&b.Focus()){if(a){b.MouseEnter()}this._focusedCtrlUI=b}else{if(!c){c=true;e=UI.CanvasScrollParent().scrollLeft();d=UI.CanvasScrollParent().scrollTop()}UI.Canvas().focus()}if(c){UI.CanvasScrollParent().scrollLeft(e).scrollTop(d)}return true},GetFocusedCtrl:function(){return this._focusedCtrlUI},OnCtrlFocused:function(a){CanvasNav._focusedCtrlUI=a},_GetNextFocusedCtrl:function(c,e){if(!Prez.slideUI){return null}var a,d,b=Prez.slideUI.ctrlUIs;if(e){for(a=c;a>=0;--a){if(b[a].IsFocusable()){return b[a]}}}else{for(a=c,d=b.length;a<d;++a){if(b[a].IsFocusable()){return b[a]}}}return null}};var DockPosition={LEFT:UIPos.LEFT,TOP:UIPos.TOP,RIGHT:UIPos.RIGHT,BOTTOM:UIPos.BOTTOM};var nDockableOffset=0;function DockableUI(a){this.id=a;this.rect={x:100+nDockableOffset*20,y:100+nDockableOffset*20,w:300,h:200};this.nSavedDockedSize=100;nDockableOffset++;this.eDockPos=DockPosition.RIGHT;this.nDockIndex=0;this.bFloat=true;this.bMinimized=false;this.eDockHintPos=null;this.nDockZIndex=ZIndexBase.SlideList+1;this.nHintZIndex=ZIndexBase.SlideList+2;this.nFloatZIndex=ZIndexBase.SlideList+3;this.bKeyNavEnabled=Options.AllowNavigate;this.bHighConstrastSupport=true;this.arrNavItems=[];this.nFocusedItemIndex=-1;this.bMoveOrResizeByKey=false}$.extend(DockableUI.prototype,{constructor:DockableUI,GetId:function(){return this.id},IsFloating:function(){return this.bFloat},GetDockPos:function(){return this.eDockPos},GetBestMinSize:function(){var c=$("#"+this.id+"_title");var a=c.find(".ap-dockable-title-bar-text");var b=c.find(".ap-dockable-button-pane");return{w:a.width()+b.width()+20,h:c.height()}},_GetContent:function(){},_GetTitle:function(){},_GetButtonHTML:function(){var a='<div class="ap-dockable-button-pane"><span id="'+this.id+'_minimize_restore" class="ap-dockable-button ap-dockable-button-minimize" title="'+Lang.Minimize+'" role="button" tabindex="-1" aria-pressed="'+this.bMinimized+'" aria-disabled="false"></span><span id="'+this.id+'_toogle_dock" class="ap-dockable-button" role="button" tabindex="-1" aria-pressed="'+this.bFloat+'"></span><span id="'+this.id+'_close" class="ap-dockable-button ap-dockable-button-close" title="'+Lang.Close+'" role="button" tabindex="-1"></span></div>';return a},_GetHTML:function(){var a='<div id="'+this.id+'" class="ap-dockable '+(PrezInfo.TextDir=="rtl"?"ap-dockable-rtl":"ap-dockable-ltr")+'" tabindex="-1"><div id="'+this.id+'_title" class="ap-dockable-title-bar"><div class="ap-dockable-title-bar-text">'+this._GetTitle()+"</div>"+this._GetButtonHTML()+'</div><div id="'+this.id+'_content" class="ap-dockable-content"><div id="'+this.id+'_content_inner" class="ap-dockable-content-inner">'+this._GetContent()+"</div></div></div>";
return a},_GetDockPane:function(a){if(a===undefined){return null}switch(a){case DockPosition.LEFT:return $("#DockPaneLeft");case DockPosition.RIGHT:return $("#DockPaneRight");case DockPosition.TOP:return $("#DockPaneTop");case DockPosition.BOTTOM:return $("#DockPaneBottom")}return null},_GetSuggestedDockPos:function(){var e=5;var m=$("#"+this.id);var g=UI.Stage();var c=m.offset();var h=g.offset();var f=c.left-h.left;var a=c.top-h.top;var b=(h.left+g.width())-(c.left+m.width());var l=(h.top+g.height())-(c.top+m.height());var d=Math.min(f,a,b,l);var k=null;if(d<e){if(d==f){k=DockPosition.LEFT}else{if(d==b){k=DockPosition.RIGHT}else{if(d==a){k=DockPosition.TOP}else{if(d==l){k=DockPosition.BOTTOM}}}}}return k},_InitHighConstrastSupport:function(){$("#"+this.id).find(".ap-dockable-button").each(function(){$(this).append('<img src="'+UI.PlayerImageUrl("icons.png")+'" alt="'+$(this).attr("title")+'"/>');$(this).css("background","none");$(this).attr("dir","ltr")});$("#"+this.id).find(".ap-icon").each(function(){$(this).append('<img src="'+UI.PlayerImageUrl("icons.png")+'" alt="'+$(this).attr("title")+'"/>');$(this).css("background","none");$(this).attr("dir","ltr")})},_InitKeyNavSupport:function(){var b=this;$("#"+this.id).mousedown(function(c){c.stopPropagation();return true}).keydown(function(f){var o=f.which;if(o==Key.TAB){var g=b.nFocusedItemIndex;var d=b.arrNavItems;if(g>=0&&g<d.length){var p=$("#"+d[g]);p.attr("tabindex","-1");p.blur()}if((f.shiftKey&&g==0)||(!f.shiftKey&&g>=d.length-1)){b.nFocusedItemIndex=-1;return true}b.nFocusedItemIndex=g<0?0:g+(f.shiftKey?-1:1);var p=$("#"+d[b.nFocusedItemIndex]);p.attr("tabindex","0");p.focus()}else{if(o==32||o==13){var h=$(f.target);if(h.hasClass("ap-dockable-button")){h.trigger("click")}}else{if((o==37||o==38||o==39||o==40)&&(f.shiftKey||f.altKey)){if(!b.bFloat){return false}if(!b.bMoveOrResizeByKey){b.bMoveOrResizeByKey=true;b._SavePosAndSize()}var q=$("#"+this.id);var m=UI.Canvas();var l={l:parseInt(m.css("left")),t:parseInt(m.css("top")),w:m.width(),h:m.height()};var c={l:parseInt(q.css("left")),t:parseInt(q.css("top")),w:q.width(),h:q.height()};var k=5;if(f.shiftKey){c.w+=(o==37?-k:(o==39?k:0));c.h+=(o==38?-k:(o==40?k:0));if(c.w<1){c.w=1}if(c.h<1){c.h=1}if(c.l+c.w>l.l+l.w){c.w=l.l+l.w-c.l}if(c.t+c.h>l.t+l.h){c.h=l.t+l.h-c.t}}else{c.l+=(o==37?-k:(o==39?k:0));c.t+=(o==38?-k:(o==40?k:0));if(c.l<l.l){c.l=l.l}if(c.t<l.t){c.t=l.t}if(c.l+c.w>l.l+l.w){c.l=l.l+l.w-c.w}if(c.t+c.h>l.t+l.h){c.t=l.t+l.h-c.h}}var n=b._GetSuggestedDockPos();if(n==null){b._HideDockHint()}else{b._ShowDockHint(n)}var e=(c.w!=q.width()||c.h!=q.height());q.css({left:c.l+"px",top:c.t+"px",width:c.w+"px",height:c.h+"px"});if(e){b.LayoutContent()}}else{return true}}}return false}).keyup(function(c){if(b.bMoveOrResizeByKey){b.bMoveOrResizeByKey=false;b._HideDockHint();var d=b._GetSuggestedDockPos();if(d!=null){b.Dock(d)}}}).focus(function(c){$(this).attr("tabindex","-1");if(b.nFocusedItemIndex<0||b.nFocusedItemIndex>=b.arrNavItems.length){b.nFocusedItemIndex=0}var d=$("#"+b.arrNavItems[b.nFocusedItemIndex]);d.attr("tabindex","0");d.focus();return false});$("#"+this.id+"_title").mousedown(function(c){if(b.nFocusedItemIndex<0||b.nFocusedItemIndex>=b.arrNavItems.length){b.nFocusedItemIndex=0}var d=$("#"+b.arrNavItems[b.nFocusedItemIndex]);d.attr("tabindex","0");d.focus()}).find(".ap-dockable-button").mousedown(function(c){$(this).focus()});for(var a=0;a<b.arrNavItems.length;++a){$("#"+b.arrNavItems[a]).focus(function(c){b.nFocusedItemIndex=$.inArray($(this).attr("id"),b.arrNavItems);$(this).attr("tabindex","0")}).blur(function(c){$(this).attr("tabindex","-1")})}if(b.nFocusedItemIndex>=0&&b.nFocusedItemIndex<b.arrNavItems.length){$("#"+b.arrNavItems[b.nFocusedItemIndex]).focus()}},_Init:function(){if(this.bKeyNavEnabled){this._InitKeyNavSupport()}if(this.bHighConstrastSupport){this._InitHighConstrastSupport()}var a=this;$("#"+this.id+"_minimize_restore").click(function(b){if(a.bMinimized){a.Restore()}else{a.Minimize()}return false});$("#"+this.id+"_toogle_dock").click(function(b){a.ToggleDock();return false});$("#"+this.id+"_close").click(function(b){a.Hide();return false});$("#"+this.id+"_title").attr("unselectable","on").css("user-select","none").on("selectstart",false);$("#"+this.id).css("z-index",this.bFloat?this.nFloatZIndex:this.nDockZIndex)},_IsVerDocked:function(){return(this.eDockPos==DockPosition.RIGHT||this.eDockPos==DockPosition.LEFT)},_IsHozDocked:function(){return(this.eDockPos==DockPosition.TOP||this.eDockPos==DockPosition.BOTTOM)},LayoutContent:function(){var c=$("#"+this.id);var b=$("#"+this.id+"_title");var a=$("#"+this.id+"_content");a.height(c.height()-b.height()-parseInt(b.css("border-bottom-width")));a.width(c.width())},EnsureInsideStage:function(){if(!this.bFloat){return}var d=$("#"+this.id);if(d.length==0){return}var b=UI.Stage();var a={x:parseInt(b.css("left")),y:parseInt(b.css("top")),w:b.width(),h:b.height()};var c={x:parseInt(d.css("left")),y:parseInt(d.css("top")),w:d.width(),h:d.height()};c.w=Math.max(Math.min(b.width(),c.w),1);c.h=Math.max(Math.min(b.height(),c.h),1);c.x=Math.max(Math.min(c.x,a.x+a.w-c.w),a.x);c.y=Math.max(Math.min(c.y,a.y+a.h-c.h),a.y);d.css("left",c.x).css("top",c.y).width(c.w).height(c.h)},_OnStartResizing:function(c,e){var g=$("#"+this.id);var b=g.prev();var d;if(b){d=UI.FindDockable(b.attr("id"))}if(d){if(this._IsVerDocked()){var a=g.height();a-=(parseInt(g.css("border-top-width"))+parseInt(g.css("border-bottom-width")));a+=(b.height()-b.resizable("option","minHeight"));g.resizable("option","maxHeight",a)}else{var f=g.width();f-=(parseInt(g.css("border-left-width"))+parseInt(g.css("border-right-width")));f+=(b.width()-1);g.resizable("option","maxWidth",f);g.resizable("option","minWidth",1)}}else{g.resizable("option","minHeight",g.height());g.resizable("option","maxHeight",g.height());g.resizable("option","minWidth",g.width());g.resizable("option","maxWidth",g.width())}},_OnUpdateResizing:function(c,e){this.LayoutContent();var g=$("#"+this.id);var b=g.prev();if(!b){return}var d=UI.FindDockable(b.attr("id"));if(!d){return}if(this._IsVerDocked()){var f=parseInt(g.css("top"))-parseInt(b.css("top"));f-=(parseInt(b.css("border-top-width"))+parseInt(b.css("border-bottom-width")));b.height(f)}else{if(this._IsHozDocked()){var a=parseInt(g.css("left"))-parseInt(b.css("left"));a-=(parseInt(b.css("border-left-width"))+parseInt(b.css("border-right-width")));b.width(a)}}d.LayoutContent();d.ClearMinimizedState()},_SavePosAndSize:function(){var a=$("#"+this.id);if(a.length==0){return}this.rect.x=parseInt(a.css("left"));this.rect.y=parseInt(a.css("top"));if(!this.bMinimized){this.rect.w=a.width();this.rect.h=a.height()}},Dock:function(c){this._CleanUp();var b=this._GetDockPane(c);if(b){this.eDockPos=c}else{b=this._GetDockPane(this.eDockPos)}this.bFloat=false;if(b){b.append(this._GetHTML());UI.LayoutDockPane(b,true);var a=this;$("#"+this.id).resizable({containment:b,minHeight:$("#"+this.id+"_title").height(),handles:(a._IsVerDocked()?"n":"w"),start:function(d,e){a._OnStartResizing(d,e)},resize:function(d,e){a._OnUpdateResizing(d,e);a.ClearMinimizedState()},stop:function(d,e){a._OnUpdateResizing(d,e)}})}$("#"+this.id+"_toogle_dock").attr({title:Lang.Float,"aria-pressed":this.bFloat}).addClass("ap-dockable-button-dock");UI.AddDockable(this);UI.Layout();this._Init();this.LayoutContent();if(this.bMinimized){this.bMinimized=false;this.Minimize()}},UnDock:function(){this._CleanUp();this.bFloat=true;var c=this;var b=UI.Stage();var a=UI.ViewPort();a.append(this._GetHTML());var d=$("#"+this.id);d.resizable({containment:a,handles:"all",minHeight:$("#"+this.id+"_title").height(),resize:function(e,f){c.LayoutContent();c.ClearMinimizedState()}}).draggable({handle:$("#"+this.id+"_title"),cursor:"move",containment:a,start:function(e,f){c._SavePosAndSize()},drag:function(e,f){var g=c._GetSuggestedDockPos();if(g==null){c._HideDockHint()}else{c._ShowDockHint(g)}},stop:function(e,f){var g=c._GetSuggestedDockPos();c._HideDockHint();if(g!=null){c.Dock(g)
}}});$("#"+this.id+"_toogle_dock").attr({title:Lang.Dock,"aria-pressed":this.bFloat}).addClass("ap-dockable-button-float");d.css("position","absolute").css("left",this.rect.x).css("top",this.rect.y).width(this.rect.w).height(this.rect.h);this._Init();this.LayoutContent();if(this.bMinimized){this.bMinimized=false;this.Minimize()}UI.AddDockable(this)},ToggleDock:function(){if(this.bFloat){this._SavePosAndSize();this.Dock()}else{this.UnDock();this.EnsureInsideStage()}},Show:function(){if(!this.bFloat){this.Dock()}else{this.UnDock()}if(UI.Toolbar){UI.Toolbar.UpdateState()}},_CleanUp:function(){$("#"+this.id).remove();UI.RemoveDockable(this);if(!this.bFloat){var a=this._GetDockPane(this.eDockPos);if(a){UI.LayoutDockPane(a,true);UI.Layout()}}},Hide:function(){if(this.bFloat){this._SavePosAndSize()}this._CleanUp();if(UI.Toolbar){UI.Toolbar.UpdateState()}},IsShown:function(){return UI.ViewPort().find("#"+this.id).length>0},ToggleShow:function(){if(this.IsShown()){this.Hide()}else{this.Show()}},Minimize:function(){if(this.bMinimized){return}if(this.bFloat){this._SavePosAndSize();var p=$("#"+this.id+"_title");var s=p.find(".ap-dockable-title-bar-text");var l=p.find(".ap-dockable-button-pane");var r=$("#"+this.id);r.width(s.width()+l.width()+20);r.height(p.height());this.LayoutContent();this.SetMinimizedState()}else{var r=$("#"+this.id);var p=$("#"+this.id+"_title");var d=this._IsVerDocked();this.nSavedDockedSize=d?r.height():r.width();var n=r.next();var h;if(n){h=UI.FindDockable(n.attr("id"))}if(h){if(d){var e=r.height()-p.height();r.height(p.height());var m=parseInt(n.css("top"))-e;var k=n.height()+e;n.css("top",m).height(k)}else{var o=this.GetBestMinSize();var e=r.width()-o.w;r.width(o.w);var q=parseInt(n.css("left"))-e;var g=n.width()+e;n.css("left",q).width(g)}this.LayoutContent();this.SetMinimizedState();h.LayoutContent();h.ClearMinimizedState();return}var f=r.prev();var b;if(f){b=UI.FindDockable(f.attr("id"))}if(b){if(d){var e=r.height()-p.height();var c=parseInt(r.css("top"))+e;r.height(p.height()).css("top",c);f.height(f.height()+e)}else{var o=this.GetBestMinSize();var e=r.width()-o.w;var a=parseInt(r.css("left"))+e;r.width(o.w).css("left",a);f.width(f.width()+e)}this.LayoutContent();this.SetMinimizedState();b.LayoutContent();b.ClearMinimizedState();return}}},Restore:function(){if(!this.bMinimized){return}if(this.bFloat){var f=$("#"+this.id);f.width(this.rect.w);f.height(this.rect.h);this.LayoutContent();this.ClearMinimizedState()}else{var f=$("#"+this.id);var x=$("#"+this.id+"_title");var r=this._IsVerDocked();var g=f.next();var k;if(g){k=UI.FindDockable(g.attr("id"))}if(k){var q=false;if(r){var c=$("#"+k.id+"_title");var p=Math.min(this.nSavedDockedSize-f.height(),g.height()-c.height());f.height(f.height()+p);var w=parseInt(g.css("top"))+p;var m=g.height()-p;g.css("top",w).height(m);if(k.GetBestMinSize().h==m){q=true}}else{var n=k.GetBestMinSize();var p=Math.min(this.nSavedDockedSize-f.width(),g.width()-n.w);f.width(f.width()+p);var o=parseInt(g.css("left"))+p;var t=g.width()-p;g.css("left",o).width(t);if(k.GetBestMinSize().w==t){q=true}}this.LayoutContent();this.ClearMinimizedState();k.LayoutContent();if(q){k.SetMinimizedState()}else{k.ClearMinimizedState()}return}var v=f.prev();var s;if(v){s=UI.FindDockable(v.attr("id"))}if(s){var b=false;if(r){var a=$("#"+s.id+"_title");var p=Math.min(this.nSavedDockedSize-f.height(),v.height()-a.height());var u=f.height()+p;var d=parseInt(f.css("top"))-p;f.height(u).css("top",d);v.height(v.height()-p);if(s.GetBestMinSize().h==v.height()){b=true}}else{var l=s.GetBestMinSize();var p=Math.min(this.nSavedDockedSize-f.width(),v.width()-l.w);var h=f.width()+p;var e=parseInt(f.css("left"))-p;f.width(h).css("left",e);v.width(v.width()-p);if(s.GetBestMinSize().w==v.width()){b=true}}this.LayoutContent();this.ClearMinimizedState();s.LayoutContent();s.ClearMinimizedState();if(b){s.SetMinimizedState()}else{s.ClearMinimizedState()}return}}},ClearMinimizedState:function(){if(!this.bMinimized){return}this.bMinimized=false;var a=$("#"+this.id+"_minimize_restore");a.removeClass("ap-dockable-button-restore").addClass("ap-dockable-button-minimize").attr({title:Lang.Minimize,"aria-pressed":this.bMinimized});if(this.bHighConstrastSupport){a.find("img").attr("alt",a.attr("title"))}},SetMinimizedState:function(){if(this.bMinimized){return}this.bMinimized=true;var a=$("#"+this.id+"_minimize_restore");a.removeClass("ap-dockable-button-minimize").addClass("ap-dockable-button-restore").attr({title:Lang.Restore,"aria-pressed":this.bMinimized});if(this.bHighConstrastSupport){a.find("img").attr("alt",a.attr("title"))}},EnableMinimize:function(a){$("#"+this.id+"_minimize_restore").css("opacity",a?1:0.35).attr("aria-disabled",""+!a)},_ShowDockHint:function(g){if(this.eDockHintPos==g){return}var f=this._GetDockPane(g);if(!f){this.eDockHintPos=null;$("#"+this.id+"_dock_hint").remove();return}var a=UI.ViewPort();var e=UI.Stage();$("#"+this.id+"_dock_hint").remove();this.eDockHintPos=g;var d='<div id="'+this.id+'_dock_hint" class="ap-dockable-hint"></div>';a.append(d);var c=$("#"+this.id+"_dock_hint");c.css("opacity",0.25).css("z-index",this.nHintZIndex);if(f.width()>0&&f.height()>0){c.css("left",f.css("left")).css("top",f.css("top")).width(f.width()).height(f.height());return}var b=Math.min(e.width()/2,e.height()/2,200);switch(g){case DockPosition.LEFT:c.css("left",e.css("left")).css("top",e.css("top")).width(b).height(e.height());break;case DockPosition.RIGHT:c.css("left",(parseInt(e.css("left"))+e.width()-b)+"px").css("top",e.css("top")).width(b).height(e.height());break;case DockPosition.TOP:c.css("left",e.css("left")).css("top",e.css("top")).width(e.width()).height(b);break;case DockPosition.BOTTOM:c.css("left",e.css("left")).css("top",(parseInt(e.css("top"))+e.height()-b)+"px").width(e.width()).height(b);break;default:break}},_HideDockHint:function(){this._ShowDockHint(null)},Focus:function(){var b=this.arrNavItems[this.nFocusedItemIndex];if(!b){this.nFocusedItemIndex=0;b=this.arrNavItems[0]}var a=$("#"+b);if(a.length){a.attr("tabindex","0");a.focus();return true}return false}});SlideListUI.MS2STR=function(a){var e=Math.round(a/1000);var c=Math.floor(e/3600);var b=Math.floor(e%3600/60);var d=Math.round(e%60*10)/10;var f="";if(c>0){f+=(c+":")}if(c>0&&b<10){f+="0"}f+=(b+":");if(d<10){f+="0"}f+=d;return ToLocalNumber(f,PrezInfo.Language)};var SlideListItemMode={HIDE:1,NUMBERING_NONE:2,NUMBERING_CONTINUE:3,NUMBERING_RESTART:4};function SlideListUI(){DockableUI.call(this);if(TemplateParams.SlideListPos==UIPos.FLOATING){this.bFloat=true}else{this.bFloat=false;this.eDockPos=TemplateParams.SlideListPos}this.id="SlideList";this.bShowInGroup=TemplateParams.ShowSlideAsGroup;this.mapStates={};this.nCurIndex=-1;this.arrGroups=[];this.mapSlideGroup={};this.strClassIncomplete="ap-slide-list-item-incomplete";this.strClassCurrent="ap-slide-list-item-current";this.strClassCompleted="ap-slide-list-item-completed";this.strClassExpanded="ap-slide-group-expanded";this.strClassCollapsed="ap-slide-group-collapsed";this.strItemPrefix="slide_list_item_slide_";this.strGroupPrefix="slide_list_item_group_";this.strTableId=this.id+"_table";this.nFocusedRow=-1;this.arrNavItems=[this.id+"_minimize_restore",this.id+"_toogle_dock",this.id+"_close",this.strTableId];this.nShowDetailedSteps=2;var m=false;if(Prez.Session.PMode==PlayModes.PRAC||Prez.Session.PMode==PlayModes.TEST){this.nShowDetailedSteps=TemplateParams.ShowDetailedStepsInPractice;m=(TemplateParams.HighLevelStepText==1)}this.strContent="";this.strContent+='<p class="ap-slide-list-title">';switch(Prez.Session.PMode){case PlayModes.DEMO:this.strContent+=Lang.Demo;break;case PlayModes.TUT:this.strContent+=Lang.Tutorial;break;case PlayModes.PRAC:this.strContent+=Lang.Practice;break;case PlayModes.TEST:this.strContent+=Lang.Test;break;default:break}this.strContent+=": "+PrezInfo.Name+"</p>";if(m){this.strContent+='<p class="ap-slide-list-title">'+Lang.HighLevelSteps.format(SlideListUI.MS2STR(Prez.prjSlide.duration))+"</p>"
}this.strContent+='<table id="'+this.strTableId+'" width="100%" cellspacing="0" cellpadding="2" role="treegrid" aria-readonly="true" tabindex="-1">';var r="";var q=0;var e=(TemplateParams.ShowDuration==1||TemplateParams.ShowDuration==3);var n=(TemplateParams.ShowDuration==2||TemplateParams.ShowDuration==3);var g,p,f=0;for(var l=0,h=g_arrSlides.length;l<h;l++){var d=g_arrSlides[l];var a=d.name;if(a==""){a=Lang.Slide+" "+(l+1)}if(d.numbering!==undefined){p=d.numbering}else{p=SlideListItemMode.NUMBERING_CONTINUE}switch(d.numbering){case SlideListItemMode.HIDE:continue;case SlideListItemMode.NUMBERING_NONE:g="";break;case SlideListItemMode.NUMBERING_RESTART:f=1;g=ToLocalNumber(1,PrezInfo.Language)+". ";break;default:++f;g=ToLocalNumber(f,PrezInfo.Language)+". ";break}if(!this.bShowInGroup){this.strContent+='<tr id="'+this.strItemPrefix+l+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="1"><td style="vertical-align:top;padding-left:10px;">'+g+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>";continue}if(d.group==""){r="";this.strContent+='<tr id="'+this.strItemPrefix+l+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="1"><td style="width:16px;vertical-align:top;"></td><td colspan="2" style="vertical-align:top">'+g+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>";continue}if(d.group!=r){r=d.group;var b=0;for(var c=l;c<h;++c){if(g_arrSlides[c].group==r){b+=g_arrSlides[c].duration}else{break}}this.strContent+='<tr id="'+this.strGroupPrefix+q+'" class="'+this.strClassIncomplete+" "+this.strClassExpanded+'" role="row" tabindex="-1" aria-level="1" aria-expanded="true"><td id="'+this.strGroupPrefix+q+'_collapse_expand" class="collapsed-expanded-state"  style="width:1px;white-space:nowrap;vertical-align:top"><span class="ap-icon" title="'+Lang.Expanded+'" aria-label="'+Lang.Expanded+'"></span></td><td colspan="2" style="vertical-align:top">'+r+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="" aria-label=""></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(n?SlideListUI.MS2STR(b):"")+"</span></td></tr>";this.arrGroups.push({slide_indices:[],collapsed:(this.nShowDetailedSteps!=2)});q++}if(this.nShowDetailedSteps!=0){var o=true;for(var c=l+1;c<h;++c){if(g_arrSlides[c].group!=r){break}else{if(g_arrSlides[c].numbering!==SlideListItemMode.HIDE){o=false;break}}}this.strContent+='<tr id="'+this.strItemPrefix+l+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="2"><td style="width:16px;vertical-align:top;"></td><td class="'+(o?"ap-slide-group-last-item":"ap-slide-group-item")+'" style="width:16px;vertical-align:top;"></td><td style="vertical-align:top;">'+g+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>"}this.arrGroups[q-1].slide_indices.push(l);this.mapSlideGroup[l]=q-1}this.strContent+="</table>"}$.extend(SlideListUI.prototype,DockableUI.prototype,{constructor:SlideListUI,_GetContent:function(){return this.strContent},_GetTitle:function(){return Lang.StepsPaneTitle},_SetGroupCollapsed:function(l,h){var k,f,c,b,d,a,g;k=this.arrGroups[l];f=h?"none":"";for(var e=0;e<k.slide_indices.length;++e){$("#"+this.strItemPrefix+k.slide_indices[e]).css("display",f)}k.collapsed=h;c=h?this.strClassExpanded:this.strClassCollapsed;b=h?this.strClassCollapsed:this.strClassExpanded;d=$("#"+this.strGroupPrefix+l);d.removeClass(c).addClass(b).attr("aria-expanded",""+!h);a=d.find(".collapsed-expanded-state").find(".ap-icon");g=h?Lang.Collapsed:Lang.Expanded;a.attr({title:g,"aria-label":g});if(this.bHighConstrastSupport){a.find("img").attr("alt",g)}this._UpdateCompletionStateARIA(d,true)},_UpdateCompletionStateARIA:function(d,c){var b=d.find(".ap-completion-state").find(".ap-icon");var a="";if(!c||(c&&d.hasClass(this.strClassCollapsed))){if(d.hasClass(this.strClassCompleted)){a=Lang.Completed}else{if(d.hasClass(this.strClassIncomplete)){a=Lang.Incomplete}else{if(d.hasClass(this.strClassCurrent)){a=Lang.Current}else{a=Lang.NotVisited}}}}b.attr({title:a,"aria-label":a});if(this.bHighConstrastSupport){b.find("img").attr("alt",a)}},_InitKeyNavSupport:function(){DockableUI.prototype._InitKeyNavSupport.call(this);var b=this;var d=$("#"+this.strTableId);var c=d.find("tr");var a=c.length;d.keydown(function(e){var m=e.which;if((m==38||m==40)&&!e.shiftKey&&!e.ctrlKey&&!e.altKey){if(b.nFocusedRow>=0&&b.nFocusedRow<a){var p=c.eq(b.nFocusedRow);p.attr("tabindex","-1");p.blur()}else{b.nFocusedRow=-1}var h=b.nFocusedRow;var f=false;while(h>=0&&h<a){h+=(m==38?-1:1);var k=c.eq(h);if(k.length==0){break}if(k.css("display")!="none"){f=true;break}}if(!f){h=b.nFocusedRow}if(h<0){h=0}b.nFocusedRow=h;var n=c.eq(b.nFocusedRow);n.attr("tabindex","0");n.focus();return false}if((m==37||m==39)&&e.ctrlKey&&!e.shiftKey&&!e.altKey){if(b.nShowDetailedSteps==0){return false}if(!e.target){return false}var g=e.target.id;if(g.indexOf(b.strGroupPrefix)!=0){return false}g=g.replace(b.strGroupPrefix,"");var o=parseInt(g);if(isNaN(o)||o<0||o>=b.arrGroups.length){return false}var l=b.arrGroups[o];if((m==37&&!l.collapsed)||(m==39&&l.collapsed)){return false}b._SetGroupCollapsed(o,!l.collapsed);return false}if(m==32||m==13){var p=$(e.target);if(p.prop("tagName").toLowerCase()=="tr"){p.trigger("click")}return false}}).focus(function(e){$(this).attr("tabindex","-1");if(b.nFocusedRow<0||b.nFocusedRow>=a){b.nFocusedRow=0}var f=c.eq(b.nFocusedRow);if(f.css("display")=="none"){b.nFocusedRow=0;f=c.eq(b.nFocusedRow)}f.attr("tabindex","0");f.focus();return false});c.focus(function(e){b.nFocusedRow=this.rowIndex;$(this).attr("tabindex","0")}).blur(function(e){$(this).attr("tabindex","-1")})},_Init:function(){DockableUI.prototype._Init.call(this);var c=this;$("#"+this.id).bind("focusin.nav",function(){UI.OnPaneFocused(c)});for(var b=0;b<g_arrSlides.length;b++){$("#"+this.strItemPrefix+b).attr("class",this.mapStates[b]?this.strClassCompleted:this.strClassIncomplete).css("cursor","pointer").click(function(){var f=$(this).attr("id");f=f.replace(c.strItemPrefix,"");var e=parseInt(f);if(isNaN(e)||e<0||e>=g_arrSlides.length){return false}if(UI.SlideNavigationEnabled()){Prez.ShowSlideByIndex(e)}return false})}for(var a=0;a<this.arrGroups.length;a++){$("#"+this.strGroupPrefix+a+"_collapse_expand").click(function(){if(c.nShowDetailedSteps==0){return false}var g=$(this).attr("id");g=g.replace(c.strGroupPrefix,"");g=g.replace("_collapse_expand","");var e=parseInt(g);if(isNaN(e)||e<0||e>=c.arrGroups.length){return false}var f=c.arrGroups[e];c._SetGroupCollapsed(e,!f.collapsed);return false});$("#"+this.strGroupPrefix+a).css("cursor","pointer").click(function(){var h=$(this).attr("id");h=h.replace(c.strGroupPrefix,"");var f=parseInt(h);if(isNaN(f)||f<0||f>=c.arrGroups.length){return false}var g=c.arrGroups[f];if(UI.SlideNavigationEnabled()){var e=g.slide_indices[0];if(e!==undefined){Prez.ShowSlideByIndex(e)}}return false})}this.SetCurrentSlide(this.nCurIndex);if(this.bShowInGroup){if(this.nShowDetailedSteps==0){for(var b=0,d=this.arrGroups.length;b<d;
++b){this._SetGroupCollapsed(b,true)}}else{for(var b=0,d=this.arrGroups.length;b<d;++b){this._SetGroupCollapsed(b,this.arrGroups[b].collapsed)}}}},MarkComplete:function(b,g){var e=b?this.strClassCompleted:this.strClassIncomplete;if(g!==undefined){this.mapStates[g]=b;var c=$("#"+this.strItemPrefix+g);if(!c.length){if(g==this.nCurIndexActual&&g!=this.nCurIndex){delete this.nCurIndexActual;g=this.nCurIndex;c=$("#"+this.strItemPrefix+g);if(!c.length){return}}else{return}}c.attr("class",e);this._UpdateCompletionStateARIA(c,false);var l=this.mapSlideGroup[g];if(l!==undefined&&l>=0&&l<this.arrGroups.length){var h=this.arrGroups[l];var k=true;for(var f=0;f<h.slide_indices.length;++f){if(!this.mapStates[h.slide_indices[f]]){k=false;break}}var d=(k?this.strClassCompleted:this.strClassIncomplete)+" "+(h.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+l);a.attr("class",d);this._UpdateCompletionStateARIA(a,true)}}else{for(var f=0;f<g_arrSlides.length;f++){this.MarkComplete(b[f]===undefined?false:b[f],f)}}},SetCurrentSlide:function(f){if(typeof(f)!=="number"){f=-1}if(this.nCurIndex>=0&&this.nCurIndex<g_arrSlides.length){var d=this.mapStates[this.nCurIndex]?this.strClassCompleted:this.strClassIncomplete;var b=$("#"+this.strItemPrefix+this.nCurIndex);if(b.length){b.attr("class",d);this._UpdateCompletionStateARIA(b,false);var k=this.mapSlideGroup[this.nCurIndex];if(k!==undefined&&k>=0&&k<this.arrGroups.length){var g=this.arrGroups[k];var h=true;for(var e=0;e<g.slide_indices.length;++e){if(!this.mapStates[g.slide_indices[e]]){h=false;break}}var c=(h?this.strClassCompleted:this.strClassIncomplete)+" "+(g.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+k);a.attr("class",c);this._UpdateCompletionStateARIA(a,true)}}}this.nCurIndex=f;if(this.nCurIndex>=0&&this.nCurIndex<g_arrSlides.length){var b;do{b=$("#"+this.strItemPrefix+f);if(b.length){break}--f}while(f>=0);this.nCurIndexActual=this.nCurIndex;this.nCurIndex=f;if(b.length){b.attr("class",this.strClassCurrent);this._UpdateCompletionStateARIA(b,false);var k=this.mapSlideGroup[this.nCurIndex];if(k!==undefined&&k>=0&&k<this.arrGroups.length){var g=this.arrGroups[k];var c=this.strClassCurrent+" "+(g.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+k);a.attr("class",c);this._UpdateCompletionStateARIA(a,true)}}}}});function SlideNotesUI(){DockableUI.call(this);if(TemplateParams.SlideNotesPos==UIPos.FLOATING){this.bFloat=true}else{this.bFloat=false;this.eDockPos=TemplateParams.SlideNotesPos}this.id="SlideNotes";this.strCurGroup="";this.mapStates={};this.nCurIndex=-1;this.nGroupStart=-1;this.nGroupEnd=-1;this.strClassIncomplete="ap-slide-notes-item-incomplete";this.strClassCurrent="ap-slide-notes-item-current";this.strClassCompleted="ap-slide-notes-item-completed";this.strItemPrefix="slide_notes_item_";this.arrNavItems=[this.id+"_minimize_restore",this.id+"_toogle_dock",this.id+"_close"]}$.extend(SlideNotesUI.prototype,DockableUI.prototype,{constructor:SlideNotesUI,_GetContent:function(){return""},_GetTitle:function(){return Lang.SlideNotes},_Init:function(){DockableUI.prototype._Init.call(this);var b=this;$("#"+this.id).bind("focusin.nav",function(){UI.OnPaneFocused(b)});var a=this.nCurIndex;this.SetCurrentSlide(-1);this.SetCurrentSlide(a)},MarkComplete:function(a,b){var d=a?this.strClassCompleted:this.strClassIncomplete;if(b!==undefined){$("#"+this.strItemPrefix+b).attr("class",d);this.mapStates[b]=a}else{for(var c=0;c<g_arrSlides.length;c++){this.MarkComplete(a[c]===undefined?false:a[c],c)}}},GetSlideNoteHTML:function(b,a){var c=a.description;if(c==""){c=a.name}var d='<tr id="'+this.strItemPrefix+b+'" class="'+this.strClassIncomplete+'"><td style="width:1px;white-space:nowrap;vertical-align:top"><span class="ap-icon"></span></td><td style="vertical-align:top">'+c+"</td></tr>";return d},SetCurrentSlide:function(c){if(typeof(c)!=="number"){c=-1}if(this.nCurIndex>=0&&this.nCurIndex<g_arrSlides.length){var f=this.mapStates[this.nCurIndex]?this.strClassCompleted:this.strClassIncomplete;$("#"+this.strItemPrefix+this.nCurIndex).attr("class",f)}this.nCurIndex=c;if(c<0||c>=g_arrSlides.length){this.nGroupStart=this.nGroupEnd=-1;this.strCurGroup="";return}var a=g_arrSlides[c];if(!a){this.nGroupStart=this.nGroupEnd=-1;this.strCurGroup="";return}if(a.group==""||a.group!=this.strCurGroup){this.strCurGroup=a.group;var e="";this.nGroupStart=c;this.nGroupEnd=c;for(var d=c-1;d>=0;d--){var b=g_arrSlides[d];if(b&&b.group!=""&&b.group==this.strCurGroup){e=this.GetSlideNoteHTML(d,b)+e;this.nGroupStart=d}else{break}}for(var d=c;d<g_arrSlides.length;d++){var b=g_arrSlides[d];if(b&&b.group!=""&&b.group==this.strCurGroup){e=e+this.GetSlideNoteHTML(d,b);this.nGroupEnd=d}else{break}}e='<table width="100%">'+e+"</table>";$("#"+this.id+"_content_inner").html(e);for(var d=this.nGroupStart;d<=this.nGroupEnd;d++){$("#"+this.strItemPrefix+d).attr("class",this.mapStates[d]?this.strClassCompleted:this.strClassIncomplete)}}$("#"+this.strItemPrefix+this.nCurIndex).attr("class",this.strClassCurrent)}});ReportUI={pausedStreams:PrezStreams.NONE,OnSendReport:function(){Prez.SendReport()},OnFinish:function(){ReportUI.Close();Prez.Close(false)},OnRestart:function(){ReportUI.Close();Prez.Restart()},OnShow:function(){$(document).unbind("reveal.facebox");$.facebox.footer(ReportUI.GetBtns());var a=PrezInfo.TextDir;if(a=="rtl"){$("#facebox").find(".body").attr("dir",a).css("text-align","right");$("#facebox").find(".footer").attr("dir",a).css("text-align","left")}if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){$("#SendReportButton").click(function(){ReportUI.OnSendReport()})}$("#ReportRestartButton").click(function(){ReportUI.OnRestart()});$("#ReportFinishButton").click(function(){ReportUI.OnFinish()})},Close:function(){$(document).trigger("close.facebox");Prez.Resume(this.pausedStreams);this.pausedStreams=PrezStreams.NONE},GetSummaryInfo:function(){var c=Prez.GetPoints();var a=Prez.GetMaxPoints();var e=new Date();var b="<div class='reporthinfo'>";b+="<table width='100%' border='1px' bordercolor='#808080' bordercolordark='#808080' bordercolorlight='#C0C0C0' cellspacing='0px' rules='all' frame='box' cellpadding='0px'>";b+="<tbody>";b+="<tr><td width='30%'>"+Lang.Presentation+"</td><td>"+PrezInfo.Name.quoteHTML()+"</td></tr>";b+="<tr><td>"+Lang.Description+"</td><td>"+PrezInfo.Description.quoteHTML()+"</td></tr>";b+="<tr><td>"+Lang.Date1+"</td><td>"+e.toUTCString()+"</td></tr>";b+="<tr><td>"+Lang.TotalTime+"</td><td>"+SlideListUI.MS2STR(Prez.Session.Elapsed)+"</td></tr>";b+="<tr><td>"+Lang.TakenSlides+"</td><td>"+ToLocalNumber(Prez.GetTakenSlideCount()+" / "+Prez.GetSlideCount(),PrezInfo.Language)+"</td></tr>";b+="<tr><td>"+Lang.TakenInteractions+"</td><td>"+ToLocalNumber(Prez.GetTakenInteractionCount()+" / "+Prez.GetInteractionCount(),PrezInfo.Language)+"</td></tr>";b+="<tr><td>"+Lang.CorrectCount+"</td><td>"+ToLocalNumber(Prez.GetTakenInteractionCount(Judge.CORRECT),PrezInfo.Language)+"</td></tr>";b+="<tr><td>"+Lang.Points+"</td><td>"+ToLocalNumber(c+"/"+a,PrezInfo.Language)+"</td></tr>";b+="<tr><td>"+Lang.Percentage+"</td><td>"+ToLocalNumber(parseInt(c*100/a),PrezInfo.Language)+" %</td></tr>";b+="<tr><td>"+Lang.Result+"</td><td>"+(Prez.GetResult()?Lang.Passed:Lang.Failed)+" - "+Prez.GetRequirements()+"</td></tr>";b+="</tbody></table>";b+="</div><hr>";return b},GetDetailInfo:function(){var d="<div class='reportrinfo'>";d+="<table width='100%' border='1px' bordercolor='#808080' bordercolordark='#808080' bordercolorlight='#C0C0C0' cellspacing='0px' rules='all' frame='box' cellpadding='0px'><thead><tr>";d+="<th width='10%' align='center'>#</th>";d+="<th width='15%' align='center'>"+Lang.SlideIndex+"</th>";d+="<th width='15%' align='center'>ID</th>";d+="<th width='15%' align='center'>"+Lang.Attempts+"</th>";d+="<th width='15%' align='center'>"+Lang.Points+"</th>";d+="<th width='15%' align='center'>"+Lang.MaxPoints+"</th>";d+="<th width='15%' align='center'>"+Lang.Result+"</th>";
d+="</tr></thead><tbody>";var b=this.GetReportResult();var c=b.length;for(var e=0;e<c;++e){var a=b[e];d+="<tr>";d+="<td align='center'>"+ToLocalNumber(e+1,PrezInfo.Language)+"</td>";d+="<td align='center'>"+ToLocalNumber(parseInt(a.slideidx)+1,PrezInfo.Language)+"</td>";d+="<td align='center'>"+a.reportid+"</td>";d+="<td align='center'>"+ToLocalNumber(a.attempts,PrezInfo.Language)+"</td>";d+="<td align='center'>"+ToLocalNumber(a.points,PrezInfo.Language)+"</td>";d+="<td align='center'>"+ToLocalNumber(a.maxPoints,PrezInfo.Language)+"</td>";d+="<td align='center'>"+a.strJudge+"</td>";d+="</tr>"}d+="</tbody></table>";d+="</div>";return d},GetBtns:function(){var a="<div>";a+="<div align='center'>";if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){a+="<input style='cursor:pointer;' type='button' id='SendReportButton' value='"+Lang.SendReport+"'>"}if(Prez.Session.PMode&(PlayModes.DEMO|PlayModes.PRAC|PlayModes.TUT)){a+="<input style='cursor:pointer;' type='button' id='ReportRestartButton' value='"+Lang.Restart+"'>"}a+="<input style='cursor:pointer;' type='button' id='ReportFinishButton' value='"+Lang.Finish+"'>";a+="</div></div>";return a},GetHTML:function(){var c={w:$(window).innerWidth(),h:$(window).innerHeight()};var b={w:Math.min(600,c.w-80),h:Math.min(450,9*c.h/10-100)};if(b.w<50){b.w=50}if(b.h<50){b.h=50}var a="<div class='reportcontent' style='width:"+b.w+"px; height:"+b.h+"px'>";a+=this.GetSummaryInfo()+this.GetDetailInfo();a+="</div>";return a},Show:function(){this.pausedStreams=Prez.Pause(PrezStreams.ALL);var a=this;$(document).bind("reveal.facebox",a.OnShow);$.facebox(this.GetHTML())},GetReportResult:function(){var h=[];var k=Prez.Session.RestoreData.slides;var m=k.length;for(var l=0;l<m;++l){var o=k[l];if(!o){continue}for(var g in o){var n=o[g];if(!n){continue}var p={slideidx:"",reportid:"",attempts:0,strJudge:"",answers:"",points:0,maxPoints:0,strType:"Unknown"};var f=Prez.GetExportedSlideAt(l);var b=this.GetCtrlFromId(f.ctrls,g);if(b){p.slideidx=l;p.name=b.name;p.reportid=b.reportid;p.attempts=n.a||0;p.judge=n.j;p.strJudge=this.GetJudgeString(n.j);p.points=n.p||0;p.maxPoints=Prez.GetCtrlMaxPoints(b);switch(b.kind){case CtrlKind.INPUT:if(b.type==InputUI.MOUSE){p.type=Prez.interactionType.MOUSE_CLICK;p.strType=Lang.MouseClick}else{if(b.type==InputUI.KEY){p.type=Prez.interactionType.KEY_STROKE;p.strType=Lang.KeyStroke}}break;case CtrlKind.TEXTINPUT:p.answers=p.objAnswers=n.v;p.type=Prez.interactionType.TEXT_BOX;p.strType=Lang.TextBox;break;case CtrlKind.DROP:p.objAnswers=[];p.type=Prez.interactionType.DROP_AREA;p.strType=Lang.DropCtrl;var a,e,c=n.rv?n.rv.length:0;for(e=0;e<c;++e){if(typeof n.rv[e]==="object"){a=this.GetCtrlFromId(f.ctrls,n.rv[e].id)}else{a=this.GetCtrlFromId(f.ctrls,n.rv[e])}if(a){p.objAnswers.push({name:a.name,reportId:a.reportid});if(p.answers!=""){p.answers+=", "}p.answers+=a.reportid}}break;case CtrlKind.QUIZ:var d=this.GetQuizAnswers(b,n);p.answers=d.strAnswers;p.objAnswers=d.objAnswers;switch(b.type){case QuizUI.Type.MULTI_RESPONSE:p.type=Prez.interactionType.MULTI_RESPONSE;p.strType=Lang.MultipleResponse;break;case QuizUI.Type.TRUE_FALSE:p.type=Prez.interactionType.TRUE_FALSE;p.strType=Lang.TrueFalse;break;case QuizUI.Type.MULTI_CHOICE:p.type=Prez.interactionType.MULTI_CHOICE;p.strType=Lang.MultipleChoice;break;case QuizUI.Type.SEQUENCE_DRAGDROP:p.type=Prez.interactionType.SEQUENCE;p.strType=Lang.Sequence;break;case QuizUI.Type.SINGLELINE_TEXT:p.type=Prez.interactionType.FILL_BLANK;p.strType=Lang.FillBlank;break;case QuizUI.Type.MULTILINE_TEXT:p.type=Prez.interactionType.ESSAY;p.strType=Lang.Essay;break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:p.type=Prez.interactionType.FILL_MULTI_BLANK;p.strType=Lang.FillMultipleBlank;break;case QuizUI.Type.MATCH_DRAGDROP:p.type=Prez.interactionType.DRAG_DROP;p.strType=Lang.DragDrop;default:break}break;default:break}}h.push(p)}}return h},GetCtrlFromId:function(a,b){var c,d=a?a.length:0;for(c=0;c<d;++c){if(a[c].id==b){return a[c]}}return null},GetQuizAnswers:function(g,m){var l=g.ctrls,d;var e=l.length;var k="",h=[];var o,c=m.v;switch(g.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.MULTI_CHOICE:case QuizUI.Type.TRUE_FALSE:for(o=0;o<e;++o){d=l[o];if(d.kind!=CtrlKind.ANSWER){continue}if(c[d.act.id]==true){if(k!=""){k+=", "}k+=d.reportid;h.push({name:d.name,reportId:d.reportid})}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:var b={};var r;var q=0;for(o=0;o<e;++o){d=l[o];if(d.kind!=CtrlKind.NOTE&&d.type!=NoteType.ANSWER){continue}r=c[d.id];if(r===undefined){continue}b[r]={name:d.name,reportId:d.reportid};if(r>=q){q=r+1}}for(o=0;o<q;++o){if(!b[o]){continue}if(k!=""){k+=", "}k+=b[o].reportId;h.push(b[o])}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:for(o=0;o<e;++o){d=l[o];if(d.kind!=CtrlKind.TEXTINPUT){continue}h=k=c[d.id];break}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(o=0;o<e;++o){d=l[o];if(d.kind!=CtrlKind.ANSWER){continue}if(k!=""){k+=", "}k+=d.reportid+"."+c[d.act.id];h.push({name:d.name,reportId:d.reportid,value:c[d.act.id]})}break;case QuizUI.Type.MATCH_DRAGDROP:var n,p,a,f;for(n in c){if(c.hasOwnProperty(n)){p=this.GetCtrlFromId(l,n);if(!p){continue}f={name:p.name,reportId:p.reportid,value:[]};for(o=0,e=c[n].length;o<e;++o){if(typeof c[n][o]==="object"){a=this.GetCtrlFromId(l,c[n][o].id)}else{a=this.GetCtrlFromId(l,c[n][o])}if(a){f.value.push({name:a.name,reportId:a.reportid})}}if(f.value.length){h.push(f);if(k!=""){k+=" "}k+=p.reportid+": ";for(o=0,e=f.value.length;o<e;++o){if(o==0){k+=f.value[o].reportId}else{k+=", "+f.value[o].reportId}}k+=";"}}}break;default:break}return{strAnswers:k,objAnswers:h}},GetJudgeString:function(a){if(!a){return"Unknown"}else{if(a==Judge.CORRECT){return Lang.Correct}else{if(a==Judge.WRONG){return Lang.Incorrect}else{if(a==Judge.PARTIAL_CORRECT){return Lang.PartialCorrect}else{if(a==Judge.INCOMPLETE){return Lang.Incomplete}else{if(a==Judge.NEUTRAL){return""}}}}}}return"Unknown"}};function PointerEffect(){var H=Math.PI;var a=6;var o=40;var L=160;var g=40;var n=80;var k=25;var I=H/6;var E=H/18;var l=20;var e=15;var Q=H/36;var v=H/3;var r=H/6;var J=H/3;var u=60;var C=30;var f=50;var O=25;var D={EFFECT_NONE:0,EFFECT_CIRCLE:1,EFFECT_CONCENTRIC_CIRCLES:2,EFFECT_RECT:3,EFFECT_MAX:4};function G(R){return R}function h(R){return(R*H)/180}function P(T,S){var U=0.3;if(S<=U){var R=S/U;T=T*R}return T}function K(T,S){var U=0.8;if(S>=U){if(S>1){S=1}var R=(S-U)/(1-U);T=T*(1-R)}return T}function x(S,R,T){S.beginPath();S.moveTo(0,0);S.lineTo(-R,R);S.lineTo(-R/2,R);S.lineTo(0,T);S.lineTo(R/2,R);S.lineTo(R,R);S.closePath();S.fill()}function m(Z,W,V,R){var Y=(W*W/4-R*W)/2/(Math.sqrt(R*R-V*V)-R+W/2);var X=(W*W/4+R*W)/2/(Math.sqrt(R*R-V*V)-R-W/2);var T=Y+R-W/2;var S=X+R+W/2;var U=(V/R);Z.beginPath();Z.moveTo(0,-W);Z.lineTo(-W,0);Z.lineTo(-W/2,0);Z.arc(-T-W/2,0,T,0,Math.asin(V/T));Z.arc(-S+W/2,0,S,-2*H+Math.asin(V/S),0,true);Z.lineTo(W,0);Z.fill();Z.closePath()}function c(Z,W,V,R){var Y=(W*W/4-R*W)/2/(Math.sqrt(R*R-V*V)-R+W/2);var X=(W*W/4+R*W)/2/(Math.sqrt(R*R-V*V)-R-W/2);var T=Y+R-W/2;var S=X+R+W/2;var U=(V/R);Z.beginPath();Z.moveTo(0,-W);Z.lineTo(-W,0);Z.lineTo(-W/2,0);Z.arc(S-W/2,0,S,-H,-H-Math.asin(V/S),true);Z.arc(T+W/2,0,T,H-Math.asin(V/T),H,false);Z.lineTo(W,0);Z.fill();Z.closePath()}function y(Z,X,W,Y,U,T){var S=a;var aa=o;var R=U.call(null,Y)*(aa-S)+S;Z.lineWidth=S;var V=P(1,Y);V=K(V,Y);Z.globalAlpha=V;Z.strokeStyle=T;Z.clearRect(X-aa-S,W-aa-S,(aa+S)*2,(aa+S)*2);Z.beginPath();Z.arc(X,W,R,0,2*H);Z.stroke();Z.closePath()}function d(Z,X,W,Y,U,T){var aa=o;var S=15;var R=U.call(null,Y)*(aa-a-S)+a+S;Z.lineWidth=a;var V=P(1,Y);V=K(V,Y);Z.globalAlpha=V;Z.strokeStyle=T;Z.clearRect(X-aa-S,W-aa-S,(aa+S)*2,(aa+S)*2);Z.beginPath();Z.arc(X,W,R,0,2*H);Z.stroke();Z.closePath();if(R>0.3*(aa-a-S)+a+S){Z.beginPath();Z.arc(X,W,(R-S),0,2*H);Z.stroke();Z.closePath()}}function z(ac,aa,Z,ab,W,U){var X=k;var T=a/2;var V=1/2*X;var S=H/4;var Y=P(1,ab);Y=K(Y,ab);ac.globalAlpha=Y;ac.strokeStyle=U;ac.fillStyle=U;var R=2*H*W.call(null,ab);
ac.clearRect(aa-(X+2*V),Z-(X+2*V),(X+2*V)*2,(X+2*V)*2);ac.beginPath();ac.lineWidth=a;ac.arc(aa,Z,X,0,2*H);ac.stroke();ac.closePath();ac.translate(aa+Math.cos(S)*(X+V)+T*Math.sin(H/4),Z-Math.sin(S)*(X+V)-T*Math.cos(H/4));ac.beginPath();ac.lineWidth=a/2;ac.arc(0,0,V,0,2*H);ac.stroke();ac.closePath();ac.setTransform(1,0,0,1,0,0);ac.translate(aa+Math.cos(S)*(X+V)+T*Math.sin(H/4),Z-Math.sin(S)*(X+V)-T*Math.cos(H/4));ac.beginPath();ac.lineWidth=a/2;ac.moveTo(0,0);ac.arc(0,0,V,-H/2+R,3/2*H,true);ac.fill();ac.closePath();ac.setTransform(1,0,0,1,0,0)}function p(ab,Y,X,aa,V,T){var Z=g/2;var U=n;var R=L;var S=R-U;var W=P(1,aa);W=K(W,aa);ab.globalAlpha=W;ab.fillStyle=T;ab.clearRect(Y-R,X-R,2*R,2*R);ab.translate(Y,X+S/2-V.call(null,aa)*S);x(ab,Z,U);ab.setTransform(1,0,0,1,0,0)}function s(ab,Y,X,aa,V,T){var Z=g/2;var U=n;var R=L;var S=R-U;var W=P(1,aa);W=K(W,aa);ab.globalAlpha=W;ab.fillStyle=T;ab.clearRect(Y-R,X-R,2*R,2*R);ab.translate(Y,X-S/2+V.call(null,aa)*S);ab.rotate(H);x(ab,Z,U);ab.setTransform(1,0,0,1,0,0)}function M(ab,Y,X,aa,V,T){var Z=g/2;var U=n;var R=L;var S=R-U;var W=P(1,aa);W=K(W,aa);ab.globalAlpha=W;ab.fillStyle=T;ab.clearRect(Y-R,X-R,2*R,2*R);ab.translate(Y-S/2+V.call(null,aa)*S,X);ab.rotate(H/2);x(ab,Z,U);ab.setTransform(1,0,0,1,0,0)}function q(ab,Y,X,aa,V,T){var Z=g/2;var U=n;var R=L;var S=R-U;var W=P(1,aa);W=K(W,aa);ab.globalAlpha=W;ab.fillStyle=T;ab.clearRect(Y-R,X-R,2*R,2*R);ab.translate(Y+S/2-V.call(null,aa)*S,X);ab.fillStyle=T;ab.rotate(3/2*H);x(ab,Z,U);ab.setTransform(1,0,0,1,0,0)}function N(ag,ad,ac,af,Y,V){var ae=g/2;var X=n;var R=L;var U=I;var W=Math.sin(U)*(R-X);var Z=P(1,af);Z=K(Z,af);ag.globalAlpha=Z;ag.fillStyle=V;ag.clearRect(ad-R,ac-R,2*R,2*R);ag.translate(ad,ac);var T=-Math.sin(U)*R+X*Math.sin(U)+Y.call(null,af)*W;var ab=-T/Math.tan(U);ag.translate(T,ab);ag.rotate(U);x(ag,ae,X);ag.setTransform(1,0,0,1,ad,ac);var S=Math.sin(U)*R-X*Math.sin(U)-Y.call(null,af)*W;var aa=-S/Math.tan(U);ag.translate(S,aa);ag.rotate(H+U);x(ag,ae,X);ag.setTransform(1,0,0,1,0,0)}function B(ag,ad,ac,af,Y,V){var ae=g/2;var X=n;var R=L;var U=I;var W=Math.sin(U)*(R-X);var Z=P(1,af);Z=K(Z,af);ag.globalAlpha=Z;ag.fillStyle=V;ag.clearRect(ad-R,ac-R,2*R,2*R);ag.translate(ad,ac);var T=X*Math.sin(U)+Y.call(null,af)*W;var ab=-T/Math.tan(U);ag.translate(T,ab);ag.rotate(U);x(ag,ae,X);ag.setTransform(1,0,0,1,ad,ac);var S=-X*Math.sin(U)-Y.call(null,af)*W;var aa=-S/Math.tan(U);ag.translate(S,aa);ag.rotate(H+U);x(ag,ae,X);ag.setTransform(1,0,0,1,0,0)}function w(ad,ab,Z,ac,W,U){var X=e;var T=E;var S=Q;var V=v;var Y=P(1,ac);Y=K(Y,ac);ad.globalAlpha=Y;ad.strokeStyle=U;var aa=S+W.call(null,ac)*(V-S);var R=X/Math.cos(aa);ad.clearRect(ab-4*X,Z-4*X,8*X,8*X);ad.lineWidth=a;ad.lineJoin="round";ad.lineCap="round";ad.translate(ab,Z);ad.rotate(-60*T/H);ad.beginPath();ad.arc(X,0,R,H-aa,-H+aa,true);ad.arc(-X,0,R,-aa,-2*H+aa,true);ad.stroke();ad.closePath();ad.setTransform(1,0,0,1,0,0)}function b(ag,ae,ac,af,W,U){var X=l;var T=E;var S=r;var V=J;var Z=15;var ad=S+W.call(null,af)*(V-S);var R=X/Math.cos(ad);ag.clearRect(ae-4*X,ac-4*X,8*X,8*X);ag.translate(ae,ac);ag.rotate(-60*T/H);ag.lineWidth=a;var aa=P(1,af);aa=K(aa,af);ag.globalAlpha=aa;ag.strokeStyle=U;ag.lineJoin="round";ag.lineCap="round";ag.beginPath();ag.arc(-X,0,R,-ad,-2*H+ad,true);ag.arc(X,0,R,H-ad,-H+ad,true);ag.stroke();ag.closePath();if(R*Math.sin(ad)>Z){var Y=Math.atan((R*Math.sin(ad)-Z)/X);var ab=X/Math.cos(Y);ag.beginPath();ag.arc(-X,0,ab,-Y,-2*H+Y,true);ag.arc(X,0,ab,+H-Y,-H+Y,true);ag.stroke()}ag.setTransform(1,0,0,1,0,0)}function t(af,ac,ab,ae,X,U){var S=O;var ad=g/2;var W=80;var R=L;var Y=P(1,ae);Y=K(Y,ae);af.globalAlpha=Y;af.fillStyle=U;af.clearRect(ac-R-S,ab-R-S,2*(R+S),2*(R+S));var T=H/2;var V=R-W;af.translate(ac-S-R+W+X.call(null,ae)*V,ab);af.rotate(T);x(af,ad,W);af.setTransform(1,0,0,1,0,0);T=H/4;V=Math.sin(T)*(R-W);af.translate(ac,ab);var aa=Math.sin(T)*(-R-S+W)+X.call(null,ae)*V;var Z=aa/Math.tan(T);af.translate(aa,Z);af.rotate(H-T);x(af,ad,W);af.setTransform(1,0,0,1,0,0);T=H;V=R-W;af.translate(ac,ab-S-R+W+X.call(null,ae)*V);af.rotate(T);x(af,ad,W);af.setTransform(1,0,0,1,0,0);T=H/6;V=Math.sin(T)*(R-W);af.translate(ac,ab);aa=Math.sin(T)*(R+S-W)-X.call(null,ae)*V;var Z=-aa/Math.tan(T);af.translate(aa,Z);af.rotate(H+T);x(af,ad,W);af.setTransform(1,0,0,1,0,0);T=H/3;V=Math.sin(T)*(R-W);af.translate(ac,ab);aa=Math.sin(T)*(R+S-W)-X.call(null,ae)*V;Z=-aa/Math.tan(T);af.translate(aa,Z);af.rotate(H+T);x(af,ad,W);af.setTransform(1,0,0,1,0,0)}function A(af,ab,aa,ae,Y,T){var ac=C/2;var V=f;var R=u;var ad=110;var S=200;var U=60;var Z=P(1,ae);Z=K(Z,ae);af.globalAlpha=Z;af.fillStyle=T;var X=h(ad+Y.call(null,ae)*U);af.clearRect(0,0,400,400);af.translate(ab+Math.cos(X)*R,aa-Math.sin(X)*R);af.rotate(-X);m(af,ac,V,R);af.setTransform(1,0,0,1,0,0);var W=h(S+Y.call(null,ae)*U);af.translate(ab+Math.cos(W)*R,aa-Math.sin(W)*R);af.rotate(-W);m(af,ac,V,R);af.setTransform(1,0,0,1,0,0)}function F(af,ab,aa,ae,Y,T){var ac=C/2;var V=f;var R=u;var ad=150;var S=60;var U=60;var Z=P(1,ae);Z=K(Z,ae);af.globalAlpha=Z;af.fillStyle=T;var X=h(ad-Y.call(null,ae)*U);af.clearRect(0,0,400,400);af.translate(ab+Math.cos(X)*R,aa-Math.sin(X)*R);af.rotate(H-X);c(af,ac,V,R);af.setTransform(1,0,0,1,0,0);var W=h(S-Y.call(null,ae)*U);af.translate(ab+Math.cos(W)*R,aa-Math.sin(W)*R);af.rotate(H-W);c(af,ac,V,R);af.setTransform(1,0,0,1,0,0)}this.RenderTouchEffect=function(R,W,V,T,U,S){switch(W){case Gesture.Type.SINGLE_TAP:y(R,V,T,U,G,S);break;case Gesture.Type.DOUBLE_TAP:d(R,V,T,U,G,S);break;case Gesture.Type.HOLD:z(R,V,T,U,G,S);break;case Gesture.Type.SINGLE_TAP_2FINGERS:w(R,V,T,U,G,S);break;case Gesture.Type.DOUBLE_TAP_2FINGERS:b(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_UP:p(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_DOWN:s(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_LEFT:q(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_RIGHT:M(R,V,T,U,G,S);break;case Gesture.Type.SWIPE_LEFT:q(R,V,T,U,G,S);break;case Gesture.Type.ROTATE_LEFT:A(R,V,T,U,G,S);break;case Gesture.Type.ROTATE_RIGHT:F(R,V,T,U,G,S);break;case Gesture.Type.PINCH_IN:N(R,V,T,U,G,S);break;case Gesture.Type.PINCH_OUT:B(R,V,T,U,G,S);break;case Gesture.Type.FINGERS:t(R,V,T,U,G,S);break}};this.RenderMouseEffect=function(aa,V,X,W,Z,T,U){var S=200;aa.clearRect(0,0,U*2+S,U*2+S);var R=Z*U;aa.strokeStyle=T;aa.lineWidth=2;aa.lineJoin="round";aa.lineCap="round";if(V==D.EFFECT_CIRCLE){aa.beginPath();aa.arc(X,W,R,0,2*Math.PI);aa.stroke()}else{if(V==D.EFFECT_CONCENTRIC_CIRCLES){var Y=9;while(R>0){aa.beginPath();aa.arc(X,W,R,0,2*Math.PI);aa.stroke();R-=Y}}else{if(V==D.EFFECT_RECT){aa.strokeRect(X-R,W-R,2*R,2*R)}}}}}
/*!
 * Atomi HTML5 Player - No_Toolbar Toolbar UI Implementations
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Modified: 2013/11/01
 */
function APToolbar(a){this.GetPadding=function(){return{t:0,l:0,r:0,b:0}};this.GetMinPlayerSize=function(){return{w:1,h:1}};this.SetListener=function(c,b,d){};this.GetSliderPosition=function(){return 0};this.SetSliderPosition=function(b){};this.SetSliderTip=function(b){};this.GetVolumeValue=function(){return 0};this.SetVolumeValue=function(b){};this.SetPause=function(b){};this.SetMute=function(b){};this.SetCCaption=function(b){};this.SetAutoFit=function(b){};this.SetSlideListShown=function(b){};this.UpdateState=function(){};this.Show=function(){};this.Hide=function(){};this.Layout=function(){};this.Focus=function(){return false}}APToolbar.GetImages=function(a){};